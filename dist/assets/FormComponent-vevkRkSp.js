import{q as se,s as L,a9 as U,P as h,a as s,h as oe,K as le,R as ie,j as t,B as C,z,C as ne,I as re,S as de,E as _,M as ue,N as ce,l as N,v as he,w as me,O as pe,u as fe,t as ye,k as ge,x as xe,y as De,A as M,m as O,T as ve,p as A,H as be,J as Ce,U as Se}from"./index-zLCHO5gj.js";import{d as W}from"./dayjs.min-BIwqZoVS.js";import{a as je,A as Te}from"./useMobilePicker-jp2tUA7Z.js";import{D as V}from"./DatePicker-ZpOXrT1U.js";const Fe=se().shape({title:L().min(2,"name is Too Short!").max(20,"name is Too Long!").required("This Field is Required"),startDate:U().required("This Field is Required"),endDate:U().required("This Field is Required"),holiday_type:L().required("This Field is Required")}),ke={title:"",startDate:null,endDate:null,holiday_type:"school_closure",notes:""},G=({onChange:m,refId:v,setDirty:S,reset:i,setReset:u,updatedValues:f=null})=>{const[y,j]=s.useState(ke),b=oe("(min-width:600px)"),e=le({initialValues:y,validationSchema:Fe,enableReinitialize:!0,onSubmit:()=>g()});ie.useImperativeHandle(v,()=>({Submit:async()=>{await e.submitForm()}}));const g=()=>{m&&m({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return s.useEffect(()=>{i&&(e.resetForm(),u(!1))},[i]),s.useEffect(()=>{e.dirty&&S(!0)},[e.dirty]),s.useEffect(()=>{f&&j(f)},[f]),t.jsx(C,{m:"20px",children:t.jsx("form",{ref:v,children:t.jsxs(C,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:b?void 0:"span 4"}},children:[t.jsx(z,{fullWidth:!0,variant:"filled",type:"text",name:"title",label:"Title*",autoComplete:"new-title",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.title,error:!!e.touched.title&&!!e.errors.title,helperText:e.touched.title&&e.errors.title}),t.jsxs(je,{dateAdapter:Te,children:[t.jsx(V,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Closing Date",name:"startDate",value:e.values.startDate,onChange:r=>e.setFieldValue("startDate",r),slotProps:{textField:{error:!!e.touched.startDate&&!!e.errors.startDate,helperText:e.touched.startDate&&e.errors.startDate}}}),t.jsx(V,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Opening Date",name:"endDate",value:e.values.endDate,onChange:r=>e.setFieldValue("endDate",r),slotProps:{textField:{error:!!e.touched.endDate&&!!e.errors.endDate,helperText:e.touched.endDate&&e.errors.endDate}}})]}),t.jsxs(ne,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type&&!!e.errors.type,children:[t.jsx(re,{children:"Holiday Type"}),t.jsx(de,{variant:"filled",name:"holiday_type",value:e.values.type,onChange:e.handleChange,children:Object.keys(_.holiday_type).map(r=>t.jsx(ue,{value:r,children:_.holiday_type[r]},r))}),t.jsx(ce,{children:e.touched.type&&e.errors.type})]}),t.jsx(z,{fullWidth:!0,variant:"filled",type:"text",label:"Note",name:"notes",autoComplete:"new-notes",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.notes,error:!!e.touched.notes&&!!e.errors.notes,helperText:e.touched.notes&&e.errors.notes})]})})})};G.propTypes={onChange:h.func,refId:h.shape({current:h.any}),setDirty:h.func,reset:h.func,setReset:h.func,updatedValues:h.object};const Ae=()=>{const[m,v]=s.useState("Create"),[S,i]=s.useState(!1),[u,f]=s.useState({holidayData:{values:null,validated:!1}}),[y,j]=s.useState(null),[b,e]=s.useState(!1),[g,r]=s.useState(!1),[J,P]=s.useState(!1),K=N(a=>a.menuItems.selected),T=N(a=>a.toastInfo),H=s.useRef(),F=he(),p=me(),k=pe(),I=fe(),Q=ye(I.palette.mode),{typography:E}=ge(I.palette.mode),{state:R}=xe(),{toastAndNavigate:x,getLocalStorage:w}=Se();let D=(R==null?void 0:R.id)||(k==null?void 0:k.id);s.useEffect(()=>{const a=w("menu");p(De(a.selected))},[]);const X=s.useCallback(a=>{const d=[{...a.holidayData.values}],o=["/update-holiday"];i(!0),M.CommonAPI.multipleAPICall("PATCH",o,d).then(l=>{let n=!0;l.forEach(c=>{c.data.status!=="Success"&&(n=!1)}),n&&(i(!1),x(p,!0,"info","Successfully Updated",F,`/holiday/listing/${w("class")||""}`)),i(!1)}).catch(l=>{var n,c;throw i(!1),x(p,!0,"error",(c=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:c.msg),l})},[u]),Z=s.useCallback(a=>{i(!0);const d=[`/get-by-pk/holiday/${a}`];M.CommonAPI.multipleAPICall("GET",d).then(o=>{var n,c,$,q,Y,B;o[0].data.data&&(o[0].data.data.startDate=W(($=(c=(n=o[0])==null?void 0:n.data)==null?void 0:c.data)==null?void 0:$.startDate),o[0].data.data.endDate=W((B=(Y=(q=o[0])==null?void 0:q.data)==null?void 0:Y.data)==null?void 0:B.endDate));const l={holidayData:o[0].data.data};j(l),i(!1)}).catch(o=>{var l,n;throw i(!1),x(p,!0,"error",(n=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:n.msg),o})},[D]),ee=s.useCallback(a=>{i(!0),M.HolidayAPI.createHoliday({...a.holidayData.values}).then(()=>{i(!1),x(p,!0,"success","Successfully Created",F,"/holiday/listing")}).catch(d=>{var o,l;throw i(!1),x(p,!0,"error",(l=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:l.msg),d})},[u]);s.useEffect(()=>{var a;D&&!g&&(v("Update"),Z(D)),u.holidayData.validated?(a=u.holidayData.values)!=null&&a.id?X(u):ee(u):r(!1)},[D,g]);const te=async()=>{await H.current.Submit(),r(!0)},ae=(a,d)=>{d==="holiday"&&f({...u,holidayData:a})};return t.jsxs(C,{m:"10px",sx:{backgroundImage:I.palette.mode=="light"?` linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${O})`:` linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${O})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed",height:"100%"},children:[t.jsx(ve,{fontFamily:E.fontFamily,fontSize:E.h2.fontSize,color:Q.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${m} ${K}`}),t.jsx(G,{onChange:a=>{ae(a,"holiday")},refId:H,setDirty:e,reset:J,setReset:P,userId:D,updatedValues:y==null?void 0:y.holidayData}),t.jsxs(C,{display:"flex",justifyContent:"end",m:"20px",children:[m==="Update"?null:t.jsx(A,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!b||g,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&P(!0)},children:"Reset"}),t.jsx(A,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>F(`/holiday/listing/${w("class")||""}`),children:"Cancel"}),t.jsx(A,{type:"submit",onClick:()=>te(),disabled:!b,color:m==="Update"?"info":"success",variant:"contained",children:"Submit"}),t.jsx(be,{alerting:T.toastAlert,severity:T.toastSeverity,message:T.toastMessage})]}),S===!0?t.jsx(Ce,{}):null]})};export{Ae as default};
