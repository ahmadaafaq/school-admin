import{q as Ue,s as se,P as O,a as r,l as K,w as Pe,h as Se,K as Ye,R as je,W as ze,j as a,B as he,z as B,C as V,I as M,S as q,E as N,M as F,N as U,a0 as ye,G as Ge,U as Oe,v as He,O as Qe,u as Je,t as Ke,k as Xe,x as Ze,y as ea,A as f,m as Fe,T as aa,p as Ce,H as sa,J as ta}from"./index-zLCHO5gj.js";import{d as la}from"./dayjs.min-BIwqZoVS.js";import{A as ra}from"./AddressFormComponent-A6w5Bv7O.js";import{I as na}from"./ImagePicker-Omkwwb9s.js";import{a as Ee,s as ia}from"./SectionAction-X4gvrGyO.js";import{a as ca,s as oa}from"./SubjectAction-cByBtOva.js";import{a as da,A as ua}from"./useMobilePicker-jp2tUA7Z.js";import{F as we,C as ke}from"./FormControlLabel-SXp-cdUw.js";import{D as ha}from"./DatePicker-ZpOXrT1U.js";const ma=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,ga=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,pa=Ue().shape({firstname:se().min(2,"Firstname is Too Short!").max(20,"Firstname is Too Long!").required("This Field is Required"),lastname:se().min(2,"Lastname is Too Short!").max(20,"Lastname is Too Long!").required("This Field is Required"),email:se().matches(ga,"Email Address is Not Valid").required("This Field is Required"),contact_no:se().matches(ma,"Phone Number Is Not Valid").required("This Field is Required"),gender:se(),status:se()}),va={firstname:"",lastname:"",email:"",contact_no:"",dob:null,age:"",nationality:"indian",religion:"",blood_group:"",qualification:"",achievements:"",experience:"",classes:[],sections:[],subjects:[[]],grade:"",is_specially_abled:!1,is_class_teacher:!1,class:"",section:"",caste_group:"",gender:"",status:"active"},Be=({onChange:X,refId:me,setDirty:xe,reset:x,setReset:T,classData:E,setClassData:Y,allSubjects:ge,allSections:Z,updatedValues:H=null})=>{var ce,oe,de,w,A,ae;const[R,_e]=r.useState(va),m=K(s=>s.schoolClasses),_=K(s=>s.schoolSections),z=K(s=>s.schoolSubjects),te=Pe(),le={inputProps:{"aria-label":"Checkboxes"}},re=Se("(min-width:600px)"),ee=Se("(max-width:480px)"),{fetchAndSetSchoolData:pe,getLocalStorage:ne,findMultipleById:Q}=Oe(),e=Ye({initialValues:R,validationSchema:pa,enableReinitialize:!0,onSubmit:()=>o()});je.useImperativeHandle(me,()=>({Submit:async()=>{await e.submitForm()}}));const o=()=>{X&&X({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1,dirty:e.dirty})},ve=()=>{const s={};E.forEach(l=>{var i;if(e.values.classes.includes((i=R==null?void 0:R.sections)!=null&&i.length?`${l.class_id}`:l.class_id)&&e.values.sections.some(b=>b.some(c=>c.section_id===l.section_id))){s[l.class_id]||(s[l.class_id]={});const b=Q(l.subject_ids,ge);s[l.class_id][l.section_id]=b}}),te(ca(s))},ie=()=>{var b;const s=new Set;for(const c of E)(e.values.classes.length&&e.values.classes.includes((b=R==null?void 0:R.sections)!=null&&b.length?`${c.class_id}`:c.class_id)||!e.values.classes.length&&c.class_id===e.values.class)&&s.add({section_id:c.section_id,section_name:c.section_name});const l=Array.from(s),i=Z.filter(c=>l.some(v=>v.section_id===c.section_id));te(Ee(i))};return r.useEffect(()=>{e.values.sections.some(s=>s.length>0)&&E.length&&ve()},[(ce=e.values)==null?void 0:ce.sections,E.length]),r.useEffect(()=>{var s,l;((s=e.values)!=null&&s.classes||(l=e.values)!=null&&l.class)&&E.length&&ie()},[(oe=e.values)==null?void 0:oe.classes,(de=e.values)==null?void 0:de.class,E.length]),r.useEffect(()=>{var s,l,i;ne("schoolInfo")&&(!((s=z==null?void 0:z.listData)!=null&&s.length)||!((l=m==null?void 0:m.listData)!=null&&l.length)||!((i=_==null?void 0:_.listData)!=null&&i.length))&&pe(te,ze,Ee,Y)},[E.length]),r.useEffect(()=>{x&&(e.resetForm(),T(!1))},[x]),r.useEffect(()=>{e.dirty&&xe(!0)},[e.dirty]),r.useEffect(()=>{if(H){const s=H.selectedClass.reduce((c,v)=>{const d=v.class_id;return c[d]||(c[d]=[]),c[d].push(v),c},{}),l=s&&Object.keys(s).length>0,i=c=>{let v=[];return c.map(d=>{let g=Z==null?void 0:Z.filter(D=>d.some(G=>G.section_id===D.section_id));v.push(g)}),v},b=c=>{const v=[[]];return Object.keys(c).map((d,g)=>{Object.values(c)[g].map((D,G)=>{const j=Q(D.subject_ids,ge);g>0&&G===0&&(v[g]=[]),v[g][G]=j})}),v};_e({...R,...H.teacherData,classes:l?Object.keys(s):[],sections:l?i(Object.values(s)):[],subjects:l?b(s):[[]]})}},[H]),a.jsx(he,{m:"20px",children:a.jsxs("form",{ref:me,children:[a.jsxs(he,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gridColumn:"span 4",position:"relative",className:"box-shadow",sx:{"& > div":{gridColumn:re?void 0:"span 4"},marginBottom:"40px"},children:[a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",name:"firstname",label:"Firstname*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.firstname,error:!!e.touched.firstname&&!!e.errors.firstname,helperText:e.touched.firstname&&e.errors.firstname}),a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",name:"lastname",label:"Lastname*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.lastname,error:!!e.touched.lastname&&!!e.errors.lastname,helperText:e.touched.lastname&&e.errors.lastname}),a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",label:"Email*",name:"email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.nationality&&!!e.errors.nationality,children:[a.jsx(M,{children:"Nationality"}),a.jsx(q,{variant:"filled",name:"nationality",value:e.values.nationality,onChange:e.handleChange,children:Object.keys(N.nationality).map(s=>a.jsx(F,{value:s,children:N.nationality[s]},s))}),a.jsx(U,{children:e.touched.nationality&&e.errors.nationality})]}),a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",label:"Religion",name:"religion",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.religion,error:!!e.touched.religion&&!!e.errors.religion,helperText:e.touched.religion&&e.errors.religion}),a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.blood_group&&!!e.errors.blood_group,children:[a.jsx(M,{children:"Blood Group"}),a.jsx(q,{variant:"filled",name:"blood_group",value:e.values.blood_group,onChange:e.handleChange,children:Object.keys(N.bloodGroups).map(s=>a.jsx(F,{value:s,children:N.bloodGroups[s]},s))}),a.jsx(U,{children:e.touched.blood_group&&e.errors.blood_group})]}),a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",label:"Qualification",name:"qualification",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.qualification,error:!!e.touched.qualification&&!!e.errors.qualification,helperText:e.touched.qualification&&e.errors.qualification}),a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",label:"Achievements",name:"achievements",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.achievements,error:!!e.touched.achievements&&!!e.errors.achievements,helperText:e.touched.achievements&&e.errors.achievements}),a.jsx(B,{fullWidth:!0,variant:"filled",type:"text",label:"Experience",name:"experience",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.experience,error:!!e.touched.experience&&!!e.errors.experience,helperText:e.touched.experience&&e.errors.experience}),a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.grade&&!!e.errors.grade,children:[a.jsx(M,{children:"Grade"}),a.jsx(q,{variant:"filled",name:"grade",value:e.values.grade,onChange:e.handleChange,children:Object.keys(N.grade).map(s=>a.jsx(F,{value:s,children:N.grade[s]},s))}),a.jsx(U,{children:e.touched.grade&&e.errors.grade})]}),a.jsx(da,{dateAdapter:ua,children:a.jsx(ha,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Date Of Birth",name:"dob",required:!0,value:e.values.dob,onChange:s=>e.setFieldValue("dob",s)})}),a.jsx(we,{label:"Is Specially Abled",sx:{gridColumn:ee?"span 2":""},control:a.jsx(ke,{...le,color:"default",checked:!!e.values.is_specially_abled,name:"is_specially_abled",onChange:(s,l)=>e.setFieldValue("is_specially_abled",l),value:e.values.is_specially_abled})}),a.jsx(we,{label:"Is Class Teacher",sx:{gridColumn:ee?"span 2":""},control:a.jsx(ke,{...le,color:"default",checked:!!e.values.is_class_teacher,name:"is_class_teacher",onChange:(s,l)=>e.setFieldValue("is_class_teacher",l),value:e.values.is_class_teacher})}),e.values.is_class_teacher&&a.jsxs(a.Fragment,{children:[a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.class&&!!e.errors.class,children:[a.jsx(M,{id:"classField",children:"Class"}),a.jsx(q,{variant:"filled",labelId:"classField",name:"class",value:e.values.class,onChange:s=>{e.setFieldValue("class",s.target.value),e.values.section&&e.setFieldValue("section","")},children:(w=m==null?void 0:m.listData)!=null&&w.length?m.listData.map(s=>a.jsx(F,{value:s.class_id,name:s.class_name,children:s.class_name},s.class_name)):null}),a.jsx(U,{children:e.touched.class&&e.errors.class})]}),a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.section&&!!e.errors.section,children:[a.jsx(M,{id:"sectionField",children:"Section"}),a.jsx(q,{variant:"filled",labelId:"sectionField",name:"section",value:e.values.section,onChange:s=>e.setFieldValue("section",s.target.value),children:(A=_==null?void 0:_.listData)!=null&&A.length?_.listData.map(s=>a.jsx(F,{value:s.section_id,name:s.section_name,children:s.section_name},s.section_id)):null}),a.jsx(U,{children:e.touched.section&&e.errors.section})]})]}),a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.nationality&&!!e.errors.nationality,children:[a.jsx(M,{children:"Caste Group"}),a.jsxs(q,{variant:"filled",name:"caste_group",value:e.values.caste_group,onChange:e.handleChange,children:[a.jsx(F,{value:"general",children:"General"}),a.jsx(F,{value:"obc",children:"OBC"}),a.jsx(F,{value:"sc",children:"SC"}),a.jsx(F,{value:"st",children:"ST"})]}),a.jsx(U,{children:e.touched.caste_group&&e.errors.caste_group})]}),a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[a.jsx(M,{children:"Gender"}),a.jsx(q,{variant:"filled",name:"gender",value:e.values.gender,onChange:e.handleChange,children:Object.keys(N.gender).map(s=>a.jsx(F,{value:s,children:N.gender[s]},s))}),a.jsx(U,{children:e.touched.gender&&e.errors.gender})]}),a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(M,{children:"Status"}),a.jsx(q,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(N.status).map(s=>a.jsx(F,{value:s,children:N.status[s]},s))}),a.jsx(U,{children:e.touched.status&&e.errors.status})]})]}),a.jsxs(he,{border:"2px solid #BADFE7",borderRadius:"12px",display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",padding:"10px",marginBottom:"40px",children:[e.values.classes.map((s,l)=>{var b,c,v;let i=l+1;return a.jsxs(je.Fragment,{children:[a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes&&!!e.errors.classes,children:[a.jsx(M,{id:`classesField_${i}`,children:"Class"}),a.jsx(q,{variant:"filled",labelId:`classesField_${i}`,name:`classes.${i}`,value:e.values.classes[l],onChange:(d,g)=>{const D=[...e.values.classes];D[l]=g.props.value,e.setFieldValue("classes",D),e.values.sections&&e.setFieldValue("sections",[]),e.values.subjects&&e.setFieldValue("subjects",[[]])},children:(b=m==null?void 0:m.listData)!=null&&b.length?m.listData.map(d=>a.jsx(F,{value:d.class_id,name:d.class_name,children:d.class_name},d.class_id)):null}),a.jsx(U,{children:e.touched.classes&&e.errors.classes})]}),a.jsx(ye,{multiple:!0,options:(_==null?void 0:_.listData)||[],getOptionLabel:d=>d.section_name,disableCloseOnSelect:!0,value:e.values.sections[l]||[],onChange:(d,g)=>{const D=[...e.values.sections];D[l]=g,e.setFieldValue("sections",D)},sx:{gridColumn:"span 2"},renderInput:d=>a.jsx(B,{...d,variant:"filled",type:"text",name:`sections.${i}`,label:"Section",error:!!e.touched.sections&&!!e.errors.sections,helperText:e.touched.sections&&e.errors.sections})}),(v=(c=e==null?void 0:e.values)==null?void 0:c.sections[l])==null?void 0:v.map((d,g)=>{var D,G;return a.jsx(ye,{multiple:!0,options:((G=(D=z==null?void 0:z.listData)==null?void 0:D[e.values.classes[l]])==null?void 0:G[d.section_id])||[],getOptionLabel:j=>j.name,disableCloseOnSelect:!0,value:e.values.subjects[l]?e.values.subjects[l][g]||[]:[],onChange:(j,Ae)=>{const $=[...e.values.subjects];l>0&&g===0&&($[l]=[]),$[l][g]=Ae,e.setFieldValue("subjects",$)},sx:{gridColumn:"span 2"},renderInput:j=>a.jsx(B,{...j,variant:"filled",type:"text",name:`subjects.${l}.${g}`,label:`Subjects For Section ${d.section_name}`,error:!!e.touched.subjects&&!!e.errors.subjects,helperText:e.touched.subjects&&e.errors.subjects})},i+g)}),a.jsx(Ge,{sx:{borderBottomWidth:0,gridColumn:"span 4"}})]},i)}),a.jsxs(je.Fragment,{children:[a.jsxs(V,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes&&!!e.errors.classes,children:[a.jsx(M,{id:`classesField_${e.values.classes.length+1}`,children:"Class"}),a.jsx(q,{variant:"filled",labelId:`classesField_${e.values.classes.length+1}`,name:`classes${e.values.classes.length+1}`,value:[],onChange:(s,l)=>{const i=[...e.values.classes];i[e.values.classes.length]=l.props.value,e.setFieldValue("classes",i)},children:(ae=m==null?void 0:m.listData)!=null&&ae.length?m==null?void 0:m.listData.filter(s=>!e.values.classes.includes(s.class_id)).map(s=>a.jsx(F,{value:s.class_id,name:s.class_name,children:s.class_name},s.class_id)):null}),a.jsx(U,{children:e.touched.classes&&e.errors.classes})]}),a.jsx(ye,{multiple:!0,options:(_==null?void 0:_.listData)||[],getOptionLabel:s=>s.section_name,disableCloseOnSelect:!0,value:[],onChange:(s,l)=>{const i=[...e.values.sections];i[e.values.classes.length]=l,e.setFieldValue("sections",i)},sx:{gridColumn:"span 2"},renderInput:s=>a.jsx(B,{...s,variant:"filled",type:"text",name:`sections${e.values.classes.length+1}`,label:"Section"})})]},e.values.classes.length+1)]})]})})};Be.propTypes={onChange:O.func,refId:O.shape({current:O.any}),setDirty:O.func,reset:O.bool,setReset:O.func,classData:O.array,setClassData:O.func,allSubjects:O.array,allSections:O.array,updatedValues:O.object};var fa={VITE_COMPANY_NAME:"The Skolar",VITE_LOGOUT_TIMER:"1800000",VITE_DEFAULT_COUNTRY_ID:"2",VITE_BASE_URL:"https://free.theskolar.com/api/v1",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const xa=fa,Sa=()=>{var De,Ie;const[X,me]=r.useState("Create"),[xe,x]=r.useState(!1),[T,E]=r.useState({teacherData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!1}}),[Y,ge]=r.useState(null),[Z,H]=r.useState([]),[R,_e]=r.useState([]),[m,_]=r.useState([]),[z,te]=r.useState([]),[le,re]=r.useState(!1),[ee,pe]=r.useState(!1),[ne,Q]=r.useState(!1),e=K(t=>t.allSections),o=K(t=>t.allSubjects),ve=K(t=>t.menuItems.selected),ie=K(t=>t.toastInfo),ce=r.useRef(),oe=r.useRef(),de=r.useRef(),w=He(),A=Pe(),ae=Qe(),s=Je(),l=Ke(s.palette.mode),{typography:i}=Xe(s.palette.mode),{state:b}=Ze(),{formatImageName:c,fetchAndSetAll:v,getLocalStorage:d,getIdsFromObject:g,generatePassword:D,isObjEmpty:G,toastAndNavigate:j,uploadFile:Ae}=Oe();let $=(b==null?void 0:b.id)||(ae==null?void 0:ae.id);r.useEffect(()=>{const t=d("menu");A(ea(t.selected))},[]);const Re=r.useCallback(async t=>{var S,k,P,p,h;x(!0);const y=[],u=[],C=((S=t.teacherData.values)==null?void 0:S.firstname.toLowerCase())+((k=t.teacherData.values)!=null&&k.lastname?`${(P=t.teacherData.values)==null?void 0:P.lastname.toLowerCase()}`:"");try{t.teacherData.dirty&&(await f.UserAPI.update({userId:t.teacherData.values.parent_id,id:t.teacherData.values.parent_id,username:C,email:t.teacherData.values.email,contact_no:t.teacherData.values.contact_no,status:t.teacherData.values.status}),y.push("/update-teacher"),u.push(t.teacherData.values)),t.addressData.dirty&&(y.push("/update-address"),u.push(t.addressData.values)),await f.CommonAPI.multipleAPICall("PATCH",y,u)&&$e(t)}catch(n){throw x(!1),j(A,!0,"error",n?(h=(p=n==null?void 0:n.response)==null?void 0:p.data)==null?void 0:h.msg:"An Error Occurred",w,0),n}},[T]),$e=r.useCallback(async t=>{var C,S,k,P;console.log("formdata teacher",t);let y=[],u=null;t.teacherData.dirty&&await(async()=>{await f.TeacherAPI.deleteFromMappingTable({teacher_id:$}),y=t.teacherData.values.sections.map((p,h)=>{const n=t.teacherData.values.classes[h]||0;p.map((I,L)=>{const J=t.teacherData.values.subjects[h][L]||[];f.TeacherAPI.insertIntoMappingTable([t.teacherData.values.id,n,I.section_id,g(J,o==null?void 0:o.listData)])})}),await Promise.all(y)})();try{let p;await f.ImageAPI.deleteImage({parent:"teacher",parent_id:$}),(S=(C=t.imageData)==null?void 0:C.values)!=null&&S.image&&Array.from(t.imageData.values.image).map(async h=>{p=c(h.name),f.ImageAPI.uploadImageToS3({image:h,folder:`teacher/${p}`}).then(n=>{console.log("res",n),n.data.status==="Success"&&f.ImageAPI.createImage({image_src:n.data.data,school_id:t.teacherData.values.id,parent_id:t.teacherData.values.id,parent:"teacher",type:"normal"})})}),t.imageData.values.constructor===Array&&(t.imageData.values.map(h=>{f.ImageAPI.createImage({image_src:h.image_src,school_id:h.school_id,parent_id:h.parent_id,parent:h.parent,type:h.type})}),u=!0),u&&(x(!1),j(A,!0,"info","Successfully Updated",w,"/teacher/listing"))}catch(p){throw x(!1),j(A,!0,"error",p?(P=(k=p==null?void 0:p.response)==null?void 0:k.data)==null?void 0:P.msg:"An Error Occurred",w,0),p}},[T]),Le=r.useCallback(t=>{x(!0);const y=[`/get-by-pk/teacher/${t}`,`/get-address/teacher/${t}`,`/get-teacher-detail/${t}`,`/get-image/teacher/${t}`];f.CommonAPI.multipleAPICall("GET",y).then(u=>{var S,k,P,p,h,n;u[0].data.data&&(u[0].data.data.dob=la(u[0].data.data.dob));const C={teacherData:{teacherData:u[0].data.data,selectedClass:(k=(S=u[2])==null?void 0:S.data)==null?void 0:k.data},addressData:(p=(P=u[1])==null?void 0:P.data)==null?void 0:p.data,imageData:(n=(h=u[3])==null?void 0:h.data)==null?void 0:n.data};ge(C),H(C==null?void 0:C.imageData),x(!1)}).catch(u=>{var C,S;throw x(!1),j(A,!0,"error",(S=(C=u==null?void 0:u.response)==null?void 0:C.data)==null?void 0:S.msg),u})},[]),We=r.useCallback(t=>{var P,p,h;let y,u,C;x(!0);const S=((P=t.teacherData.values)==null?void 0:P.firstname.toLowerCase())+((p=t.teacherData.values)!=null&&p.lastname?`${(h=t.teacherData.values)==null?void 0:h.lastname.toLowerCase()}`:""),k=D();f.UserAPI.register({username:S,password:k,email:t.teacherData.values.email,contact_no:t.teacherData.values.contact_no,role:4,designation:"teacher",status:t.teacherData.values.status}).then(({data:n})=>{(n==null?void 0:n.status)==="Success"&&(f.AddressAPI.createAddress({...t.addressData.values,school_id:n.data.school_id,parent_id:n.data.id,parent:"user"}),f.TeacherAPI.createTeacher({...t.teacherData.values,parent_id:n.data.id,password:k}).then(async({data:I})=>{var L,J,Te;y=f.AddressAPI.createAddress({...t.addressData.values,school_id:I.data.school_id,parent_id:I.data.id,parent:"teacher"}),u=t.teacherData.values.sections.map((W,fe)=>{const ue=t.teacherData.values.classes[fe]||0;W.map((Me,qe)=>{const Ne=t.teacherData.values.subjects[fe][qe]||[];f.TeacherAPI.insertIntoMappingTable([I.data.id,ue,Me.section_id,g(Ne,o==null?void 0:o.listData)])})}),(L=t.imageData.values.image)!=null&&L.length&&(C=Array.from(t.imageData.values.image).map(async W=>{let fe=c(W.name);await f.ImageAPI.uploadImageToS3({image:W,folder:`teacher/${fe}`}).then(ue=>{console.log("res",ue),ue.data.status==="Success"&&console.log("res data ",ue)})}));try{await Promise.all([y,u,C]),x(!1),j(A,!0,"success","Successfully Created",w,"/teacher/listing")}catch(W){x(!1),j(A,!0,"error",W?(Te=(J=W==null?void 0:W.response)==null?void 0:J.data)==null?void 0:Te.msg:"An Error Occurred",w,0),console.log("Error in Teacher Create",W)}}).catch(I=>{var L,J;x(!1),j(A,!0,"error",I?(J=(L=I==null?void 0:I.response)==null?void 0:L.data)==null?void 0:J.msg:"An Error Occurred",w,0),console.log("Error in teacher create",I)}))}).catch(n=>{var I,L;x(!1),j(A,!0,"error",n?(L=(I=n==null?void 0:n.response)==null?void 0:I.data)==null?void 0:L.msg:"An Error Occurred",w,0),console.log("Error in teacher create",n)})},[]);r.useEffect(()=>{var t;(t=e==null?void 0:e.listData)!=null&&t.length||v(A,ia,f.SectionAPI)},[(De=e==null?void 0:e.listData)==null?void 0:De.length]),r.useEffect(()=>{var t;(t=o==null?void 0:o.listData)!=null&&t.length||v(A,oa,f.SubjectAPI)},[(Ie=o==null?void 0:o.listData)==null?void 0:Ie.length]),r.useEffect(()=>{var t;$&&!ee&&(o!=null&&o.listData)&&(me("Update"),Le($)),T.teacherData.validated&&T.addressData.validated&&T.imageData.validated?(t=T.teacherData.values)!=null&&t.id?Re(T):We(T):pe(!1)},[$,ee,o==null?void 0:o.listData]);const Ve=async()=>{await ce.current.Submit(),await oe.current.Submit(),await de.current.Submit(),pe(!0)},be=(t,y)=>{y==="teacher"?E({...T,teacherData:t}):y==="address"?E({...T,addressData:t}):y==="image"&&E({...T,imageData:t})};return a.jsxs(he,{m:"10px",sx:{backgroundImage:s.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${Fe})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${Fe})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed"},children:[a.jsx(aa,{fontFamily:i.fontFamily,fontSize:i.h2.fontSize,color:l.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${X} ${ve}`}),a.jsx(Be,{onChange:t=>{be(t,"teacher")},refId:ce,setDirty:re,reset:ne,setReset:Q,classData:z,setClassData:te,allSections:e==null?void 0:e.listData,allSubjects:o==null?void 0:o.listData,updatedValues:Y==null?void 0:Y.teacherData}),a.jsx(ra,{onChange:t=>{be(t,"address")},refId:oe,update:!!$,setDirty:re,reset:ne,setReset:Q,updatedValues:Y==null?void 0:Y.addressData}),a.jsx(na,{onChange:t=>{be(t,"image")},refId:de,reset:ne,setReset:Q,setDirty:re,preview:m,setPreview:_,deletedImage:R,setDeletedImage:_e,updatedImage:Z,setUpdatedImage:H,imageType:"Teacher",ENV:xa},"image"),a.jsxs(he,{display:"flex",justifyContent:"end",m:"20px",children:[X==="Update"?null:a.jsx(Ce,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!le||ee,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&Q(!0)},children:"Reset"}),a.jsx(Ce,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>w(`/${ve.toLowerCase()}/listing`),children:"Cancel"}),a.jsx(Ce,{type:"submit",onClick:()=>Ve(),disabled:!le,color:X==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(sa,{alerting:ie.toastAlert,severity:ie.toastSeverity,message:ie.toastMessage})]}),xe===!0?a.jsx(ta,{}):null]})};export{Sa as default};
