import{a as s,b as N,v as ee,R as ae,j as a,B as w,m as g,n as U,I as O,S as Y,M as v,w as z,f as G,h as te,k as se,x as le,u as oe,t as ne,d as re,l as ie,s as de,A as F,T as ue,o as M,p as ce,U as me}from"./index-wJj9abeo.js";import{d as H}from"./dayjs.min-3WyAvf2v.js";import{A as he}from"./AddressFormComponent-2wzYeNmw.js";import{c as fe,a as p,L as pe}from"./Loader-V9kt_BZH.js";import{L as xe,A as ge,D as ve}from"./DatePicker-VCJxWt5f.js";import{u as ye}from"./index-ngBz0NVi.js";import"./Validation-UJUBWKF9.js";import"./index-R3E-xKkl.js";import"./Chip-3qarAbJU.js";import"./Dialog-H17IDJ7F.js";const Ce=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,be=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,je=fe().shape({firstname:p().min(2,"Firstname is Too Short!").max(20,"Firstname is Too Long!").required("This Field is Required"),lastname:p().min(2,"Lastname is Too Short!").max(20,"Lastname is Too Long!").required("This Field is Required"),email:p().matches(be,"Email Address is Not Valid"),contact_no:p().matches(Ce,"Phone Number Is Not Valid").required("This Field is Required"),gender:p(),status:p()}),Se={firstname:"",lastname:"",email:"",contact_no:"",role:"",dob:null,gender:"",status:"inactive"},Fe=({onChange:h,refId:y,setDirty:D,reset:o,setReset:r,userId:I,updatedValues:u=null})=>{const[A,C]=s.useState(Se),b=N("(min-width:600px)");N("(max-width:480px)");const e=ee({initialValues:A,validationSchema:je,enableReinitialize:!0,onSubmit:()=>j()});ae.useImperativeHandle(y,()=>({Submit:async()=>{await e.submitForm()}}));const j=()=>{h&&h({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return s.useEffect(()=>{o&&(e.resetForm(),r(!1))},[o]),s.useEffect(()=>{e.dirty&&D(!0)},[e.dirty]),s.useEffect(()=>{u&&C(u)},[u]),a.jsx(w,{m:"20px",children:a.jsx("form",{ref:y,children:a.jsxs(w,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:b?void 0:"span 4"}},children:[a.jsx(g,{fullWidth:!0,variant:"filled",type:"text",name:"firstname",label:"Firstname*",autoComplete:"new-firstname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.firstname,error:!!e.touched.firstname&&!!e.errors.firstname,helperText:e.touched.firstname&&e.errors.firstname}),a.jsx(g,{fullWidth:!0,variant:"filled",type:"text",name:"lastname",label:"Lastname*",autoComplete:"new-lastname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.lastname,error:!!e.touched.lastname&&!!e.errors.lastname,helperText:e.touched.lastname&&e.errors.lastname}),a.jsx(g,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",autoComplete:"new-email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email}),a.jsx(g,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),a.jsx(g,{fullWidth:!0,variant:"filled",type:"text",label:"Role",name:"role",autoComplete:"new-role",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.role,error:!!e.touched.role&&!!e.errors.role,helperText:e.touched.role&&e.errors.role}),a.jsx(xe,{dateAdapter:ge,children:a.jsx(ve,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Select Date Of Birth",name:"dob",required:!0,value:e.values.dob,onChange:S=>{e.setFieldValue("dob",S)}})}),a.jsxs(U,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[a.jsx(O,{id:"genderField",children:"Gender"}),a.jsxs(Y,{variant:"filled",labelId:"genderField",label:"Gender",name:"gender",autoComplete:"new-gender",value:e.values.gender,onChange:e.handleChange,children:[a.jsx(v,{value:"male",children:"Male"}),a.jsx(v,{value:"female",children:"Female"}),a.jsx(v,{value:"other",children:"Other"})]}),a.jsx(z,{children:e.touched.gender&&e.errors.gender})]}),a.jsxs(U,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(O,{id:"statusField",children:"Status"}),a.jsxs(Y,{variant:"filled",labelId:"statusField",label:"Status",name:"status",autoComplete:"new-status",value:e.values.status,onChange:e.handleChange,children:[a.jsx(v,{value:"active",children:"Active"}),a.jsx(v,{value:"inactive",children:"Inactive"})]}),a.jsx(z,{children:e.touched.status&&e.errors.status})]})]})})})},_e=()=>{const[h,y]=s.useState("Create"),[D,o]=s.useState(!1),[r,I]=s.useState({employeeData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!0}}),[u,A]=s.useState(null);s.useState([]),s.useState([]);const[C,b]=s.useState(!1),[e,j]=s.useState(!1),[S,T]=s.useState(!1),V=G(t=>t.menuItems.selected),E=G(t=>t.toastInfo),P=s.useRef(),_=s.useRef();s.useRef();const R=te(),c=se(),B=le(),$=oe(),Q=ne($.palette.mode),{typography:W}=re($.palette.mode),{state:L}=ie();ye();const{toastAndNavigate:f,getLocalStorage:k,getIdsFromObjects:we,findMultipleById:De}=me();let x=(L==null?void 0:L.id)||(B==null?void 0:B.id);s.useEffect(()=>{const t=k("menu");c(de(t.selected))},[]);const J=s.useCallback(t=>{console.log("formdataABCD",t);const n=[{...t.employeeData.values},{...t.addressData.values}],l=["/update-employee","/update-address"];o(!0),F.CommonAPI.multipleAPICall("PATCH",l,n).then(i=>{let d=!0;i.forEach(m=>{m.data.status!=="Success"&&(d=!1)}),d&&(o(!1),f(c,!0,"info","Successfully Updated",R,`/employee/listing/${k("class")}`)),o(!1)}).catch(i=>{var d,m;throw o(!1),f(c,!0,"error",(m=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:m.msg),i})},[r]),K=t=>{o(!0);const n=[`/get-by-pk/employee/${t}`,`/get-address/employee/${t}`];F.CommonAPI.multipleAPICall("GET",n).then(l=>{var d,m;l[0].data.data&&(l[0].data.data.dob=H(l[0].data.data.dob),l[0].data.data.admission_date=H(l[0].data.data.admission_date));const i={employeeData:l[0].data.data,addressData:(m=(d=l[1])==null?void 0:d.data)==null?void 0:m.data};A(i),o(!1)}).catch(l=>{var i,d;throw o(!1),f(c,!0,"error",(d=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:d.msg),l})},X=()=>{o(!0),F.EmployeeAPI.createEmployee({...r.employeeData.values}).then(({data:t})=>{(t==null?void 0:t.status)==="Success"&&F.AddressAPI.createAddress({...r.addressData.values,parent_id:t.data.id,parent:"employee"}).then(n=>{o(!1),f(c,!0,"success","Successfully Created",R,"/employee/listing")}).catch(n=>{throw o(!1),f(c,!0,n||"An Error Occurred"),n})}).catch(t=>{var n,l;throw o(!1),f(c,!0,"error",(l=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:l.msg),t})};s.useEffect(()=>{var t;x&&!e&&(y("Update"),K(x)),r.employeeData.validated&&r.addressData.validated?(t=r.employeeData.values)!=null&&t.id?J(r):X():j(!1)},[x,e]);const Z=async()=>{await P.current.Submit(),await _.current.Submit(),j(!0)},q=(t,n)=>{n==="employee"?I({...r,employeeData:t}):n==="address"&&I({...r,addressData:t})};return a.jsxs(w,{m:"10px",children:[a.jsx(ue,{fontFamily:W.fontFamily,fontSize:W.h2.fontSize,color:Q.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${h} ${V}`}),a.jsx(Fe,{onChange:t=>{q(t,"employee")},refId:P,setDirty:b,reset:S,setReset:T,userId:x,updatedValues:u==null?void 0:u.employeeData}),a.jsx(he,{onChange:t=>{q(t,"address")},refId:_,update:!!x,setDirty:b,reset:S,setReset:T,updatedValues:u==null?void 0:u.addressData}),a.jsxs(w,{display:"flex",justifyContent:"end",m:"20px",children:[h==="Update"?null:a.jsx(M,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!C||e,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&T(!0)},children:"Reset"}),a.jsx(M,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>R(`/employee/listing/${k("class")||""}`),children:"Cancel"}),a.jsx(M,{type:"submit",onClick:()=>Z(),disabled:!C,color:h==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(ce,{alerting:E.toastAlert,severity:E.toastSeverity,message:E.toastMessage})]}),D===!0?a.jsx(pe,{}):null]})};export{_e as default};
