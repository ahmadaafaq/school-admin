import{q as ia,s as U,Y as Oe,Z as ae,P as E,a as c,l as G,$ as ca,w as He,h as Le,K as ua,R as we,j as s,B as oe,z as _,a0 as re,C as Y,I as z,S as H,M as q,N as K,E as se,G as da,H as Ge,U as Je,v as ha,O as pa,u as ma,t as _a,k as ga,x as va,y as fa,A as g,V as ya,m as Ne,T as ba,p as Ee,J as xa}from"./index-zLCHO5gj.js";import{A as ja}from"./AddressFormComponent-A6w5Bv7O.js";import{I as Me}from"./ImagePicker-Omkwwb9s.js";import{F as Ue,C as Ye}from"./FormControlLabel-SXp-cdUw.js";import{s as Ca}from"./SectionAction-X4gvrGyO.js";import{s as Aa}from"./SubjectAction-cByBtOva.js";import{s as Ia}from"./PaymentMethodAction-X7E_0a2C.js";import{a as Fa}from"./AmenityAction-TQ2VORm6.js";import{u as Sa}from"./index-mkkoW40k.js";const Da=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Ta=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,Ba=ia().shape({name:U().min(2,"Firstname is Too Short!").max(50,"Firstname is Too Long!").required("This Field is Required"),email:U().matches(Ta,"Email Address is Not Valid").required("This Field is Required"),contact_no_1:U().matches(Da,"Phone Number Is Not Valid").required("This Field is Required"),director:U().required("This Field is Required"),principal:U().required("This Field is Required"),board:U().required("This Field is Required"),registered_by:U().required("This Field is Required"),payment_date:Oe().required("This Field is Required"),session_start:U().required("This Field is Required"),capacity:Oe().required("This Field is Required"),payment_methods:ae().min(1,"At least 1 Payment method is required is Required").required("required"),classes:ae().min(1,"At least 1 Class is Required").required("required"),classes_fee:ae().min(1,"At least 1 Class fee is Required").required("required"),classes_late_fee:ae().min(1,"At least 1 Class late fee is Required").required("required"),classes_late_fee_duration:ae().min(1,"At least 1 Class late fee duration is Required").required("required"),sections:ae().min(1,"At least 1 section fee duration is Required").required("required")}),Pa={name:"",email:"",contact_no_1:"",contact_no_2:"",director:"",principal:"",board:"",area:"",registered_by:"",registration_year:"",session_start:"",payment_date:"",amenities:[],payment_methods:[],classes:[],classes_fee:[],classes_capacity:[],classes_late_fee:[],classes_late_fee_duration:[],sections:[],subjects:[[]],is_boarding:!1,boarding_capacity:"",capacity:"",founding_year:"",affiliation_no:"",type:"",sub_type:"",status:"active",same_subjects:[]},Ke=({onChange:Q,refId:ne,setDirty:fe,reset:A,setReset:j,allClasses:B,allSections:w,amenities:ye,paymentMethods:be,subjectsInRedux:ie,updatedValues:Z=null})=>{const[ce,xe]=c.useState(Pa),te=G(t=>t.toastInfo);c.useContext(ca);const je=He(),ue={inputProps:{"aria-label":"Checkboxes"}},de=Le("(min-width:600px)"),le=Le("(max-width:480px)"),{createDropdown:Ce,createDivider:he,findMultipleById:pe,toastAndNavigate:X}=Je(),e=ua({initialValues:ce,validationSchema:Ba,enableReinitialize:!0,onSubmit:()=>me()});we.useImperativeHandle(ne,()=>({Submit:async()=>{console.log("impperative"),await e.submitForm()}}));const me=()=>{Q&&(console.log("watch form"),Q({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1,dirty:e.dirty}))};return c.useEffect(()=>{A&&(e.resetForm(),j(!1))},[A]),c.useEffect(()=>{e.dirty&&fe(!0)},[e.dirty]),c.useEffect(()=>{if(Z){const t=Z.selectedClass.reduce((r,o)=>{const i=o.class_id;return r[i]||(r[i]=[]),r[i].push(o),r},{}),l=t&&Object.keys(t).length>0,p=r=>{let o=[];return r.map(i=>{let b=w==null?void 0:w.filter(C=>i.some(I=>I.section_id===C.section_id));o.push(b)}),o},k=r=>{const o=[[]];return Object.keys(r).map((i,b)=>{Object.values(r)[b].map((C,I)=>{const R=pe(C.subject_ids,ie);b>0&&I===0&&(o[b]=[]),o[b][I]=R})}),o},m=(r,o)=>l?Object.values(r).map(i=>i[0][o]):[];xe({...ce,...Z.schoolData,classes:l?Object.keys(t):[],sections:l?p(Object.values(t)):[],subjects:l?k(t):[[]],classes_fee:m(t,"class_fee"),classes_capacity:m(t,"class_capacity"),classes_late_fee:m(t,"late_fee"),classes_late_fee_duration:m(t,"late_fee_duration")})}},[Z]),c.useEffect(()=>{if(e.values.same_subjects===!0){const t=[...e.values.subjects];index>0&&sectionIndex===0&&(t[index]=[]),t[index][sectionIndex]=value,e.setFieldValue("subjects",t)}},[]),console.log("schoolform formik.errors",e.errors),s.jsxs(oe,{m:"20px",children:[s.jsxs("form",{ref:ne,children:[s.jsxs(oe,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:de?void 0:"span 4"},marginBottom:"40px"},children:[s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"name",label:"Name*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.name,error:!!e.touched.name&&!!e.errors.name,helperText:e.touched.name&&e.errors.name,sx:{gridColumn:"span 2"}}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"email",label:"Email*",name:"email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no_1",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no_1,error:!!e.touched.contact_no_1&&!!e.errors.contact_no_1,helperText:e.touched.contact_no_1&&e.errors.contact_no_1}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",label:"Optional Contact Number",name:"contact_no_2",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no_2,error:!!e.touched.contact_no_2&&!!e.errors.contact_no_2,helperText:e.touched.contact_no_2&&e.errors.contact_no_2}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"director",label:"Director*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.director,error:!!e.touched.director&&!!e.errors.director,helperText:e.touched.director&&e.errors.director}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"principal",label:"Principal*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.principal,error:!!e.touched.principal&&!!e.errors.principal,helperText:e.touched.principal&&e.errors.principal}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"registered_by",label:"Registered By*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.registered_by,error:!!e.touched.registered_by&&!!e.errors.registered_by,helperText:e.touched.registered_by&&e.errors.registered_by}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"registration_year",label:"Registration Year",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.registration_year,error:!!e.touched.registration_year&&!!e.errors.registration_year,helperText:e.touched.registration_year&&e.errors.registration_year}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"affiliation_no",label:"Affiliation No",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.affiliation_no,error:!!e.touched.affiliation_no&&!!e.errors.affiliation_no,helperText:e.touched.affiliation_no&&e.errors.affiliation_no}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"board",label:"Board*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.board,error:!!e.touched.board&&!!e.errors.board,helperText:e.touched.board&&e.errors.board}),s.jsx(re,{multiple:!0,options:ye||[],getOptionLabel:t=>t.name,disableCloseOnSelect:!0,value:e.values.amenities,onChange:(t,l)=>e.setFieldValue("amenities",l),sx:{gridColumn:"span 2"},renderInput:t=>s.jsx(_,{...t,variant:"filled",type:"text",name:"amenities",label:"Amenities",error:!!e.touched.amenities&&!!e.errors.amenities,helperText:e.touched.amenities&&e.errors.amenities})}),s.jsx(re,{multiple:!0,options:be||[],getOptionLabel:t=>t.name,disableCloseOnSelect:!0,value:e.values.payment_methods,onChange:(t,l)=>e.setFieldValue("payment_methods",l),sx:{gridColumn:"span 2"},renderInput:t=>s.jsx(_,{...t,variant:"filled",type:"text",name:"payment_methods",label:"Payment Methods*",error:e.touched.payment_methods&&!!e.errors.payment_methods,helperText:e.touched.payment_methods&&e.errors.payment_methods})}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"number",name:"payment_date",label:"Payment Day Of Month*",placeholder:"Please Enter Day Number",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.payment_date,error:!!e.touched.payment_date&&!!e.errors.payment_date,helperText:e.touched.payment_date&&e.errors.payment_date}),s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.session_start&&!!e.errors.session_start,children:[s.jsx(z,{children:"Session Start Month*"}),s.jsx(H,{variant:"filled",name:"session_start",value:e.values.session_start,onChange:t=>e.setFieldValue("session_start",t.target.value),children:Ce(he("monthly"),"january").map((t,l)=>s.jsx(q,{value:t,children:t},l))}),s.jsx(K,{children:e.touched.session_start&&e.errors.session_start})]}),s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type&&!!e.errors.type,children:[s.jsx(z,{children:"Type"}),s.jsx(H,{variant:"filled",name:"type",value:e.values.type,onChange:e.handleChange,children:Object.keys(se.schoolType).map(t=>s.jsx(q,{value:t,children:se.schoolType[t]},t))}),s.jsx(K,{children:e.touched.type&&e.errors.type})]}),s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.sub_type&&!!e.errors.sub_type,children:[s.jsx(z,{children:"Sub Type"}),s.jsx(H,{variant:"filled",name:"sub_type",value:e.values.sub_type,onChange:t=>e.setFieldValue("sub_type",t.target.value),children:Object.keys(se.subSchoolType).map(t=>s.jsx(q,{value:t,children:se.subSchoolType[t]},t))}),s.jsx(K,{children:e.touched.sub_type&&e.errors.sub_type})]}),s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[s.jsx(z,{children:"Status"}),s.jsx(H,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(se.status).map(t=>s.jsx(q,{value:t,children:se.status[t]},t))})]}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"area",label:"Area",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.area,error:!!e.touched.area&&!!e.errors.area,helperText:e.touched.area&&e.errors.area}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"capacity",label:"School Capacity*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.capacity,error:!!e.touched.capacity&&!!e.errors.capacity,helperText:e.touched.capacity&&e.errors.capacity}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"founding_year",label:"Founding Year",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.founding_year,error:!!e.touched.founding_year&&!!e.errors.founding_year,helperText:e.touched.founding_year&&e.errors.founding_year}),s.jsx(Ue,{label:"Is Boarding",sx:{gridColumn:le?"span 2":"",color:"rgba(0,0,0,0.87)"},control:s.jsx(Ye,{...ue,color:"default",checked:!!e.values.is_boarding,name:"is_boarding",onChange:(t,l)=>e.setFieldValue("is_boarding",l),value:e.values.is_boarding})}),e.values.is_boarding&&s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:"boarding_capacity",label:"Specify Boarding Capacity",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.boarding_capacity,error:!!e.touched.boarding_capacity&&!!e.errors.boarding_capacity,helperText:e.touched.boarding_capacity&&e.errors.boarding_capacity})]}),s.jsxs(oe,{border:"2px solid #BADFE7",borderRadius:"12px",display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",padding:"10px",marginBottom:"40px",sx:{"& > div":{gridColumn:de?void 0:"span 4"}},children:[e.values.classes.map((t,l)=>{var k,m;let p=l+1;return s.jsxs(we.Fragment,{children:[s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes&&!!e.errors.classes,children:[s.jsx(z,{children:"Class*"}),s.jsx(H,{variant:"filled",name:`classes.${p}`,value:e.values.classes[l],onChange:(r,o)=>{const i=[...e.values.classes];i[l]=parseInt(o.props.value),e.setFieldValue("classes",i),e.values.sections&&e.setFieldValue("sections",[]),e.values.subjects&&e.setFieldValue("subjects",[[]])},children:B!=null&&B.length?B.map(r=>s.jsx(q,{value:r.class_id,name:r.class_name,children:r.class_name},r.class_id)):null}),s.jsx(K,{children:e.touched.classes&&e.errors.classes})]}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:`classes_fee.${p}`,label:"Class Fee*",onBlur:e.handleBlur,value:e.values.classes_fee[l],onChange:r=>{const o=[...e.values.classes_fee],i=parseInt(r.target.value,10);o[l]=isNaN(i)?"":i,e.setFieldValue("classes_fee",o)},error:!!e.touched.classes_fee&&!!e.errors.classes_fee,helperText:e.touched.classes_fee&&e.errors.classes_fee}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:`classes_late_fee.${p}`,label:"Late Fee*",onBlur:e.handleBlur,value:e.values.classes_late_fee[l],onChange:r=>{const o=[...e.values.classes_late_fee],i=parseInt(r.target.value,10);o[l]=isNaN(i)?"":i,e.setFieldValue("classes_late_fee",o)},error:!!e.touched.classes_late_fee&&!!e.errors.classes_late_fee,helperText:e.touched.classes_late_fee&&e.errors.classes_late_fee}),s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes_late_fee_duration&&!!e.errors.classes_late_fee_duration,children:[s.jsx(z,{children:"Late Fee Duration*"}),s.jsxs(H,{variant:"filled",name:`classes_late_fee_duration.${p}`,value:e.values.classes_late_fee_duration[l],onChange:(r,o)=>{const i=[...e.values.classes_late_fee_duration];i[l]=o.props.value,e.setFieldValue("classes_late_fee_duration",i)},children:[s.jsx(q,{value:"per_day",children:"Per Day"}),s.jsx(q,{value:"per_week",children:"Per Week"}),s.jsx(q,{value:"per_month",children:"Per Month"})]}),s.jsx(K,{children:e.touched.classes_late_fee_duration&&e.errors.classes_late_fee_duration})]}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:`classes_capacity.${p}`,label:"Class Capacity",onBlur:e.handleBlur,value:e.values.classes_capacity[l],onChange:r=>{const o=[...e.values.classes_capacity];o[l]=parseInt(r.target.value),e.setFieldValue("classes_capacity",o)},error:!!e.touched.classes_capacity&&!!e.errors.classes_capacity,helperText:e.touched.classes_capacity&&e.errors.classes_capacity}),s.jsx(re,{multiple:!0,options:w||[],getOptionLabel:r=>r.section_name,disableCloseOnSelect:!0,value:e.values.sections[l],onChange:(r,o)=>{const i=[...e.values.sections];i[l]=o,e.setFieldValue("sections",i)},renderInput:r=>s.jsx(_,{...r,variant:"filled",type:"text",name:`sections.${p}`,label:"Section*",error:e.touched.sections&&!!e.errors.sections,helperText:e.touched.sections&&e.errors.sections})}),(m=(k=e==null?void 0:e.values)==null?void 0:k.sections[l])==null?void 0:m.map((r,o)=>s.jsx(re,{multiple:!0,options:ie||[],getOptionLabel:i=>i.name,disableCloseOnSelect:!0,value:e.values.subjects[l]?e.values.subjects[l][o]||[]:[],onChange:(i,b)=>{const C=[...e.values.subjects];l>0&&o===0&&(C[l]=[]),C[l][o]=b,e.setFieldValue("subjects",C)},sx:{gridColumn:"span 2"},renderInput:i=>{var b,C,I,R;return s.jsx(_,{...i,variant:"filled",type:"text",name:`subjects.${l}.${o}`,label:`Subjects For Section ${r.section_name}`,error:((b=e.touched.subjects)==null?void 0:b[l])&&!!((C=e.errors.subjects)!=null&&C[l]),helperText:((I=e.touched.subjects)==null?void 0:I[l])&&((R=e.errors.subjects)==null?void 0:R[l])})}},p+o)),s.jsx(Ue,{label:"Same Subjects For All",sx:{gridColumn:le?"span 2":"",color:"rgba(0,0,0,0.87)"},control:s.jsx(Ye,{...ue,color:"default",checked:!!e.values.same_subjects[l],name:"Same Subjects For All ",onChange:(r,o)=>{var b,C;const i=[...e.values.same_subjects];if(i[l]=o,console.log(o,"checkbox balue"),e.setFieldValue("same_subjects",i),(C=(b=e==null?void 0:e.values)==null?void 0:b.sections[l])==null||C.map((I,R)=>{const V=[...e.values.subjects];l>0&&R===0&&(V[l]=[]),V[l][R]=V[l]?V[l][0]:[],o&&(console.log(o,"loop condition"),e.setFieldValue("subjects",V))}),!o){console.log(e.values.same_subjects[l],"outside loop condition");const I=[...e.values.subjects];I.map((R,V)=>{V>0&&(I[V]=[])}),e.setFieldValue("subjects",I)}},value:e.values.same_subjects[l]})}),s.jsx(da,{sx:{borderBottomWidth:2,borderColor:"#BADFE7",gridColumn:"span 4",margin:"10px"}})]},p)}),s.jsxs(we.Fragment,{children:[s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes&&!!e.errors.classes,children:[s.jsx(z,{children:"Class*"}),s.jsx(H,{variant:"filled",name:`classes${e.values.classes.length+1}`,value:[],onChange:(t,l)=>{const p=[...e.values.classes];p[e.values.classes.length]=l.props.value,e.setFieldValue("classes",p)},children:B!=null&&B.length?B.filter(t=>!e.values.classes.includes(t.class_id)).map(t=>s.jsx(q,{value:t.class_id,name:t.class_name,children:t.class_name},t.class_id)):null}),!e.values.classes.length&&s.jsx(K,{children:e.touched.classes&&e.errors.classes})]}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:`classes_fee.${e.values.classes_fee.length+1}`,label:"Class Fee*",onBlur:e.handleBlur,value:[],onChange:t=>{const l=[...e.values.classes_fee];l[e.values.classes_fee.length]=t.target.value,e.setFieldValue("classes_fee",l)},error:!!e.touched.classes_fee&&!!e.errors.classes_fee,helperText:e.touched.classes_fee&&e.errors.classes_fee}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:`classes_late_fee.${e.values.classes_late_fee.length+1}`,label:"Late Fee*",onBlur:e.handleBlur,value:[],onChange:t=>{const l=[...e.values.classes_late_fee];l[e.values.classes_late_fee.length]=t.target.value,e.setFieldValue("classes_late_fee",l)},error:!!e.touched.classes_late_fee&&!!e.errors.classes_late_fee,helperText:e.touched.classes_late_fee&&e.errors.classes_late_fee}),s.jsxs(Y,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes_late_fee_duration&&!!e.errors.classes_late_fee_duration,children:[s.jsx(z,{children:"Late Fee Duration*"}),s.jsxs(H,{variant:"filled",name:`classes_late_fee_duration${e.values.classes_late_fee_duration.length+1}`,value:[],onChange:(t,l)=>{const p=[...e.values.classes_late_fee_duration];p[e.values.classes_late_fee_duration.length]=l.props.value,e.setFieldValue("classes_late_fee_duration",p)},children:[s.jsx(q,{value:"per_day",children:"Per Day"}),s.jsx(q,{value:"per_week",children:"Per Week"}),s.jsx(q,{value:"per_month",children:"Per Month"})]}),s.jsx(K,{children:e.touched.classes_late_fee_duration&&e.errors.classes_late_fee_duration})]}),s.jsx(_,{fullWidth:!0,variant:"filled",type:"text",name:`classes_capacity.${e.values.classes_capacity.length+1}`,label:"Class Capacity",onBlur:e.handleBlur,value:[],onChange:t=>{const l=[...e.values.classes_capacity];l[e.values.classes_capacity.length]=t.target.value,e.setFieldValue("classes_capacity",l)},error:!!e.touched.classes_capacity&&!!e.errors.classes_capacity,helperText:e.touched.classes_capacity&&e.errors.classes_capacity}),s.jsx(re,{multiple:!0,options:w||[],getOptionLabel:t=>t.section_name,disableCloseOnSelect:!0,value:[],onChange:(t,l)=>{const p=[...e.values.sections];p[e.values.classes.length]=l,e.setFieldValue("sections",p)},onFocus:()=>{e.values.classes.length===0&&X(je,!0,"info","Please Select Class First")},renderInput:t=>s.jsx(_,{...t,variant:"filled",type:"text",name:`sections${e.values.classes.length+1}`,label:"Section*"})})]},e.values.classes.length+1)]})]}),s.jsx(Ge,{alerting:te.toastAlert,severity:te.toastSeverity,message:te.toastMessage})]})};Ke.propTypes={onChange:E.func,refId:E.shape({current:E.any}),setDirty:E.func,reset:E.bool,setReset:E.func,allClasses:E.array,allSections:E.array,amenities:E.array,paymentMethods:E.array,subjectsInRedux:E.array,updatedValues:E.object};var wa={VITE_COMPANY_NAME:"The Skolar",VITE_LOGOUT_TIMER:"1800000",VITE_DEFAULT_COUNTRY_ID:"2",VITE_BASE_URL:"https://free.theskolar.com/api/v1",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ze=wa,Na=()=>{var Re,Ve,We,$e;const[Q,ne]=c.useState("Create"),[fe,A]=c.useState(!1),[j,B]=c.useState({schoolData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!1},bannerImageData:{values:null,validated:!1}}),[w,ye]=c.useState(null),[be,ie]=c.useState([]),[Z,ce]=c.useState([]),[xe,te]=c.useState([]),[je,ue]=c.useState([]),[de,le]=c.useState([]),[Ce,he]=c.useState([]),[pe,X]=c.useState(!1),[e,me]=c.useState(!1),[t,l]=c.useState(!1),p=G(a=>a.allClasses),k=G(a=>a.allSections),m=G(a=>a.allSubjects),r=G(a=>a.allFormAmenities),o=G(a=>a.allPaymentMethods),i=G(a=>a.menuItems.selected),b=G(a=>a.toastInfo),C=c.useRef(),I=c.useRef(),R=c.useRef(),V=c.useRef(),$=ha(),P=He(),Ae=pa(),Ie=ma(),Qe=_a(Ie.palette.mode),{typography:qe}=ga(Ie.palette.mode),{state:Fe}=va(),{getPaginatedData:Ze}=Sa(),{createSchoolCode:Xe,formatImageName:_e,getLocalStorage:ea,getIdsFromObject:ee,findMultipleById:ke,fetchAndSetAll:ge,toastAndNavigate:O}=Je();let J=(Fe==null?void 0:Fe.id)||(Ae==null?void 0:Ae.id);c.useEffect(()=>{const a=ea("menu");P(fa(a.selected))},[]);const aa=c.useCallback(async a=>{var S,D;console.log("formdata school>>>",a),A(!0);const u=[],v=[];a.schoolData.dirty&&(u.push("/update-school"),v.push({...a.schoolData.values,amenities:ee(a.schoolData.values.amenities),payment_methods:ee(a.schoolData.values.payment_methods)})),a.addressData.dirty&&(u.push("/update-address"),v.push({...a.addressData.values}));try{await g.CommonAPI.multipleAPICall("PATCH",u,v)&&sa(a)}catch(F){throw A(!1),O(P,!0,"error",F?(D=(S=F==null?void 0:F.response)==null?void 0:S.data)==null?void 0:D.msg:"An Error Occurred",$,0),F}},[j]),sa=c.useCallback(async a=>{var v,S,D,F,L,N,h,f,T,M,y;let u=null;if(a.schoolData.dirty){await g.SchoolAPI.deleteFromMappingTable({school_id:J});const d=a.schoolData.values.sections.map(async(n,x)=>{const W=a.schoolData.values.classes[x]||0,Se=a.schoolData.values.classes_fee[x]||0,De=a.schoolData.values.classes_capacity[x]||0,Te=a.schoolData.values.classes_late_fee[x]||0,Be=a.schoolData.values.classes_late_fee_duration[x]||0;return Promise.all(n.map(async(Pe,oa)=>{const na=a.schoolData.values.subjects[x]?a.schoolData.values.subjects[x][oa]:[];await g.SchoolAPI.insertIntoMappingTable([a.schoolData.values.id,W,Pe.section_id,ee(na,m==null?void 0:m.listData),Se,De,Te,Be])}))});await Promise.all(d)}try{let d;await g.ImageAPI.deleteImage({parent:"school",parent_id:J}),(S=(v=a.imageData)==null?void 0:v.values)!=null&&S.image&&(Array.from((D=a.imageData.values)==null?void 0:D.image).map(async n=>{d=_e(n.name),g.ImageAPI.uploadImageToS3({image:n,folder:`school/${d}`}).then(x=>{console.log("res",x),x.data.status==="Success"&&g.ImageAPI.createImage({image_src:x.data.data,school_id:a.schoolData.values.id,parent_id:a.schoolData.values.id,parent:"school",type:"display"})})}),u=!0),((L=(F=a.imageData)==null?void 0:F.values)==null?void 0:L.constructor)===Array&&(a.imageData.values.map(async n=>{await g.ImageAPI.createImage({image_src:n.image_src,school_id:n.school_id,parent_id:n.parent_id,parent:n.parent,type:n.type})}),u=!0),(h=(N=a.bannerImageData)==null?void 0:N.values)!=null&&h.image&&(Array.from(a.bannerImageData.values.image).map(async n=>{let x=_e(n.name);await g.ImageAPI.uploadImageToS3({image:n,folder:`school/${x}`}).then(W=>{console.log("res",W),W.data.status==="Success"&&g.ImageAPI.createImage({image_src:W.data.data,school_id:a.schoolData.values.id,parent_id:a.schoolData.values.id,parent:"school",type:"banner"})})}),u=!0),((T=(f=a.bannerImageData)==null?void 0:f.values)==null?void 0:T.constructor)===Array&&(a.bannerImageData.values.map(async n=>{await g.ImageAPI.createImage({image_src:n.image_src,school_id:n.school_id,parent_id:n.parent_id,parent:n.parent,type:n.type})}),u=!0),u&&(A(!1),O(P,!0,"info","Successfully Updated",$,"/school/listing"))}catch(d){A(!1),O(P,!0,"error",d?(y=(M=d==null?void 0:d.response)==null?void 0:M.data)==null?void 0:y.msg:"An Error Occurred",$,0),console.log("Error in School Update",d)}},[j]),ta=c.useCallback(a=>{A(!0);const u=[`/get-by-pk/school/${a}`,`/get-address/school/${a}`,`/get-image/school/${a}`];g.CommonAPI.multipleAPICall("GET",u).then(v=>{var S,D,F,L,N;(D=(S=v[0])==null?void 0:S.data)!=null&&D.data&&(v[0].data.data.amenities=ke((F=v[0].data.data)==null?void 0:F.amenities,(L=r==null?void 0:r.listData)==null?void 0:L.rows),v[0].data.data.payment_methods=ke((N=v[0].data.data)==null?void 0:N.payment_methods,o==null?void 0:o.listData)),g.SchoolAPI.getSchoolClasses(a).then(h=>{var T,M,y,d,n,x;const f={schoolData:{schoolData:v[0].data.data,selectedClass:h==null?void 0:h.data},addressData:(M=(T=v[1])==null?void 0:T.data)==null?void 0:M.data,imageData:(d=(y=v[2])==null?void 0:y.data)==null?void 0:d.data};ye(f),le((n=f==null?void 0:f.imageData)==null?void 0:n.filter(W=>W.type==="display")),he((x=f==null?void 0:f.imageData)==null?void 0:x.filter(W=>W.type==="banner")),A(!1)}).catch(h=>{var f,T;A(!1),O(P,!0,"error",((T=(f=h==null?void 0:h.response)==null?void 0:f.data)==null?void 0:T.msg)||"Error fetching school classes",$,0)})}).catch(v=>{var S,D;A(!1),O(P,!0,"error",((D=(S=v==null?void 0:v.response)==null?void 0:S.data)==null?void 0:D.msg)||"Error in MultipleApiCall",$,0)})},[(Re=r==null?void 0:r.listData)==null?void 0:Re.rows,(Ve=o==null?void 0:o.listData)==null?void 0:Ve.length]),la=c.useCallback(a=>{var F,L,N;let u,v,S,D;A(!0),a.schoolData.values={...a.schoolData.values,school_code:Xe((F=a.schoolData.values)==null?void 0:F.name),amenities:ee((L=a.schoolData.values)==null?void 0:L.amenities),payment_methods:ee((N=a.schoolData.values)==null?void 0:N.payment_methods)},g.SchoolAPI.createSchool({...a.schoolData.values}).then(({data:h})=>{var f,T,M;if((h==null?void 0:h.status)==="Success")return u=g.AddressAPI.createAddress({...a.addressData.values,school_id:h.data.id,parent_id:h.data.id,parent:"school"}),v=a.schoolData.values.sections.map((y,d)=>{const n=a.schoolData.values.classes[d]||0,x=a.schoolData.values.classes_fee[d]||0,W=a.schoolData.values.classes_capacity[d]||0,Se=a.schoolData.values.classes_late_fee[d]||0,De=a.schoolData.values.classes_late_fee_duration[d]||0;y.map(async(Te,Be)=>{const Pe=a.schoolData.values.subjects[d]?a.schoolData.values.subjects[d][Be]:[];await g.SchoolAPI.insertIntoMappingTable([h.data.id,n,Te.section_id,ee(Pe,m==null?void 0:m.listData),x,W,Se,De])})}),(T=(f=a.imageData.values)==null?void 0:f.image)!=null&&T.length&&(S=Array.from(a.imageData.values.image).map(async y=>{let d=_e(y.name);g.ImageAPI.uploadImageToS3({image:y,folder:`school/${d}`}).then(n=>{console.log("res",n),n.data.status==="Success"&&g.ImageAPI.createImage({image_src:n.data.data,school_id:h.data.id,parent_id:h.data.id,parent:"school",type:"display"})})})),(M=a.bannerImageData.values.image)!=null&&M.length&&(D=Array.from(a.bannerImageData.values.image).map(async y=>{let d=_e(y.name);g.ImageAPI.uploadImageToS3({image:y,folder:`school/${d}`}).then(n=>{console.log("res",n),n.data.status==="Success"&&g.ImageAPI.createImage({image_src:n.data.data,school_id:h.data.id,parent_id:h.data.id,parent:"school",type:"banner"})})})),Promise.all([u,v,S,D]).then(()=>{A(!1),O(P,!0,"success","Successfully Created",$,"/school/listing",!0)}).catch(y=>{var d,n;throw A(!1),O(P,!0,"error",y?(n=(d=y==null?void 0:y.response)==null?void 0:d.data)==null?void 0:n.msg:"An Error Occurred",$,0),y})}).catch(h=>{var f,T;throw A(!1),O(P,!0,"error",h?(T=(f=h==null?void 0:h.response)==null?void 0:f.data)==null?void 0:T.msg:"An Error Occurred",$,0),h})},[j]);c.useEffect(()=>{var a,u;(u=(a=r==null?void 0:r.listData)==null?void 0:a.rows)!=null&&u.length||Ze(0,50,Fa,g.AmenityAPI)},[]),c.useEffect(()=>{var a;(a=o==null?void 0:o.listData)!=null&&a.length||ge(P,Ia,g.PaymentMethodAPI)},[]),c.useEffect(()=>{var a;(a=m==null?void 0:m.listData)!=null&&a.length||ge(P,Aa,g.SubjectAPI)},[]),c.useEffect(()=>{var a;(a=p==null?void 0:p.listData)!=null&&a.length||ge(P,ya,g.ClassAPI)},[]),c.useEffect(()=>{var a;(a=k==null?void 0:k.listData)!=null&&a.length||ge(P,Ca,g.SectionAPI)},[]),c.useEffect(()=>{var a,u;J&&!e&&((a=r==null?void 0:r.listData)!=null&&a.rows)&&(m!=null&&m.listData)&&(ne("Update"),ta(J)),j.schoolData.validated&&j.addressData.validated&&j.imageData.validated&&j.bannerImageData.validated?(u=j.schoolData.values)!=null&&u.id?aa(j):la(j):me(!1)},[J,e,(We=r==null?void 0:r.listData)==null?void 0:We.rows,m==null?void 0:m.listData]);const ra=async()=>{var a,u;console.log("yahan aya"),await C.current.Submit(),await I.current.Submit(),await((a=R.current)==null?void 0:a.Submit()),await((u=V.current)==null?void 0:u.Submit()),me(!0)},ve=(a,u)=>{u==="school"?B({...j,schoolData:a}):u==="address"?B({...j,addressData:a}):u==="display"?B({...j,imageData:a}):u==="banner"&&B({...j,bannerImageData:a})};return s.jsxs(oe,{m:"10px",sx:{backgroundImage:Ie.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${Ne})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${Ne})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed"},children:[s.jsx(ba,{fontFamily:qe.fontFamily,fontSize:qe.h2.fontSize,color:Qe.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${Q} ${i}`}),s.jsx(Ke,{onChange:a=>{ve(a,"school")},refId:C,setDirty:X,reset:t,setReset:l,schoolId:J,allClasses:p==null?void 0:p.listData,allSections:k==null?void 0:k.listData,subjectsInRedux:m==null?void 0:m.listData,amenities:($e=r==null?void 0:r.listData)==null?void 0:$e.rows,paymentMethods:o==null?void 0:o.listData,updatedValues:w==null?void 0:w.schoolData}),s.jsx(ja,{onChange:a=>{ve(a,"address")},refId:I,update:!!J,setDirty:X,reset:t,setReset:l,updatedValues:w==null?void 0:w.addressData}),s.jsx(Me,{onChange:a=>ve(a,"display"),refId:R,reset:t,setReset:l,setDirty:X,preview:Z,setPreview:ce,updatedImage:de,setUpdatedImage:le,deletedImage:be,setDeletedImage:ie,imageType:"Display",ENV:ze},"image"),s.jsx(Me,{onChange:a=>ve(a,"banner"),refId:V,reset:t,setReset:l,setDirty:X,preview:je,setPreview:ue,updatedImage:Ce,setUpdatedImage:he,deletedImage:xe,setDeletedImage:te,imageType:"Banner",multiple:!0,ENV:ze,validation:!1},"banner"),s.jsxs(oe,{display:"flex",justifyContent:"end",m:"20px",children:[Q==="Update"?null:s.jsx(Ee,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!pe||e,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&l(!0)},children:"Reset"}),s.jsx(Ee,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>$(`/${i.toLowerCase()}/listing`),children:"Cancel"}),s.jsx(Ee,{type:"submit",onClick:()=>ra(),disabled:!pe,color:Q==="Update"?"info":"success",variant:"contained",children:"Submit"}),s.jsx(Ge,{alerting:b.toastAlert,severity:b.toastSeverity,message:b.toastMessage})]}),fe===!0?s.jsx(xa,{}):null]})};export{Na as default};
