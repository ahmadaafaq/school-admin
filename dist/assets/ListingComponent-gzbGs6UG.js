import{l as h,v as O,u as ee,t as te,j as i,B as W,T as ne,p as ie,U as se,a as c,w as de,h as J,A as P,V as re,W as le,y as oe,C as K,I as X,S as Z,M as $,P as ce}from"./index-zLCHO5gj.js";import{l as S,S as he,a as ge}from"./listBG-jqFZybtA.js";import{d as ue}from"./DriveFileRenameOutlineOutlined-sr1QJdZi.js";import{a as z,s as fe}from"./MarksheetAction-1MvL35Bm.js";import{s as me,a as j}from"./SectionAction-X4gvrGyO.js";import{s as xe}from"./SubjectAction-cByBtOva.js";import{u as pe}from"./index-mkkoW40k.js";import"./FormControlLabel-SXp-cdUw.js";import"./toPropertyKey-mta9U6ZT.js";import"./typeof-Q9eVcF_1.js";import"./ListItemText-2nz_AZOg.js";import"./CircularProgress-ieWN9mTc.js";import"./TableCell-yZ9kbJpi.js";const _e=(N=null)=>{const e=h(n=>n.schoolClasses),g=h(n=>n.allClasses),s=h(n=>n.schoolSections),v=h(n=>n.allSections),f=O(),m=ee(),r=te(m.palette.mode),{appendSuffix:x,findById:d,capitalizeEveryWord:I}=se(),o=(n,a,l)=>{f(`/marksheet/update/${a}`,{state:{id:n,student_id:a,term:l}})};return[{field:"student_id",headerName:"Student Id",headerAlign:"center",align:"center",flex:1,minWidth:100},{field:"class_id",headerName:"Class",headerAlign:"center",align:"center",flex:1,minWidth:100,renderCell:n=>{var k,R,M,T,B,E,p,b,w,D,y,F;let a,l;return(k=g==null?void 0:g.listData)!=null&&k.length||(R=v==null?void 0:v.listData)!=null&&R.length?(a=(T=d((M=n==null?void 0:n.row)==null?void 0:M.class_id,g==null?void 0:g.listData))==null?void 0:T.class_name,l=(E=d((B=n==null?void 0:n.row)==null?void 0:B.section_id,v==null?void 0:v.listData))==null?void 0:E.section_name):((p=e==null?void 0:e.listData)!=null&&p.length||(b=s==null?void 0:s.listData)!=null&&b.length)&&(a=(D=d((w=n==null?void 0:n.row)==null?void 0:w.class_id,e==null?void 0:e.listData))==null?void 0:D.class_name,l=(F=d((y=n==null?void 0:n.row)==null?void 0:y.section_id,s==null?void 0:s.listData))==null?void 0:F.section_name),i.jsxs("div",{children:[a?x(a):"/"," ",l]})}},{field:"term",headerName:"Term",headerAlign:"center",align:"center",flex:2,minWidth:80},{field:"result",headerName:"Result",headerAlign:"center",align:"center",flex:1,minWidth:120,valueFormatter:n=>`${I(n.value)||""}`,renderCell:({row:{result:n}})=>i.jsx(W,{width:"60%",m:"0 auto",p:"5px",display:"flex",justifyContent:"center",backgroundColor:n==="pass"?r.greenAccent[600]:n==="fail"?r.redAccent[700]:n==="Not Declared Yet"?r.greenAccent[400]:r.redAccent[700],borderRadius:"4px",children:i.jsx(ne,{color:r.grey[100],sx:{ml:"5px"},children:I(n)||""})})},N!==1&&{field:"action",headerName:"Action",headerAlign:"center",align:"center",flex:1,minWidth:75,renderCell:({row:{id:n,student_id:a,term:l}})=>i.jsx(W,{width:"30%",m:"0 auto",p:"5px",display:"flex",justifyContent:"center",children:i.jsx(ie,{color:"info",variant:"contained",onClick:()=>o(n,a,l),sx:{minWidth:"50px"},children:i.jsx(ue,{})})})}]},ve=[5,10,20],Ae=({rolePriority:N=null})=>{var U,G,V,Y,q,H;const[e,g]=c.useState(null),[s,v]=c.useState([]),f=h(t=>t.schoolClasses),m=h(t=>t.allClasses),r=h(t=>t.schoolSections),x=h(t=>t.allSections),d=h(t=>t.allSubjects),I=h(t=>t.menuItems.selected),{listData:o,loading:Q}=h(t=>t.allMarksheets),n=O(),a=de(),l=J("(max-width:480px)"),k=J("(max-width:920px)"),[R,M]=c.useState({search:!1,searching:!1}),[T,B]=c.useState(),E=ee(),p=te(E.palette.mode),b=document.getElementById("reload-btn"),{getPaginatedData:w}=pe(),{getLocalStorage:D,fetchAndSetAll:y,fetchAndSetSchoolData:F,findMultipleById:ae}=se();let u=e!=null&&e.class_id?{classId:e.class_id}:null;return u=e!=null&&e.section_id?{...u,sectionId:e.section_id}:null,c.useEffect(()=>{e!=null&&e.class_id&&(e!=null&&e.section_id)&&w(0,8,z,P.MarksheetAPI,u)},[u==null?void 0:u.classId,u==null?void 0:u.sectionId]),c.useEffect(()=>{var t;(t=d==null?void 0:d.listData)!=null&&t.length||y(a,xe,P.SubjectAPI)},[]),c.useEffect(()=>{(()=>{const C=((s==null?void 0:s.filter(_=>_.class_id===(e==null?void 0:e.class_id)))||[]).map(({section_id:_,section_name:L})=>({section_id:_,section_name:L}));a(j(C))})()},[e==null?void 0:e.class_id,s==null?void 0:s.length]),c.useEffect(()=>{(()=>{var _;const A=s==null?void 0:s.filter(L=>L.class_id===(e==null?void 0:e.class_id)&&L.section_id===(e==null?void 0:e.section_id)),C=A?ae((_=A[0])==null?void 0:_.subject_ids,d==null?void 0:d.listData):[];a(fe({selectedSubjects:C,classDataObj:A[0]}))})()},[e==null?void 0:e.class_id,e==null?void 0:e.section_id,(U=d==null?void 0:d.listData)==null?void 0:U.length,s.length]),c.useEffect(()=>{var t,A,C,_;D("schoolInfo")||((t=m==null?void 0:m.listData)!=null&&t.length||y(a,re,P.ClassAPI),(A=x==null?void 0:x.listData)!=null&&A.length||y(a,me,P.SectionAPI)),D("schoolInfo")&&(!((C=f==null?void 0:f.listData)!=null&&C.length)||!((_=r==null?void 0:r.listData)!=null&&_.length)||!(s!=null&&s.length))&&F(a,le,j,v)},[]),c.useEffect(()=>{const t=D("menu");a(oe(t.selected))},[]),c.useEffect(()=>{var t;(t=o==null?void 0:o.rows)!=null&&t.length&&!(e!=null&&e.class_id)&&!(e!=null&&e.section_id)&&g({...e,class_id:o.rows[0].class_id,section_id:o.rows[0].section_id})},[(G=o==null?void 0:o.rows)==null?void 0:G.length,e==null?void 0:e.section_id]),i.jsxs(W,{m:"10px",position:"relative",sx:{borderRadius:"20px",border:"0.5px solid black",overflow:"hidden",boxShadow:"1px 1px 10px black",backgroundImage:E.palette.mode==="light"?`linear-gradient(rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6)), url(${S})`:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url(${S})`,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"},children:[i.jsx(W,{height:l?"19vh":k?"8vh":"11vh",borderRadius:"4px",padding:l?"1vh":"2vh",backgroundColor:p.blueAccent[700],children:i.jsxs(W,{display:"flex",height:l?"16vh":"7vh",flexDirection:l?"column":"row",justifyContent:"space-between",alignItems:l?"center":"normal",children:[i.jsx(ne,{component:"h2",variant:"h2",color:p.grey[100],fontWeight:"bold",marginRight:"15px",children:I}),i.jsx(he,{action:z,api:P.MarksheetAPI,getSearchData:w,oldPagination:T,reloadBtn:b,setSearchFlag:M}),i.jsxs(K,{variant:"filled",sx:{minWidth:120,marginRight:"10px"},children:[i.jsx(X,{id:"classfield",children:"Class"}),i.jsx(Z,{variant:"filled",labelId:"classfield",value:(e==null?void 0:e.class_id)||"",onChange:t=>g({...e,class_id:t.target.value}),sx:{height:"100%",marginLeft:"1vh",backgroundColor:p.blueAccent[800],"&:hover":{backgroundColor:p.blueAccent[800]}},children:(V=m==null?void 0:m.listData)!=null&&V.length?m.listData.map(t=>i.jsx($,{value:t.class_id,children:t.class_name},t.class_id)):(Y=f==null?void 0:f.listData)!=null&&Y.length?f.listData.map(t=>i.jsx($,{value:t.class_id,children:t.class_name},t.class_id)):null})]}),i.jsxs(K,{variant:"filled",sx:{minWidth:120,height:k?"4vh":"auto"},children:[i.jsx(X,{id:"sectionfield",children:"Section"}),i.jsx(Z,{variant:"filled",labelId:"sectionfield",value:(e==null?void 0:e.section_id)||"",onChange:t=>g({...e,section_id:t.target.value}),sx:{height:"100%",marginRight:"1vh",backgroundColor:p.blueAccent[800],"&:hover":{backgroundColor:p.blueAccent[800]}},children:(q=x==null?void 0:x.listData)!=null&&q.length?x.listData.map(t=>i.jsx($,{value:t.section_id,children:t.section_name},t.section_id)):(H=r==null?void 0:r.listData)!=null&&H.length?r.listData.map(t=>i.jsx($,{value:t.section_id,children:t.section_name},t.section_id)):null})]}),N>1&&i.jsxs(ie,{color:"success",disabled:!(e!=null&&e.class_id)||!(e!=null&&e.section_id),variant:"contained",type:"submit",onClick:()=>n("/marksheet/create"),sx:{height:k?"4vh":"auto"},children:["Create New ",I]})]})}),i.jsx(ge,{action:z,api:P.MarksheetAPI,getQuery:w,columns:_e(N),rows:o.rows,count:o.count,loading:Q,selected:I,pageSizeOptions:ve,setOldPagination:B,searchFlag:R,setSearchFlag:M,condition:u})]})};Ae.propTypes={rolePriority:ce.number};export{Ae as default};
