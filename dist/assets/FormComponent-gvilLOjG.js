import{a as o,b as ye,v as Ae,R,j as a,B as I,m,n as P,I as W,S as E,M as y,w as q,f as $,h as ke,k as Pe,x as We,u as Ee,t as $e,d as Ie,l as Le,s as Oe,A as F,E as Ne,T as Me,o as ee,p as Ue,U as Ve}from"./index-wJj9abeo.js";import{A as qe}from"./AddressFormComponent-2wzYeNmw.js";import{I as be}from"./ImagePicker-l40Oa1J_.js";import{c as ze,a as z,L as He}from"./Loader-V9kt_BZH.js";import{A as ae,F as Ye,C as Ge}from"./FormControlLabel-rkyz9wHp.js";import{a as Je}from"./AmenityAction-V29uH3oo.js";import{s as Qe}from"./SectionAction-bDNrVPg3.js";import{u as Ke}from"./index-ngBz0NVi.js";import"./Validation-UJUBWKF9.js";import"./Chip-3qarAbJU.js";const Xe=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Ze=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,Re=ze().shape({name:z().min(2,"Firstname is Too Short!").max(50,"Firstname is Too Long!").required("This Field is Required"),email:z().matches(Ze,"Email Address is Not Valid"),contact_no_1:z().matches(Xe,"Phone Number Is Not Valid").required("This Field is Required"),status:z()}),ea={name:"",email:"",contact_no_1:"",contact_no_2:"",director:"",principal:"",board:"",area:"",registered_by:"",registration_year:0,amenities:[],classes:[],sections:[],is_boarding:!1,boarding_capacity:0,capacity:0,founding_year:0,affiliation_no:0,type:"",sub_type:"",status:"inactive"},aa=({onChange:D,refId:L,setDirty:H,reset:v,setReset:h,schoolId:T,amenities:j,classesInRedux:b,sectionsInRedux:S,updatedValues:B=null})=>{const[O,Y]=o.useState(ea),G={inputProps:{"aria-label":"Checkboxes"}},J=ye("(min-width:600px)"),Q=ye("(max-width:480px)"),e=Ae({initialValues:O,validationSchema:Re,enableReinitialize:!0,onSubmit:()=>N()});R.useImperativeHandle(L,()=>({Submit:async()=>{await e.submitForm()}}));const N=()=>{D&&D({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return o.useEffect(()=>{v&&(e.resetForm(),h(!1))},[v]),o.useEffect(()=>{e.dirty&&H(!0)},[e.dirty]),o.useEffect(()=>{if(B){const l=B.selectedClass.reduce((c,g)=>{const s=g.class_id;return c[s]||(c[s]=[]),c[s].push(g),c},{}),d=l&&Object.keys(l).length>0,p=c=>{let g,s=[];return c.map(x=>{console.log(x,"section"),g=S==null?void 0:S.filter(_=>x.some(A=>A.id===_.id)),console.log(g,"filteredSection"),s.push(g)}),console.log(s,"filteredSectioArrayn"),s};Y({...O,...B.schoolData,classes:d?Object.keys(l):[],sections:d?p(Object.values(l)):[]})}},[B]),a.jsx(I,{m:"20px",children:a.jsxs("form",{ref:L,children:[a.jsxs(I,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:J?void 0:"span 4"},marginBottom:"40px"},children:[a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"name",label:"Name*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.name,error:!!e.touched.name&&!!e.errors.name,helperText:e.touched.name&&e.errors.name,sx:{gridColumn:"span 2"}}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no_1",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no_1,error:!!e.touched.contact_no_1&&!!e.errors.contact_no_1,helperText:e.touched.contact_no_1&&e.errors.contact_no_1}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",label:"Optional Contact Number",name:"contact_no_2",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no_2,error:!!e.touched.contact_no_2&&!!e.errors.contact_no_2,helperText:e.touched.contact_no_2&&e.errors.contact_no_2}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"director",label:"Director*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.director,error:!!e.touched.director&&!!e.errors.director,helperText:e.touched.director&&e.errors.director}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"principal",label:"Principal*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.principal,error:!!e.touched.principal&&!!e.errors.principal,helperText:e.touched.principal&&e.errors.principal}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"board",label:"Board*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.board,error:!!e.touched.board&&!!e.errors.board,helperText:e.touched.board&&e.errors.board}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"area",label:"Area",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.area,error:!!e.touched.area&&!!e.errors.area,helperText:e.touched.area&&e.errors.area}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"registered_by",label:"Registered By",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.registered_by,error:!!e.touched.registered_by&&!!e.errors.registered_by,helperText:e.touched.registered_by&&e.errors.registered_by}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"registration_year",label:"Registration Year",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.registration_year,error:!!e.touched.registration_year&&!!e.errors.registration_year,helperText:e.touched.registration_year&&e.errors.registration_year}),a.jsx(ae,{multiple:!0,options:j||[],getOptionLabel:l=>l.name,disableCloseOnSelect:!0,value:e.values.amenities,onChange:(l,d)=>e.setFieldValue("amenities",d),sx:{gridColumn:"span 2"},renderInput:l=>a.jsx(m,{...l,variant:"filled",type:"text",name:"amenities",label:"Amenities",error:!!e.touched.amenities&&!!e.errors.amenities,helperText:e.touched.amenities&&e.errors.amenities})}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"capacity",label:"Capacity",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.capacity,error:!!e.touched.capacity&&!!e.errors.capacity,helperText:e.touched.capacity&&e.errors.capacity}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"founding_year",label:"Founding Year",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.founding_year,error:!!e.touched.founding_year&&!!e.errors.founding_year,helperText:e.touched.founding_year&&e.errors.founding_year}),a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"affiliation_no",label:"Affiliation No",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.affiliation_no,error:!!e.touched.affiliation_no&&!!e.errors.affiliation_no,helperText:e.touched.affiliation_no&&e.errors.affiliation_no}),a.jsxs(P,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type&&!!e.errors.type,children:[a.jsx(W,{id:"typeField",children:"Type"}),a.jsxs(E,{variant:"filled",labelId:"typeField",name:"type",value:e.values.type,onChange:e.handleChange,children:[a.jsx(y,{value:"co-ed",children:"Co-Ed"}),a.jsx(y,{value:"boys",children:"Boys"}),a.jsx(y,{value:"girls",children:"Girls"})]}),a.jsx(q,{children:e.touched.type&&e.errors.type})]}),a.jsxs(P,{variant:"filled",sx:{minWidth:120},error:!!e.touched.sub_type&&!!e.errors.sub_type,children:[a.jsx(W,{id:"sub_typeField",children:"Sub Type"}),a.jsxs(E,{variant:"filled",labelId:"sub_typeField",name:"sub_type",value:e.values.sub_type,onChange:l=>e.setFieldValue("sub_type",l.target.value),children:[a.jsx(y,{value:"playgroup",children:"Playgroup"}),a.jsx(y,{value:"junior",children:"Junior"}),a.jsx(y,{value:"senior",children:"Senior"}),a.jsx(y,{value:"senior-sec",children:"Senior-Sec"})]}),a.jsx(q,{children:e.touched.sub_type&&e.errors.sub_type})]}),a.jsxs(P,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(W,{id:"statusField",children:"Status"}),a.jsxs(E,{variant:"filled",labelId:"statusField",name:"status",value:e.values.status,onChange:e.handleChange,children:[a.jsx(y,{value:"active",children:"Active"}),a.jsx(y,{value:"inactive",children:"Inactive"})]})]}),a.jsx(Ye,{label:"Is Boarding",sx:{gridColumn:Q?"span 2":""},control:a.jsx(Ge,{...G,color:"default",checked:!!e.values.is_boarding,name:"is_boarding",onChange:(l,d)=>e.setFieldValue("is_boarding",d),value:e.values.is_boarding})}),e.values.is_boarding&&a.jsx(m,{fullWidth:!0,variant:"filled",type:"text",name:"boarding_capacity",label:"Specify Boarding Capacity",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.boarding_capacity,error:!!e.touched.boarding_capacity&&!!e.errors.boarding_capacity,helperText:e.touched.boarding_capacity&&e.errors.boarding_capacity})]}),a.jsxs(I,{border:"2px solid #BADFE7",borderRadius:"12px",display:"grid",gap:"30px",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",padding:"10px",marginBottom:"40px",children:[e.values.classes.map((l,d)=>{let p=d+1;return a.jsxs(R.Fragment,{children:[a.jsxs(P,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes&&!!e.errors.classes,children:[a.jsx(W,{id:`classesField_${p}`,children:"Class"}),a.jsx(E,{variant:"filled",labelId:`classesField_${p}`,name:`classes${p}`,autoComplete:"new-classes",value:e.values.classes[d],onChange:(c,g)=>{const s=[...e.values.classes];s[d]=g.props.value,e.setFieldValue("classes",s)},children:(b==null?void 0:b.length)&&b.map(c=>a.jsx(y,{value:c.class_id,name:c.class_name,children:c.class_name},c.class_name))}),a.jsx(q,{children:e.touched.classes&&e.errors.classes})]}),a.jsx(ae,{multiple:!0,options:S||[],getOptionLabel:c=>c.name,disableCloseOnSelect:!0,value:e.values.sections[d],onChange:(c,g)=>{const s=[...e.values.sections];s[d]=g,e.setFieldValue("sections",s)},sx:{gridColumn:"span 2"},renderInput:c=>a.jsx(m,{...c,variant:"filled",type:"text",name:`sections${p}`,label:"Section"})})]},p)}),a.jsxs(R.Fragment,{children:[a.jsxs(P,{variant:"filled",sx:{minWidth:120},error:!!e.touched.classes&&!!e.errors.classes,children:[a.jsx(W,{id:`classesField_${e.values.classes.length+1}`,children:"Class"}),a.jsx(E,{variant:"filled",labelId:`classesField_${e.values.classes.length+1}`,name:`classes${e.values.classes.length+1}`,autoComplete:"new-classes",value:[],onChange:(l,d)=>{const p=[...e.values.classes];p[e.values.classes.length]=d.props.value,e.setFieldValue("classes",p)},children:(b==null?void 0:b.length)&&b.filter(l=>!e.values.classes.includes(l.class_id)).map(l=>a.jsx(y,{value:l.class_id,name:l.class_name,children:l.class_name},l.class_name))}),a.jsx(q,{children:e.touched.classes&&e.errors.classes})]}),a.jsx(ae,{multiple:!0,options:S||[],getOptionLabel:l=>l.name,disableCloseOnSelect:!0,value:[],onChange:(l,d)=>{const p=[...e.values.sections];p[e.values.classes.length]=d,e.setFieldValue("sections",p)},sx:{gridColumn:"span 2"},renderInput:l=>a.jsx(m,{...l,variant:"filled",type:"text",name:`sections${e.values.classes.length+1}`,label:"Section"})})]},e.values.classes.length+1)]})]})})},ha=()=>{var ue,he,me,pe,ge;const[D,L]=o.useState("Create"),[H,v]=o.useState(!1),[h,T]=o.useState({schoolData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!0},bannerImageData:{values:null,validated:!0}}),[j,b]=o.useState(null),[S,B]=o.useState([]),[O,Y]=o.useState([]),[G,J]=o.useState([]),[Q,e]=o.useState([]),[N,l]=o.useState(!1),[d,p]=o.useState(!1),[c,g]=o.useState(!1),s=$(t=>t.allFormAmenities),x=$(t=>t.allFormClasses),_=$(t=>t.allFormSections),A=$(t=>t.menuItems.selected),K=$(t=>t.toastInfo),te=o.useRef(),se=o.useRef(),le=o.useRef(),re=o.useRef(),ne=ke(),C=Pe(),X=We(),oe=Ee(),xe=$e(oe.palette.mode),{typography:ie}=Ie(oe.palette.mode),{state:Z}=Le(),{getPaginatedData:_e}=Ke(),{createSchoolCode:Ce,customSort:je,createUniqueDataArray:ce,getLocalStorage:Se,getIdsFromObject:de,getValuesFromArray:Fe,toastAndNavigate:w}=Ve();let k=(Z==null?void 0:Z.id)||(X==null?void 0:X.id);o.useEffect(()=>{const t=Se("menu");C(Oe(t.selected))},[]);const De=o.useCallback(t=>{v(!0);const u=["/update-school","/update-address"],r=[{...t.schoolData.values,amenities:de(t.schoolData.values.amenities)},{...t.addressData.values}];F.CommonAPI.multipleAPICall("PATCH",u,r).then(n=>{let i=!0;n.forEach(f=>{f.data.status!=="Success"&&(i=!1)}),i&&(v(!1),w(C,!0,"info","Successfully Updated",ne,`/${A.toLowerCase()}/listing`)),v(!1)}).catch(n=>{var i,f;throw v(!1),w(C,!0,"error",(f=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:f.msg),n})},[h]),Be=t=>{v(!0);const u=[`/get-by-pk/school/${t}`,`/get-address/school/${t}`,`/get-school-classes/${t}`];F.CommonAPI.multipleAPICall("GET",u).then(r=>{var i,f,U,V,ve,fe;r[0].data.data&&(r[0].data.data.amenities=Fe((i=r[0].data.data)==null?void 0:i.amenities,(f=s==null?void 0:s.listData)==null?void 0:f.rows));const n={schoolData:{schoolData:r[0].data.data,selectedClass:(V=(U=r[2])==null?void 0:U.data)==null?void 0:V.data},addressData:(fe=(ve=r[1])==null?void 0:ve.data)==null?void 0:fe.data};b(n),v(!1)}).catch(r=>{var n,i;throw v(!1),w(C,!0,"error",(i=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:i.msg),r})},we=()=>{var r;let t,u;v(!0),h.schoolData.values={...h.schoolData.values,school_code:Ce(h.schoolData.values.name),amenities:de((r=h.schoolData.values)==null?void 0:r.amenities)},F.SchoolAPI.createSchool({...h.schoolData.values}).then(({data:n})=>{if((n==null?void 0:n.status)==="Success")return t=F.AddressAPI.createAddress({...h.addressData.values,school_id:n.data.id,parent_id:n.data.id,parent:"school"}),u=h.schoolData.values.sections.map((i,f)=>{const U=h.schoolData.values.classes[f]||0;i.map(V=>{F.SchoolAPI.insertIntoMappingTable([n.data.id,U,V.id])})}),Promise.all([t,u]).then(i=>{v(!1),w(C,!0,"success","Successfully Created")}).catch(i=>{throw v(!1),w(C,!0,i||"An Error Occurred"),i})}).catch(n=>{var i,f;throw v(!1),w(C,!0,"error",(f=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:f.msg),n})};o.useEffect(()=>{var t,u;(u=(t=s==null?void 0:s.listData)==null?void 0:t.rows)!=null&&u.length||_e(0,50,Je,F.AmenityAPI)},[(he=(ue=s==null?void 0:s.listData)==null?void 0:ue.rows)==null?void 0:he.length]),o.useEffect(()=>{var t,u;(!((t=x==null?void 0:x.listData)!=null&&t.length)||!((u=_==null?void 0:_.listData)!=null&&u.length))&&F.SchoolAPI.getSchoolClasses(5).then(r=>{if(r.status==="Success"){r.data.sort(je);const n=ce(r.data,"class_id","class_name");C(Ne(n));const i=ce(r.data,"id","name");C(Qe(i))}}).catch(r=>{console.log("Error Fetching ClassData:",r)})},[x.listData.length,_.listData.length]),o.useEffect(()=>{var t,u,r;k&&!d&&((u=(t=s==null?void 0:s.listData)==null?void 0:t.rows)!=null&&u.length)&&(L("Update"),Be(k)),h.schoolData.validated&&h.addressData.validated?(r=h.schoolData.values)!=null&&r.id?De(h):we():p(!1)},[k,d,(pe=(me=s==null?void 0:s.listData)==null?void 0:me.rows)==null?void 0:pe.length]);const Te=async()=>{await te.current.Submit(),await se.current.Submit(),await le.current.Submit(),await re.current.Submit(),p(!0)},M=(t,u)=>{u==="school"?T({...h,schoolData:t}):u==="address"?T({...h,addressData:t}):u==="display"?T({...h,imageData:t}):u==="banner"&&T({...h,bannerImageData:t})};return a.jsxs(I,{m:"10px",children:[a.jsx(Me,{fontFamily:ie.fontFamily,fontSize:ie.h2.fontSize,color:xe.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${D} ${A}`}),a.jsx(aa,{onChange:t=>{M(t,"school")},refId:te,setDirty:l,reset:c,setReset:g,schoolId:k,amenities:(ge=s==null?void 0:s.listData)==null?void 0:ge.rows,classesInRedux:x==null?void 0:x.listData,sectionsInRedux:_==null?void 0:_.listData,updatedValues:j==null?void 0:j.schoolData}),a.jsx(qe,{onChange:t=>{M(t,"address")},refId:se,update:!!k,setDirty:l,reset:c,setReset:g,updatedValues:j==null?void 0:j.addressData}),a.jsx(be,{onChange:t=>M(t,"display"),refId:le,reset:c,setReset:g,setDirty:l,preview:O,setPreview:Y,deletedImage:S,setDeletedImage:B,imageType:"Display"},"image"),a.jsx(be,{onChange:t=>M(t,"banner"),refId:re,reset:c,setReset:g,setDirty:l,preview:Q,setPreview:e,deletedImage:G,setDeletedImage:J,imageType:"Banner"},"banner"),a.jsxs(I,{display:"flex",justifyContent:"end",m:"20px",children:[D==="Update"?null:a.jsx(ee,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!N||d,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&g(!0)},children:"Reset"}),a.jsx(ee,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>ne(`/${A.toLowerCase()}/listing`),children:"Cancel"}),a.jsx(ee,{type:"submit",onClick:()=>Te(),disabled:!N,color:D==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(Ue,{alerting:K.toastAlert,severity:K.toastSeverity,message:K.toastMessage})]}),H===!0?a.jsx(He,{}):null]})};export{ha as default};
