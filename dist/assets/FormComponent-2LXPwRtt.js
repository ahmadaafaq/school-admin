import{q as le,s as k,P as f,a as r,l as K,w as ae,h as X,K as ie,R as de,ah as ue,A as D,j as s,B as Q,p as J,z as R,ai as ce,a7 as he,aj as me,ak as pe,C as q,I as z,S as V,E as H,M as G,N as ee,U as te,v as ge,O as fe,u as xe,t as ve,k as be,x as Ce,y as we,m as se,T as je,H as ye,J as Se}from"./index-zLCHO5gj.js";import{A as Ae}from"./AddressFormComponent-A6w5Bv7O.js";import{s as ke}from"./UserRoleAction-wUt_c9OB.js";const De=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Ie=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,Fe=le().shape({username:k().min(2,"Username is Too Short!").max(50,"Username is Too Long!").required("This Field is Required"),password:k().min(8,"Password Must Be 8 Characters Long").matches(/[A-Z]/,"Password Must Contain At Least 1 Uppercase Letter").matches(/[a-z]/,"Password Must Contain At Least 1 Lowercase Letter").matches(/[0-9]/,"Password Must Contain At Least 1 Number").matches(/[^\w]/,"Password Must Contain At Least 1 Special Character").required("This Field is Required"),email:k().matches(Ie,"Email Address is Not Valid"),contact_no:k().matches(De,"Phone Number Is Not Valid").required("This Field is Required"),gender:k(),status:k()}),Pe={school_id:"",username:"",password:"",email:"",contact_no:"",designation:"",role:"",gender:"",status:"active"},re=({onChange:B,refId:S,setDirty:Y,reset:L,setReset:u,schoolId:i,userId:I,rolePriority:p,updatedValues:F=null})=>{var _,C,N;const[w,P]=r.useState(!1),[j,A]=r.useState({clicked:!1,password:null}),[M,E]=r.useState(Pe),[$,T]=r.useState(null),c=K(a=>a.allSchools),h=K(a=>a.allUserRoles),g=ae(),x=X("(min-width:600px)"),v=X("(max-width:480px)"),m=document.getElementById("pwField"),{fetchAndSetAll:W}=te(),e=ie({initialValues:M,validationSchema:Fe,enableReinitialize:!0,onSubmit:()=>U()});de.useImperativeHandle(S,()=>({Submit:async()=>{await e.submitForm()}}));const U=()=>{B&&(m.disabled&&delete e.values.password,B({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1}))};r.useEffect(()=>{L&&(e.resetForm(),u(!1))},[L]),r.useEffect(()=>{e.dirty&&Y(!0)},[e.dirty]),r.useEffect(()=>{F&&(E(F),m.setAttribute("disabled",!0),m.style.backgroundColor="#777",A({clicked:!0}))},[F]),r.useEffect(()=>{var a;!((a=c==null?void 0:c.listData)!=null&&a.length)&&p===1&&W(g,ue,D.SchoolAPI)},[c==null?void 0:c.listData]),r.useEffect(()=>{var a;(a=h==null?void 0:h.listData)!=null&&a.length||W(g,ke,D.UserRoleAPI)},[(_=h==null?void 0:h.listData)==null?void 0:_.length]);const b=()=>{j.clicked?(m.removeAttribute("disabled"),m.style.backgroundColor="rgba(255, 255, 255, 0.09)",m.focus(),A({clicked:!1,password:e.values.password}),e.values.password=""):(m.setAttribute("disabled",!0),m.style.backgroundColor="#777",A({clicked:!0}),e.values.password=j.password)};return console.log("school",i),r.useEffect(()=>{i&&e.setFieldValue("school_id",i)},[i]),s.jsxs(Q,{m:"20px",children:[I?s.jsxs(J,{type:"button",color:"primary",variant:"contained",sx:{position:v?"relative":"absolute",right:v?"0":30,top:v?98:110,zIndex:v?1:0},onClick:b,children:[j.clicked===!0?"Update":"Cancel Update"," ","Password"," "]}):null,s.jsx("form",{ref:S,children:s.jsxs(Q,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:x?void 0:"span 4"}},children:[s.jsx(R,{fullWidth:!0,variant:"filled",type:"text",name:"username",label:"Username*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.username,error:!!e.touched.username&&!!e.errors.username,helperText:e.touched.username&&e.errors.username,sx:{gridColumn:"span 2"}}),s.jsx(R,{fullWidth:!0,variant:"filled",id:"pwField",label:"Password*",name:"password",type:w?"text":"password",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.password,error:!!e.touched.password&&!!e.errors.password,helperText:e.touched.password&&e.errors.password,sx:{gridColumn:"span 2"},InputProps:{endAdornment:s.jsx(ce,{position:"end",children:s.jsx(he,{"aria-label":"toggle password visibility",onClick:()=>P(!w),onMouseDown:()=>P(!w),children:w?s.jsx(me,{}):s.jsx(pe,{})})})}}),s.jsx(R,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),s.jsx(R,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),s.jsx(R,{fullWidth:!0,variant:"filled",type:"text",label:"Designation",name:"designation",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.designation,error:!!e.touched.designation&&!!e.errors.designation,helperText:e.touched.designation&&e.errors.designation}),s.jsxs(q,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[s.jsx(z,{children:"Gender"}),s.jsx(V,{variant:"filled",name:"gender",value:e.values.gender,onChange:e.handleChange,children:Object.keys(H.gender).map(a=>s.jsx(G,{value:a,children:H.gender[a]},a))}),s.jsx(ee,{children:e.touched.gender&&e.errors.gender})]}),(C=c==null?void 0:c.listData)!=null&&C.length?s.jsxs(q,{variant:"filled",sx:{minWidth:120},error:!!e.touched.school_id&&!!e.errors.school_id,children:[s.jsx(z,{id:"schoolField",children:"School"}),s.jsx(V,{variant:"filled",labelId:"schoolField",label:"School",name:"school_id",disabled:!!(i&&I),value:e.values.school_id,onChange:a=>{const O=a.target.value;T(O),e.setFieldValue("school_id",O)},children:c.listData.map(a=>s.jsx(G,{value:a.id,name:a.name,children:a.name},a.id))})]}):null,s.jsxs(q,{variant:"filled",sx:{minWidth:120},error:!!e.touched.role&&!!e.errors.role,children:[s.jsx(z,{id:"roleField",children:"Role"}),s.jsx(V,{variant:"filled",labelId:"roleField",label:"role",name:"role",value:e.values.role,onChange:e.handleChange,children:p===2&&!((N=h==null?void 0:h.listData)!=null&&N.length)?null:h.listData.filter(a=>a.id>p&&a.id<4).map(a=>s.jsx(G,{value:a.id,name:a.name,children:a.name.charAt(0).toUpperCase()+a.name.slice(1)},a.name))})]}),s.jsxs(q,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[s.jsx(z,{children:"Status"}),s.jsx(V,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(H.status).map(a=>s.jsx(G,{value:a,children:H.status[a]},a))}),s.jsx(ee,{children:e.touched.status&&e.errors.status})]})]})})]})};re.propTypes={onChange:f.func,refId:f.shape({current:f.any}),setDirty:f.func,reset:f.bool,setReset:f.func,userId:f.number,rolePriority:f.number,updatedValues:f.object};const Ee=({rolePriority:B})=>{const[S,Y]=r.useState("Create"),[L,u]=r.useState(!1),[i,I]=r.useState({userData:{values:null,validated:!1},addressData:{values:null,validated:!1}}),[p,F]=r.useState(null),[w,P]=r.useState(!1),[j,A]=r.useState(!1),[M,E]=r.useState(!1),$=K(t=>t.menuItems.selected),T=K(t=>t.toastInfo),c=r.useRef(),h=r.useRef(),g=ge(),x=ae(),v=fe(),m=xe(),W=ve(m.palette.mode),{typography:e}=be(m.palette.mode),{state:U}=Ce(),{toastAndNavigate:b,getLocalStorage:_}=te();let C=(U==null?void 0:U.id)||(v==null?void 0:v.id);const N=_("auth").id;r.useEffect(()=>{const t=_("menu");x(we(t.selected))},[]);const a=r.useCallback(t=>{const l=[{...t.userData.values},{...t.addressData.values}],n=["/update-user","/update-address"];u(!0),t.userData.password||delete t.userData.password,D.CommonAPI.multipleAPICall("PATCH",n,l).then(o=>{let d=!0;o.forEach(y=>{y.data.status!=="Success"&&(d=!1)}),d&&(u(!1),b(x,!0,"info","Successfully Updated",g,`/${$.toLowerCase()}/listing`)),u(!1)}).catch(o=>{var d,y;u(!1),b(x,!0,"error",o?(y=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:y.msg:"An Error Occurred",g,0),console.log("Error in user update",o)})},[i]),O=r.useCallback(t=>{u(!0);const l=[`/get-by-pk/user/${t}`,`/get-address/user/${t}`];D.CommonAPI.multipleAPICall("GET",l).then(n=>{var d,y;const o={userData:n[0].data.data,addressData:(y=(d=n[1])==null?void 0:d.data)==null?void 0:y.data};F(o),u(!1)}).catch(n=>{var o,d;u(!1),b(x,!0,"error",n?(d=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:d.msg:"An Error Occurred",g,0),console.log("Error in user populate",n)})},[]),ne=r.useCallback(t=>{u(!0),D.UserAPI.register({...t.userData.values}).then(({data:l})=>{(l==null?void 0:l.status)==="Success"&&D.AddressAPI.createAddress({...t.addressData.values,parent_id:l.data.id,parent:"user"}).then(()=>{u(!1),b(x,!0,"success","Successfully Created",g,"/user/listing")}).catch(n=>{var o,d;u(!1),b(x,!0,"error",n?(d=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:d.msg:"An Error Occurred",g,0),console.log("Error in user create",n)})}).catch(l=>{var n,o;u(!1),b(x,!0,"error",l?(o=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:o.msg:"An Error Occurred",g,0),console.log("Error in user create",l)})},[]);r.useEffect(()=>{var t;C&&!j&&(Y("Update"),O(C)),i.userData.validated&&i.addressData.validated?(t=i.userData.values)!=null&&t.id?a(i):ne(i):A(!1)},[C,j]);const oe=async()=>{await c.current.Submit(),await h.current.Submit(),A(!0)},Z=(t,l)=>{I(l==="user"?{...i,userData:t}:{...i,addressData:t})};return s.jsxs(Q,{m:"10px",sx:{backgroundImage:m.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${se})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${se})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed"},children:[s.jsx(je,{fontFamily:e.fontFamily,fontSize:e.h2.fontSize,color:W.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${S} ${$}`}),s.jsx(re,{onChange:t=>{Z(t,"user")},refId:c,setDirty:P,reset:M,schoolId:N,setReset:E,userId:C,rolePriority:B,updatedValues:p==null?void 0:p.userData}),s.jsx(Ae,{onChange:t=>{Z(t,"address")},refId:h,update:!!C,setDirty:P,reset:M,setReset:E,updatedValues:p==null?void 0:p.addressData}),s.jsxs(Q,{display:"flex",justifyContent:"end",m:"20px",children:[S==="Update"?null:s.jsx(J,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!w||j,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&E(!0)},children:"Reset"}),s.jsx(J,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>g(`/${$.toLowerCase()}/listing`),children:"Cancel"}),s.jsx(J,{type:"submit",onClick:()=>oe(),disabled:!w,color:S==="Update"?"info":"success",variant:"contained",children:"Submit"}),s.jsx(ye,{alerting:T.toastAlert,severity:T.toastSeverity,message:T.toastMessage})]}),L===!0?s.jsx(Se,{}):null]})};Ee.propTypes={rolePriority:f.number};export{Ee as default};
