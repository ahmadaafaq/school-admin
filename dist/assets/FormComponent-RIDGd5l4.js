import{q as Q,s as X,P as h,a as s,h as Z,K as ee,R as te,j as t,B as S,z as E,C as ae,I as se,S as ie,E as N,M as oe,N as re,l as Y,v as le,w as ne,O as de,u as ce,t as ue,k as pe,x as he,y as me,A as w,m as $,T as fe,p as M,H as xe,J as be,U as ge}from"./index-zLCHO5gj.js";import{d as L}from"./dayjs.min-BIwqZoVS.js";import{a as ye,A as ve}from"./useMobilePicker-jp2tUA7Z.js";import{D as U}from"./DatePicker-ZpOXrT1U.js";const Ce=Q().shape({status:X()}),Se={title:"",description:"",publish_date:"",expiry_date:"",status:"active"},q=({onChange:u,refId:y,setDirty:j,reset:l,setReset:d,updatedValues:m=null})=>{const[f,D]=s.useState(Se),v=Z("(min-width:600px)"),e=ee({initialValues:f,validationSchema:Ce,enableReinitialize:!0,onSubmit:()=>x()});te.useImperativeHandle(y,()=>({Submit:async()=>{await e.submitForm()}}));const x=()=>{u&&u({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return s.useEffect(()=>{l&&(e.resetForm(),d(!1))},[l]),s.useEffect(()=>{e.dirty&&j(!0)},[e.dirty]),s.useEffect(()=>{m&&D(m)},[m]),t.jsx(S,{m:"20px",children:t.jsx("form",{ref:y,children:t.jsxs(S,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:v?void 0:"span 4"}},children:[t.jsx(E,{fullWidth:!0,variant:"filled",type:"text",name:"title",label:"Title",autoComplete:"new-title",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.title,error:!!e.touched.title&&!!e.errors.title,helperText:e.touched.title&&e.errors.title}),t.jsxs(ye,{dateAdapter:ve,children:[t.jsx(U,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Publish Date",name:"publish_date",value:e.values.publish_date,onChange:n=>e.setFieldValue("publish_date",n),slotProps:{textField:{error:!!e.touched.publish_date&&!!e.errors.publish_date,helperText:e.touched.publish_date&&e.errors.publish_date}}}),t.jsx(U,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Expiry Date",name:"expiry_date",value:e.values.expiry_date,onChange:n=>e.setFieldValue("expiry_date",n),slotProps:{textField:{error:!!e.touched.expiry_date&&!!e.errors.expiry_date,helperText:e.touched.expiry_date&&e.errors.expiry_date}}})]}),t.jsxs(ae,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[t.jsx(se,{children:"Status"}),t.jsx(ie,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(N.status).map(n=>t.jsx(oe,{value:n,children:N.status[n]},n))}),t.jsx(re,{children:e.touched.status&&e.errors.status})]}),t.jsx(E,{fullWidth:!0,variant:"filled",type:"text",label:"Description",name:"description",autoComplete:"new-description",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.description,error:!!e.touched.description&&!!e.errors.description,helperText:e.touched.description&&e.errors.description,sx:{gridColumn:"span 4",gridRow:"span 2"}})]})})})};q.propTypes={onChange:h.func.isRequired,refId:h.any.isRequired,setDirty:h.func.isRequired,reset:h.func.isRequired,setReset:h.func.isRequired,updatedValues:h.object};const Fe=()=>{const[u,y]=s.useState("Create"),[j,l]=s.useState(!1),[d,m]=s.useState({noticeboardData:{values:null,validated:!1},imageData:{values:null,validated:!0}}),[f,D]=s.useState(null),[v,e]=s.useState(!1),[x,n]=s.useState(!1),[z,P]=s.useState(!1),W=Y(a=>a.menuItems.selected),k=Y(a=>a.toastInfo),A=s.useRef(),_=le(),p=ne(),F=de(),T=ce(),H=ue(T.palette.mode),{typography:B}=pe(T.palette.mode),{state:I}=he(),{toastAndNavigate:b,getLocalStorage:R}=ge();let g=(I==null?void 0:I.id)||(F==null?void 0:F.id);s.useEffect(()=>{const a=R("menu");p(me(a.selected))},[]);const O=s.useCallback(a=>{const o=[{...a.noticeboardData.values}],i=["/update-notice"];l(!0),w.CommonAPI.multipleAPICall("PATCH",i,o).then(r=>{let c=!0;r.forEach(C=>{C.data.status!=="Success"&&(c=!1)}),c&&(l(!1),b(p,!0,"info","Successfully Updated",_,`/noticeboard/listing/${R("class")||""}`)),l(!1)}).catch(r=>{var c,C;throw l(!1),b(p,!0,"error",(C=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:C.msg),r})},[d]),V=s.useCallback(a=>{l(!0);const o=[`/get-by-pk/noticeboard/${a}`];w.CommonAPI.multipleAPICall("GET",o).then(i=>{i[0].data.data&&(i[0].data.data.publish_date=L(i[0].data.data.publish_date),i[0].data.data.expiry_date=L(i[0].data.data.expiry_date));const r={noticeboardData:i[0].data.data};D(r),l(!1)}).catch(i=>{var r,c;throw l(!1),b(p,!0,"error",(c=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:c.msg),i})},[g]),G=s.useCallback(a=>{l(!0),w.NoticeBoardAPI.createNoticeBoard({...a.noticeboardData.values}).then(({data:o})=>{(o==null?void 0:o.status)==="Success"&&(l(!1),b(p,!0,"success","Successfully Created",_,"/noticeboard/listing"))}).catch(o=>{var i,r;throw l(!1),b(p,!0,"error",(r=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:r.msg),o})},[d]);s.useEffect(()=>{var a;g&&!x&&(y("Update"),V(g)),d.noticeboardData.validated?(a=d.noticeboardData.values)!=null&&a.id?O(d):G(d):n(!1)},[g,x]);const J=async()=>{await A.current.Submit(),n(!0)},K=(a,o)=>{o==="noticeboard"&&m({...d,noticeboardData:a})};return t.jsxs(S,{m:"10px",sx:{backgroundImage:T.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${$})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${$})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed"},children:[t.jsx(fe,{fontFamily:B.fontFamily,fontSize:B.h2.fontSize,color:H.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${u} ${W}`}),t.jsx(q,{onChange:a=>{K(a,"noticeboard")},refId:A,setDirty:e,reset:z,setReset:P,userId:g,updatedValues:f==null?void 0:f.noticeboardData}),t.jsxs(S,{display:"flex",justifyContent:"end",m:"20px",children:[u==="Update"?null:t.jsx(M,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!v||x,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&P(!0)},children:"Reset"}),t.jsx(M,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>_(`/noticeboard/listing/${R("class")||""}`),children:"Cancel"}),t.jsx(M,{type:"submit",onClick:()=>J(),disabled:!v,color:u==="Update"?"info":"success",variant:"contained",children:"Submit"}),t.jsx(xe,{alerting:k.toastAlert,severity:k.toastSeverity,message:k.toastMessage})]}),j===!0?t.jsx(be,{}):null]})};export{Fe as default};
