import{ab as O,aa as q,ac as D,_ as T,a as i,ad as Y,d as X,j as t,b as G,ae as J,al as xe,q as De,s as oe,Y as Ne,P as S,l as z,w as we,h as de,x as pe,K as He,R as Ie,A as U,B as ue,C as B,I as $,S as L,M as V,N as W,E as A,z as ie,H as Fe,U as me,X as Ee,u as Re,t as Me,o as Pe,v as Be,k as Le,y as Ve,D as We,m as be,T as ge,G as Ue,p as ce,J as ze}from"./index-zLCHO5gj.js";import{s as Oe}from"./PaymentMethodAction-X7E_0a2C.js";import{u as qe}from"./index-mkkoW40k.js";import{T as Ye,a as he,b as x}from"./TableCell-yZ9kbJpi.js";function Xe(a){return O("MuiTable",a)}q("MuiTable",["root","stickyHeader"]);const Ge=["className","component","padding","size","stickyHeader"],Je=a=>{const{classes:n,stickyHeader:r}=a;return J({root:["root",r&&"stickyHeader"]},Xe,n)},Ke=D("table",{name:"MuiTable",slot:"Root",overridesResolver:(a,n)=>{const{ownerState:r}=a;return[n.root,r.stickyHeader&&n.stickyHeader]}})(({theme:a,ownerState:n})=>T({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":T({},a.typography.body2,{padding:a.spacing(2),color:(a.vars||a).palette.text.secondary,textAlign:"left",captionSide:"bottom"})},n.stickyHeader&&{borderCollapse:"separate"})),ve="table",Qe=i.forwardRef(function(n,r){const l=Y({props:n,name:"MuiTable"}),{className:m,component:c=ve,padding:y="normal",size:d="medium",stickyHeader:h=!1}=l,f=X(l,Ge),o=T({},l,{component:c,padding:y,size:d,stickyHeader:h}),g=Je(o),u=i.useMemo(()=>({padding:y,size:d,stickyHeader:h}),[y,d,h]);return t.jsx(Ye.Provider,{value:u,children:t.jsx(Ke,T({as:c,role:c===ve?null:"table",ref:r,className:G(g.root,m),ownerState:o},f))})}),Ze=Qe;function et(a){return O("MuiTableBody",a)}q("MuiTableBody",["root"]);const tt=["className","component"],at=a=>{const{classes:n}=a;return J({root:["root"]},et,n)},st=D("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(a,n)=>n.root})({display:"table-row-group"}),ot={variant:"body"},_e="tbody",nt=i.forwardRef(function(n,r){const l=Y({props:n,name:"MuiTableBody"}),{className:m,component:c=_e}=l,y=X(l,tt),d=T({},l,{component:c}),h=at(d);return t.jsx(he.Provider,{value:ot,children:t.jsx(st,T({className:G(h.root,m),as:c,ref:r,role:c===_e?null:"rowgroup",ownerState:d},y))})}),rt=nt;function lt(a){return O("MuiTableContainer",a)}q("MuiTableContainer",["root"]);const it=["className","component"],ct=a=>{const{classes:n}=a;return J({root:["root"]},lt,n)},dt=D("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(a,n)=>n.root})({width:"100%",overflowX:"auto"}),ut=i.forwardRef(function(n,r){const l=Y({props:n,name:"MuiTableContainer"}),{className:m,component:c="div"}=l,y=X(l,it),d=T({},l,{component:c}),h=ct(d);return t.jsx(dt,T({ref:r,as:c,className:G(h.root,m),ownerState:d},y))}),pt=ut;function mt(a){return O("MuiTableHead",a)}q("MuiTableHead",["root"]);const ht=["className","component"],ft=a=>{const{classes:n}=a;return J({root:["root"]},mt,n)},yt=D("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(a,n)=>n.root})({display:"table-header-group"}),xt={variant:"head"},je="thead",bt=i.forwardRef(function(n,r){const l=Y({props:n,name:"MuiTableHead"}),{className:m,component:c=je}=l,y=X(l,ht),d=T({},l,{component:c}),h=ft(d);return t.jsx(he.Provider,{value:xt,children:t.jsx(yt,T({as:c,className:G(h.root,m),ref:r,role:c===je?null:"rowgroup",ownerState:d},y))})}),gt=bt;function vt(a){return O("MuiTableRow",a)}const _t=q("MuiTableRow",["root","selected","hover","head","footer"]),Te=_t,jt=["className","component","hover","selected"],Tt=a=>{const{classes:n,selected:r,hover:l,head:m,footer:c}=a;return J({root:["root",r&&"selected",l&&"hover",m&&"head",c&&"footer"]},vt,n)},Ct=D("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(a,n)=>{const{ownerState:r}=a;return[n.root,r.head&&n.head,r.footer&&n.footer]}})(({theme:a})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${Te.hover}:hover`]:{backgroundColor:(a.vars||a).palette.action.hover},[`&.${Te.selected}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / ${a.vars.palette.action.selectedOpacity})`:xe(a.palette.primary.main,a.palette.action.selectedOpacity),"&:hover":{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:xe(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity)}}})),Ce="tr",St=i.forwardRef(function(n,r){const l=Y({props:n,name:"MuiTableRow"}),{className:m,component:c=Ce,hover:y=!1,selected:d=!1}=l,h=X(l,jt),f=i.useContext(he),o=T({},l,{component:c,hover:y,selected:d,head:f&&f.variant==="head",footer:f&&f.variant==="footer"}),g=Tt(o);return t.jsx(Ct,T({as:c,ref:r,className:G(g.root,m),role:c===Ce?null:"row",ownerState:o},h))}),ke=St,wt=De().shape({academic_year:oe().min(2,"Year is Too Short!").max(12,"Year is Too Long!").required("This Field is Required"),fee:oe().required("This Field is Required"),type:oe().required("This Field is Required"),method:oe().required("This Field is Required"),amount:Ne().required("This Field is Required")}),Ft={student_id:"",method:"",fee:"",type:"",type_duration:"",academic_year:"",amount:"",final_amount:"",discount_percent:"",late_fee:"",class_fee_by_mapping:"",current_date:null},$e=({onChange:a,refId:n,setDirty:r,reset:l,setReset:m,updatedValues:c=null})=>{const[y,d]=i.useState(Ft),[h,f]=i.useState([]),[o,g]=i.useState([]),u=z(s=>s.allPaymentMethods),F=z(s=>s.toastInfo),ne=we(),K=de("(min-width:600px)"),{state:C}=pe(),{createDivider:N,createDropdown:Q,createSchoolFee:H,createSession:I,fetchAndSetAll:Z,findMultipleById:ee}=me(),R=C==null?void 0:C.id,b=C==null?void 0:C.cls,w=C==null?void 0:C.section,e=He({initialValues:y,validationSchema:wt,enableReinitialize:!0,onSubmit:()=>te()});Ie.useImperativeHandle(n,()=>({Submit:async()=>{await e.submitForm()}}));const te=()=>{a&&a({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};let M=Math.ceil(e.values.amount-e.values.amount*e.values.discount_percent/100+e.values.late_fee);const _=e.values.type,re=()=>{if(_!=="annually")return t.jsxs(B,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type_duration&&!!e.errors.type_duration,children:[t.jsx($,{children:"Period"}),t.jsx(L,{name:"type_duration",variant:"filled",value:e.values.type_duration,onChange:s=>e.setFieldValue("type_duration",s.target.value),children:Q(N(_),o==null?void 0:o.session_start).map((s,v)=>t.jsx(V,{value:s,children:s},v))}),t.jsxs(W,{children:[" ",e.touched.type_duration&&e.errors.type_duration," "]})]})};return i.useEffect(()=>{l&&(e.resetForm(),m(!1))},[l]),i.useEffect(()=>{e.dirty&&r(!0)},[e.dirty]),i.useEffect(()=>{c&&d(c)},[c]),i.useEffect(()=>{var s;(s=u==null?void 0:u.listData)!=null&&s.length||Z(ne,Oe,U.PaymentMethodAPI)},[]),i.useEffect(()=>{U.PaymentAPI.getPaymentData(b,w).then(({data:s})=>{s.status==="Success"&&(console.log(s.data,"response"),g(...s.data))}).catch(s=>{console.log("error occured in getPaymentData api",s)})},[]),i.useEffect(()=>{U.SchoolAPI.getSchoolClasses().then(s=>{const v=s.data.filter(p=>p.class_id===b&&p.section_id===w);e.setFieldValue("class_fee_by_mapping",...v)}).catch(s=>{console.log("error occured in school mapping api",s)})},[]),i.useEffect(()=>{var s,v;e.values.fee==="school"&&_!=="annually"?e.setFieldValue("amount",H(N(_),(s=e.values.class_fee_by_mapping)==null?void 0:s.class_fee)):e.values.fee==="school"&&_==="annually"&&e.setFieldValue("amount",H(N(_),(v=e.values.class_fee_by_mapping)==null?void 0:v.class_fee))},[e.values.fee,_]),i.useEffect(()=>{e.setFieldValue("student_id",R)},[R]),i.useEffect(()=>{(v=>{var E;let p=0;if(o){const P=new Date;e.setFieldValue("current_date",P);let k;const j=P.getFullYear();v?(k=A.months.indexOf(v),v.includes("-")&&(k=A.months.indexOf(v.split("-")[0].trim()))):k=P.getMonth();const ae=new Date(j,k,o==null?void 0:o.payment_date).getTime(),se=P.getTime()-ae,fe=((E=e.values.academic_year)==null?void 0:E.split("-")[1])||j,Ae=ee(o==null?void 0:o.payment_methods,u==null?void 0:u.listData);if(f(Ae),se>0&&fe==j)switch(o==null?void 0:o.late_fee_duration){case"per_day":{p=Math.floor(se/864e5)*(o==null?void 0:o.classLateFee);break}case"per_week":{p=Math.floor(se/6048e5)*(o==null?void 0:o.classLateFee);break}case"per_month":{p=Math.floor(se/2592e6)*(o==null?void 0:o.classLateFee);break}}else fe>j&&(p=0);e.values.fee==="school"?e.setFieldValue("late_fee",p):(e.setFieldValue("late_fee",0),e.setFieldValue("type_duration",""),e.setFieldValue("type",""),e.setFieldValue("amount",""))}else e.setFieldValue("late_fee",p)})(e.values.type_duration)},[o,e.values.fee,e.values.type_duration,e.values.academic_year]),i.useEffect(()=>{M&&e.setFieldValue("final_amount",M)},[M]),t.jsx(ue,{m:"20px",children:t.jsxs("form",{ref:n,children:[t.jsxs(ue,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:K?void 0:"span 4"}},children:[t.jsxs(B,{variant:"filled",sx:{minWidth:120},error:!!e.touched.academic_year&&!!e.errors.academic_year,children:[t.jsx($,{children:"Session*"}),t.jsx(L,{variant:"filled",name:"academic_year",value:e.values.academic_year,onChange:s=>e.setFieldValue("academic_year",s.target.value),children:I().map(s=>t.jsx(V,{value:s,name:s,children:s},s))}),t.jsx(W,{children:e.touched.academic_year&&e.errors.academic_year})]}),t.jsxs(B,{variant:"filled",sx:{minWidth:120},error:!!e.touched.fee&&!!e.errors.fee,children:[t.jsx($,{children:"Fee*"}),t.jsx(L,{name:"fee",variant:"filled",value:e.values.fee,onChange:e.handleChange,children:Object.keys(A.fee).map(s=>t.jsx(V,{value:s,children:A.fee[s]},s))}),t.jsxs(W,{children:[" ",e.touched.fee&&e.errors.fee," "]})]}),t.jsxs(B,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type&&!!e.errors.type,children:[t.jsx($,{children:"Type*"}),t.jsx(L,{name:"type",variant:"filled",value:e.values.type,onChange:s=>{e.setFieldValue("type",s.target.value),e.setFieldValue("type_duration","")},children:Object.keys(A.payment_type).map(s=>t.jsx(V,{value:s,children:A.payment_type[s]},s))}),t.jsxs(W,{children:[" ",e.touched.type&&e.errors.type," "]})]}),e.values.type&&re(),t.jsx(ie,{fullWidth:!0,variant:"filled",type:"number",name:"amount",label:"Amount*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.amount,error:!!e.touched.amount&&!!e.errors.amount,helperText:e.touched.amount&&e.errors.amount}),t.jsxs(B,{variant:"filled",sx:{minWidth:120},error:!!e.touched.method&&!!e.errors.method,children:[t.jsx($,{children:"Payment Method*"}),t.jsx(L,{variant:"filled",name:"method",value:e.values.method,onChange:s=>e.setFieldValue("method",s.target.value),children:h!=null&&h.length?h.map(s=>t.jsx(V,{value:s.id,name:s.name,children:s.name},s.id)):null}),t.jsx(W,{children:e.touched.method&&e.errors.method})]}),t.jsx(ie,{fullWidth:!0,variant:"filled",type:"number",label:"Late Fees",name:"late_fee",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.late_fee,error:!!e.touched.late_fee&&!!e.errors.late_fee,helperText:e.touched.late_fee&&e.errors.late_fee}),t.jsx(ie,{fullWidth:!0,variant:"filled",type:"number",label:"Discount Percent",name:"discount_percent",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.discount_percent,error:!!e.touched.discount_percent&&!!e.errors.discount_percent,helperText:e.touched.discount_percent&&e.errors.discount_percent}),t.jsxs($,{sx:{fontWeight:"600",fontSize:"16px",justifySelf:"center"},children:["Final Payment: ₹ ",M+" INR."]})]}),t.jsx(Fe,{alerting:F.toastAlert,severity:F.toastSeverity,message:F.toastMessage})]})})};$e.propTypes={onChange:S.func,refId:S.shape({current:S.any}),setDirty:S.func,reset:S.bool,setReset:S.func,updatedValues:S.object};const Rt=a=>({type:Ee.SET_PAYMENTS,payload:a}),Se=D(ke)(({theme:a})=>({"&:nth-of-type(odd)":{backgroundColor:a.palette.action.hover},"&:last-child td, &:last-child th":{border:0}})),Mt=()=>{var g;const a=z(u=>u.allPayments),n=Re(),r=Me(n.palette.mode),{state:l}=pe(),{capitalizeEveryWord:m,formatDate:c}=me(),{getPaginatedData:y}=qe(),d=l==null?void 0:l.id;let h=d?{studentId:d}:null;const f={border:`2px solid ${r.whiteAccent[500]}`,color:r.whiteAccent[800],fontSize:"16px",textAlign:"center"},o={border:`2px solid ${r.whiteAccent[500]}`,fontSize:"14px",textAlign:"center"};return i.useEffect(()=>{y(0,50,Rt,U.PaymentAPI,h)},[]),console.log("outside payment data table",h),t.jsx(pt,{component:Pe,sx:{width:"98%",margin:"10px auto"},children:t.jsxs(Ze,{sx:{minWidth:700,letterSpacing:"1px"},"aria-label":"customized table",children:[t.jsx(gt,{children:t.jsxs(ke,{sx:{backgroundColor:r.redAccent[300]},children:[t.jsx(x,{sx:f,children:"Session"}),t.jsx(x,{sx:[f,{backgroundColor:r.redAccent[200]}],children:"Fee"}),t.jsx(x,{sx:f,children:"Method"}),t.jsx(x,{sx:[f,{backgroundColor:r.redAccent[200]}],children:"Type"}),t.jsx(x,{sx:f,children:"Period"}),t.jsx(x,{sx:[f,{backgroundColor:r.redAccent[200]}],children:"Discount"}),t.jsx(x,{sx:f,children:"Amount"}),t.jsx(x,{sx:[f,{backgroundColor:r.redAccent[200]}],children:"Date"})]})}),t.jsx(rt,{children:(g=a==null?void 0:a.listData)!=null&&g.length?a.listData.map(u=>t.jsxs(Se,{children:[t.jsxs(x,{component:"th",scope:"row",sx:o,children:[" ",u.academic_year," "]}),t.jsx(x,{sx:o,children:m(u.fee)}),t.jsx(x,{sx:o,children:m(u.methodName)}),t.jsx(x,{sx:o,children:m(u.type)}),t.jsx(x,{sx:o,children:u.type_duration}),t.jsxs(x,{sx:o,children:[" ",u.discount_percent,"% "]}),t.jsxs(x,{sx:o,children:["₹ ",u.final_amount]}),t.jsx(x,{sx:o,children:c(u.created_at)})]},u.id)):t.jsx(Se,{children:t.jsx(x,{component:"th",scope:"row",colSpan:8,sx:o,children:" No Record Found "})})})]})})},kt=({openDialog:a,setOpenDialog:n})=>{const r=Re(),l=Me(r.palette.mode),m=de("(max-width:480px)"),c=de("(max-width:920px)"),y=()=>{n(!1)},[d,h]=i.useState("Create"),[f,o]=i.useState(!1),[g,u]=i.useState({paymentData:{values:null,validated:!1}}),[F,ne]=i.useState(!1),[K,C]=i.useState(!1),[N,Q]=i.useState(!1),H=z(p=>p.menuItems.selected),I=z(p=>p.toastInfo),Z=Be(),ee=i.useRef(),R=we(),{state:b}=pe(),{typography:w}=Le(r.palette.mode),{capitalizeEveryWord:e,toastAndNavigate:te,getLocalStorage:M}=me(),_=b!=null&&b.lastname?`${b==null?void 0:b.firstname} ${b==null?void 0:b.lastname}`:b==null?void 0:b.firstname;i.useEffect(()=>{const p=M("menu");R(Ve(p.selected))},[]);const re=i.useCallback(p=>{o(!0);const{current_date:E,class_fee_by_mapping:P,...k}=p.paymentData.values;U.PaymentAPI.createPayment(k).then(({data:j})=>{j.status==="Success"&&(o(!1),te(R,!0,"success","Successfully Created",Z,"#",!0))}).catch(j=>{var le,ae;o(!1),te(R,!0,"error",j?(ae=(le=j==null?void 0:j.response)==null?void 0:le.data)==null?void 0:ae.msg:"An Error Occurred",Z,"#",!0),console.log("Error in Creating Payment:",j)})},[g]);i.useEffect(()=>{g.paymentData.validated&&re(g)},[K]);const s=async()=>{await ee.current.Submit(),C(!0)},v=(p,E)=>{E==="payment"&&u({...g,paymentData:p})};return t.jsxs(We,{open:a,onClose:y,"aria-labelledby":"responsive-dialog-title",fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{minHeight:"96%"}},sx:{top:m?"13%":c?"5%":"0%",height:m?"79%":c?"69%":"90%","& .MuiDialog-container":{height:"95vh"},"& .MuiPaper-root":{backgroundImage:r.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${be})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${be})`,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"}},children:[t.jsx(ge,{fontFamily:w.fontFamily,fontSize:w.h2.fontSize,color:l.grey[100],fontWeight:"600",display:"inline-block",textAlign:"center",margin:"10px auto 10px auto",children:`${H} History for ${_?e(_):""}`}),t.jsx(Mt,{}),t.jsx(ge,{fontFamily:w.fontFamily,fontSize:w.h2.fontSize,color:l.grey[100],fontWeight:"600",display:"inline-block",textAlign:"center",margin:"20px auto 10px auto",children:`${d} ${H} for ${_?e(_):""}`}),t.jsx($e,{onChange:p=>{v(p,"payment")},refId:ee,setDirty:ne,reset:N,setReset:Q}),t.jsx(Ue,{}),t.jsxs(ue,{display:"flex",justifyContent:"end",m:"20px",children:[d==="Update"?null:t.jsx(ce,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!F||K,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&Q(!0)},children:"Reset"}),t.jsx(ce,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>n(!1),children:"Cancel"}),t.jsx(ce,{type:"submit",onClick:()=>s(),disabled:!F,color:d==="Update"?"info":"success",variant:"contained",children:"Submit"}),t.jsx(Fe,{alerting:I.toastAlert,severity:I.toastSeverity,message:I.toastMessage})]}),f===!0?t.jsx(ze,{}):null]})};kt.propTypes={openDialog:S.bool,setOpenDialog:S.func};export{kt as default};
