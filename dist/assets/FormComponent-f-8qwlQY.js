import{q as se,s as g,P as y,a as s,h as re,K as ne,R as le,j as a,B as T,z as v,C as N,I as O,S as U,E as S,M as z,N as Y,l as H,v as oe,w as ie,O as de,u as ue,t as ce,k as me,x as he,y as pe,A as V,m as G,T as fe,p as L,H as ge,J as ye,U as xe}from"./index-zLCHO5gj.js";import{d as J}from"./dayjs.min-BIwqZoVS.js";import{A as ve}from"./AddressFormComponent-A6w5Bv7O.js";import{a as be,A as Ce}from"./useMobilePicker-jp2tUA7Z.js";import{D as je}from"./DatePicker-ZpOXrT1U.js";const Se=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Te=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,De=se().shape({firstname:g().min(2,"Firstname is Too Short!").max(20,"Firstname is Too Long!").required("This Field is Required"),lastname:g().min(2,"Lastname is Too Short!").max(20,"Lastname is Too Long!").required("This Field is Required"),email:g().matches(Te,"Email Address is Not Valid"),contact_no:g().matches(Se,"Phone Number Is Not Valid").required("This Field is Required"),gender:g().required("This Field is Required"),status:g()}),Re={firstname:"",lastname:"",email:"",contact_no:"",role:"",dob:null,gender:"",status:"active"},K=({onChange:h,refId:b,setDirty:D,reset:o,setReset:l,updatedValues:p=null})=>{const[d,R]=s.useState(Re),C=re("(min-width:600px)"),e=ne({initialValues:d,validationSchema:De,enableReinitialize:!0,onSubmit:()=>x()});le.useImperativeHandle(b,()=>({Submit:async()=>{await e.submitForm()}}));const x=()=>{h&&h({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1,dirty:e.dirty})};return s.useEffect(()=>{o&&(e.resetForm(),l(!1))},[o]),s.useEffect(()=>{e.dirty&&D(!0)},[e.dirty]),s.useEffect(()=>{p&&R(p)},[p]),a.jsx(T,{m:"20px",children:a.jsx("form",{ref:b,children:a.jsxs(T,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:C?void 0:"span 4"}},children:[a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",name:"firstname",label:"Firstname*",autoComplete:"new-firstname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.firstname,error:!!e.touched.firstname&&!!e.errors.firstname,helperText:e.touched.firstname&&e.errors.firstname}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",name:"lastname",label:"Lastname*",autoComplete:"new-lastname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.lastname,error:!!e.touched.lastname&&!!e.errors.lastname,helperText:e.touched.lastname&&e.errors.lastname}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",autoComplete:"new-email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",label:"Role",name:"role",autoComplete:"new-role",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.role,error:!!e.touched.role&&!!e.errors.role,helperText:e.touched.role&&e.errors.role}),a.jsx(be,{dateAdapter:Ce,children:a.jsx(je,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Select Date Of Birth",name:"dob",required:!0,value:e.values.dob,onChange:n=>{e.setFieldValue("dob",n)}})}),a.jsxs(N,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[a.jsx(O,{children:"Gender"}),a.jsx(U,{variant:"filled",name:"gender",value:e.values.gender,onChange:e.handleChange,children:Object.keys(S.gender).map(n=>a.jsx(z,{value:n,children:S.gender[n]},n))}),a.jsx(Y,{children:e.touched.gender&&e.errors.gender})]}),a.jsxs(N,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(O,{children:"Status"}),a.jsx(U,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(S.status).map(n=>a.jsx(z,{value:n,children:S.status[n]},n))}),a.jsx(Y,{children:e.touched.status&&e.errors.status})]})]})})})};K.propTypes={onChange:y.func.isRequired,refId:y.any.isRequired,setDirty:y.func.isRequired,reset:y.func.isRequired,setReset:y.func.isRequired,updatedValues:y.object};const Ee=()=>{const[h,b]=s.useState("Create"),[D,o]=s.useState(!1),[l,p]=s.useState({employeeData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!0}}),[d,R]=s.useState(null),[C,e]=s.useState(!1),[x,n]=s.useState(!1),[P,F]=s.useState(!1),Q=H(t=>t.menuItems.selected),w=H(t=>t.toastInfo),$=s.useRef(),M=s.useRef(),k=oe(),j=ie(),A=de(),I=ue(),X=ce(I.palette.mode),{typography:_}=me(I.palette.mode),{state:E}=he(),{toastAndNavigate:q,getLocalStorage:B}=xe();let f=(E==null?void 0:E.id)||(A==null?void 0:A.id);s.useEffect(()=>{const t=B("menu");j(pe(t.selected))},[]);const Z=s.useCallback(async t=>{var m,c;o(!0);const u=[],r=[];try{t.employeeData.dirty&&(u.push("/update-employee"),r.push(t.employeeData.values)),t.addressData.dirty&&(u.push("/update-address"),r.push(t.addressData.values)),await V.CommonAPI.multipleAPICall("PATCH",u,r)&&q(j,!0,"info","Successfully Updated",k,`/employee/listing/${B("class")||""}`),o(!1)}catch(i){throw o(!1),q(j,!0,"error",i?(c=(m=i==null?void 0:i.response)==null?void 0:m.data)==null?void 0:c.msg:"An Error Occurred",k,0),i}},[l]),ee=s.useCallback(t=>{o(!0);const u=[`/get-by-pk/employee/${t}`,`/get-address/employee/${t}`];V.CommonAPI.multipleAPICall("GET",u).then(r=>{var c,i;r[0].data.data&&(r[0].data.data.dob=J(r[0].data.data.dob),r[0].data.data.admission_date=J(r[0].data.data.admission_date));const m={employeeData:r[0].data.data,addressData:(i=(c=r[1])==null?void 0:c.data)==null?void 0:i.data};R(m),o(!1)}).catch(r=>{var m,c;throw o(!1),q(j,!0,"error",(c=(m=r==null?void 0:r.response)==null?void 0:m.data)==null?void 0:c.msg),r})},[f]),ae=[l];s.useEffect(()=>{var t;f&&!x&&(b("Update"),ee(f)),l.employeeData.validated&&l.addressData.validated?(t=l.employeeData.values)!=null&&t.id?Z(l):ae(l):n(!1)},[f,x]);const te=async()=>{await $.current.Submit(),await M.current.Submit(),n(!0)},W=(t,u)=>{u==="employee"?p({...l,employeeData:t}):u==="address"&&p({...l,addressData:t})};return a.jsxs(T,{m:"10px",sx:{backgroundImage:I.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${G})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${G})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed"},children:[a.jsx(fe,{fontFamily:_.fontFamily,fontSize:_.h2.fontSize,color:X.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${h} ${Q}`}),a.jsx(K,{onChange:t=>{W(t,"employee")},refId:$,setDirty:e,reset:P,setReset:F,userId:f,updatedValues:d==null?void 0:d.employeeData}),a.jsx(ve,{onChange:t=>{W(t,"address")},refId:M,update:!!f,setDirty:e,reset:P,setReset:F,updatedValues:d==null?void 0:d.addressData}),a.jsxs(T,{display:"flex",justifyContent:"end",m:"20px",children:[h==="Update"?null:a.jsx(L,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!C||x,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&F(!0)},children:"Reset"}),a.jsx(L,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>k(`/employee/listing/${B("class")||""}`),children:"Cancel"}),a.jsx(L,{type:"submit",onClick:()=>te(),disabled:!C,color:h==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(ge,{alerting:w.toastAlert,severity:w.toastSeverity,message:w.toastMessage})]}),D===!0?a.jsx(ye,{}):null]})};export{Ee as default};
