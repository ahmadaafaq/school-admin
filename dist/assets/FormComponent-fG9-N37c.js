import{r as xe,i as fe,j as a,a as n,f as Q,k as ge,b as de,v as be,R as ne,A as F,E as je,B as V,m as p,n as w,I,S as k,M as f,w as R,D as ce,U as pe,h as Ce,x as _e,u as ye,t as Se,d as Fe,l as De,s as Ae,T as Te,o as ie,p as Be}from"./index-wJj9abeo.js";import{d as we}from"./dayjs.min-3WyAvf2v.js";import{A as Ie}from"./AddressFormComponent-2wzYeNmw.js";import{I as ke}from"./ImagePicker-l40Oa1J_.js";import{c as Ee,a as N,L as We}from"./Loader-V9kt_BZH.js";import{s as $e}from"./SectionAction-bDNrVPg3.js";import{s as Pe}from"./SubjectAction-mW2zJbl_.js";import{u as Le}from"./index-ngBz0NVi.js";import{L as qe,A as Me,D as Oe}from"./DatePicker-VCJxWt5f.js";import{F as ue,C as he,A as me}from"./FormControlLabel-rkyz9wHp.js";import"./Validation-UJUBWKF9.js";import"./index-R3E-xKkl.js";import"./Chip-3qarAbJU.js";import"./Dialog-H17IDJ7F.js";var oe={},Re=fe;Object.defineProperty(oe,"__esModule",{value:!0});var ve=oe.default=void 0,Ne=Re(xe()),Ve=a,Ue=(0,Ne.default)((0,Ve.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddCircle");ve=oe.default=Ue;const ze=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Ge=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,He=Ee().shape({firstname:N().min(2,"Firstname is Too Short!").max(20,"Firstname is Too Long!").required("This Field is Required"),lastname:N().min(2,"Lastname is Too Short!").max(20,"Lastname is Too Long!").required("This Field is Required"),email:N().matches(Ge,"Email Address is Not Valid"),contact_no:N().matches(ze,"Phone Number Is Not Valid").required("This Field is Required"),gender:N(),status:N()}),Ye={firstname:"",lastname:"",email:"",contact_no:"",dob:null,age:"",nationality:"",religion:"",blood_group:"",qualification:"",achievements:"",experience:"",subject:[""],combinedClsSect:[],grade:"",is_specially_abled:!1,is_class_teacher:!1,class:"",section:"",caste_group:"",gender:"",status:"inactive"},Qe=({onChange:E,refId:J,setDirty:te,reset:h,setReset:m,combinedClass:W,teacherId:S,updatedValues:$=null})=>{var H,A,M,O;const[K,se]=n.useState(Ye),[P,le]=n.useState([{id:1}]),[X,U]=n.useState({}),b=Q(t=>t.allFormClasses),C=Q(t=>t.allFormSections),u=Q(t=>t.allFormSubjects),D=ge(),L={inputProps:{"aria-label":"Checkboxes"}},Z=de("(min-width:600px)"),z=de("(max-width:480px)"),{getPaginatedData:ee}=Le(),{appendSuffix:G,customSort:q,createUniqueDataArray:_}=pe(),e=be({initialValues:K,validationSchema:He,enableReinitialize:!0,onSubmit:()=>ae()});ne.useImperativeHandle(J,()=>({Submit:async()=>{await e.submitForm()}}));const ae=()=>{E&&E({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})},re=()=>{le([...P,{id:P.length+1}])};return console.log("formik.values.combinedclssect",e.values.combinedClsSect),n.useEffect(()=>{h&&(e.resetForm(),m(!1))},[h]),n.useEffect(()=>{e.dirty&&te(!0)},[e.dirty]),n.useEffect(()=>{if($){const t=$.selectedClass.reduce((l,o)=>{const g=o.subject_id;return delete o.subject_id,delete o.subject_name,l[g]||(l[g]=[]),l[g].push(o),l},{});U(t),console.log("updatedArrHelper",t,Object.values(t));const d=t&&Object.keys(t).length>0;se({...K,...$.teacherData,subject:d?Object.keys(t):[],combinedClsSect:d?Object.values(t):[]})}},[$]),n.useEffect(()=>{var t,d;(!((t=b==null?void 0:b.listData)!=null&&t.length)||!((d=C==null?void 0:C.listData)!=null&&d.length))&&F.SchoolAPI.getSchoolClasses(5).then(l=>{if(l.status==="Success"){l.data.sort(q);const o=_(l.data,"class_id","class_name");D(je(o));const g=_(l.data,"id","name");D($e(g))}else console.log("Error Fetching ClassData, Please Try Again")}).catch(l=>{console.log("Error Fetching ClassData:",l)})},[b.listData.length,C.listData.length]),n.useEffect(()=>{var t,d;(d=(t=u==null?void 0:u.listData)==null?void 0:t.rows)!=null&&d.length||ee(0,50,Pe,F.SubjectAPI)},[(A=(H=u==null?void 0:u.listData)==null?void 0:H.rows)==null?void 0:A.length]),a.jsx(V,{m:"20px",children:a.jsxs("form",{ref:J,children:[a.jsxs(V,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gridColumn:"span 4",position:"relative",className:"box-shadow",sx:{"& > div":{gridColumn:Z?void 0:"span 4"},marginBottom:"40px"},children:[a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",name:"firstname",label:"Firstname*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.firstname,error:!!e.touched.firstname&&!!e.errors.firstname,helperText:e.touched.firstname&&e.errors.firstname}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",name:"lastname",label:"Lastname*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.lastname,error:!!e.touched.lastname&&!!e.errors.lastname,helperText:e.touched.lastname&&e.errors.lastname}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Age",name:"age",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.age,error:!!e.touched.age&&!!e.errors.age,helperText:e.touched.age&&e.errors.age}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Nationality",name:"nationality",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.nationality,error:!!e.touched.nationality&&!!e.errors.nationality,helperText:e.touched.nationality&&e.errors.nationality}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Religion",name:"religion",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.religion,error:!!e.touched.religion&&!!e.errors.religion,helperText:e.touched.religion&&e.errors.religion}),a.jsxs(w,{variant:"filled",sx:{minWidth:120},error:!!e.touched.caste_group&&!!e.errors.caste_group,children:[a.jsx(I,{id:"castGroupField",children:"Caste Group"}),a.jsxs(k,{variant:"filled",labelId:"castGroupField",name:"caste_group",value:e.values.caste_group,onChange:e.handleChange,children:[a.jsx(f,{value:"general",children:"General"}),a.jsx(f,{value:"obc",children:"OBC"}),a.jsx(f,{value:"sc",children:"SC"}),a.jsx(f,{value:"st",children:"ST"})]}),a.jsx(R,{children:e.touched.caste_group&&e.errors.caste_group})]}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Blood Group",name:"blood_group",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.blood_group,error:!!e.touched.blood_group&&!!e.errors.blood_group,helperText:e.touched.blood_group&&e.errors.blood_group}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Qualification",name:"qualification",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.qualification,error:!!e.touched.qualification&&!!e.errors.qualification,helperText:e.touched.qualification&&e.errors.qualification}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Achievements",name:"achievements",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.achievements,error:!!e.touched.achievements&&!!e.errors.achievements,helperText:e.touched.achievements&&e.errors.achievements}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Experience",name:"experience",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.experience,error:!!e.touched.experience&&!!e.errors.experience,helperText:e.touched.experience&&e.errors.experience}),a.jsx(p,{fullWidth:!0,variant:"filled",type:"text",label:"Grade",name:"grade",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.grade,error:!!e.touched.grade&&!!e.errors.grade,helperText:e.touched.grade&&e.errors.grade}),a.jsx(qe,{dateAdapter:Me,children:a.jsx(Oe,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Date Of Birth",name:"dob",required:!0,value:e.values.dob,onChange:t=>e.setFieldValue("dob",t)})}),a.jsx(ue,{label:"Is Specially Abled",sx:{gridColumn:z?"span 2":""},control:a.jsx(he,{...L,color:"default",checked:!!e.values.is_specially_abled,name:"is_specially_abled",onChange:(t,d)=>e.setFieldValue("is_specially_abled",d),value:e.values.is_specially_abled})}),a.jsx(ue,{label:"Is Class Teacher",sx:{gridColumn:z?"span 2":""},control:a.jsx(he,{...L,color:"default",checked:!!e.values.is_class_teacher,name:"is_class_teacher",onChange:(t,d)=>e.setFieldValue("is_class_teacher",d),value:e.values.is_class_teacher})}),e.values.is_class_teacher&&a.jsxs(a.Fragment,{children:[a.jsxs(w,{variant:"filled",sx:{minWidth:120},error:!!e.touched.class&&!!e.errors.class,children:[a.jsx(I,{id:"classField",children:"Class"}),a.jsx(k,{variant:"filled",labelId:"classField",name:"class",value:e.values.class,onChange:e.handleChange,children:((M=b==null?void 0:b.listData)==null?void 0:M.length)&&b.listData.map(t=>a.jsx(f,{value:t.class_id,name:t.class_name,children:t.class_name},t.class_name))}),a.jsx(R,{children:e.touched.class&&e.errors.class})]}),a.jsxs(w,{variant:"filled",sx:{minWidth:120},error:!!e.touched.section&&!!e.errors.section,children:[a.jsx(I,{id:"sectionField",children:"Section"}),a.jsx(k,{variant:"filled",labelId:"sectionField",name:"section",value:e.values.section,onChange:t=>e.setFieldValue("section",t.target.value),children:((O=C==null?void 0:C.listData)==null?void 0:O.length)&&C.listData.map(t=>a.jsx(f,{value:t.id,name:t.name,children:t.name},t.name))}),a.jsx(R,{children:e.touched.section&&e.errors.section})]})]}),a.jsxs(w,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[a.jsx(I,{id:"genderField",children:"Gender"}),a.jsxs(k,{variant:"filled",labelId:"genderField",name:"gender",value:e.values.gender,onChange:e.handleChange,children:[a.jsx(f,{value:"male",children:"Male"}),a.jsx(f,{value:"female",children:"Female"}),a.jsx(f,{value:"other",children:"Other"})]}),a.jsx(R,{children:e.touched.gender&&e.errors.gender})]}),a.jsxs(w,{variant:"filled",sx:{minWidth:120},children:[a.jsx(I,{id:"statusField",children:"Status"}),a.jsxs(k,{variant:"filled",labelId:"statusField",name:"status",value:e.values.status,onChange:e.handleChange,error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(f,{value:"active",children:"Active"}),a.jsx(f,{value:"inactive",children:"Inactive"})]})]})]}),a.jsxs(V,{border:"2px solid #BADFE7",borderRadius:"12px",padding:"4px",display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gridColumn:"span 4",position:"relative",className:"box-shadow",sx:{transform:"translate(0)",transformStyle:"preserve-3d",marginBottom:"40px"},children:[a.jsxs(V,{onClick:re,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:[a.jsx(ve,{sx:{fontSize:"22px"}}),a.jsx("span",{style:{color:"rgb(97,97,97)",fontWeight:"300",fontSize:"16px",lineHeight:"30px",letterSpacing:"0.015em"},children:" Add Subjects "})]}),!S&&P.map(t=>{var d,l;return a.jsxs(ne.Fragment,{children:[a.jsxs(w,{variant:"filled",sx:{minWidth:120},error:!!e.touched.subject&&!!e.errors.subject,children:[a.jsxs(I,{id:`subjectField_${t.id}`,children:["Subject ",t.id]}),a.jsx(k,{variant:"filled",labelId:`subjectField_${t.id}`,name:`subject_${t.id}`,value:e.values.subject[t.id-1],onChange:(o,g)=>{const y=[...e.values.subject];y[t.id-1]=g.props.value,e.setFieldValue("subject",y)},children:((l=(d=u==null?void 0:u.listData)==null?void 0:d.rows)==null?void 0:l.length)&&u.listData.rows.map(o=>a.jsx(f,{value:o.id,name:o.name,children:o.name},o.name))}),a.jsx(R,{children:e.touched.subject&&e.errors.subject})]}),a.jsx(me,{multiple:!0,options:W||[],getOptionLabel:o=>`${G(o.class_name)} ${o.section_name}`,disableCloseOnSelect:!0,value:e.values.combinedClsSect[t.id-1],onChange:(o,g)=>{const y=[...e.values.combinedClsSect];y[t.id-1]=g,e.setFieldValue("combinedClsSect",y)},sx:{gridColumn:"span 2"},renderInput:o=>a.jsx(p,{...o,variant:"filled",type:"text",name:`combinedClsSect_${t.id}`,label:"Class and Section"})}),P.length>1&&a.jsx(ce,{sx:{borderBottomWidth:"0px"}})]},t.id)}),S&&Object.values(X).map((t,d)=>{var o,g,y;let l=d+1;return console.log(t,"inside combined class loop"),a.jsxs(ne.Fragment,{children:[a.jsxs(w,{variant:"filled",sx:{minWidth:120},error:!!e.touched.subject&&!!e.errors.subject,children:[a.jsxs(I,{id:`subjectField_${l}`,children:["Subject ",l]}),a.jsx(k,{variant:"filled",labelId:`subjectField_${l}`,name:`subject_${l}`,value:e.values.subject[d]||[],onChange:(v,T)=>{const s=[...e.values.subject];s[l-1]=T.props.value,e.setFieldValue("subject",s)},children:((g=(o=u==null?void 0:u.listData)==null?void 0:o.rows)==null?void 0:g.length)&&u.listData.rows.map(v=>a.jsx(f,{value:v.id,name:v.name,children:v.name},v.name))}),a.jsx(R,{children:e.touched.subject&&e.errors.subject})]}),a.jsx(me,{multiple:!0,options:W||[],getOptionLabel:v=>`${G(v.class_name)} ${v.section_name}`,disableCloseOnSelect:!0,value:((y=e.values)==null?void 0:y.combinedClsSect[d])||[],onChange:(v,T)=>{const s=[...e.values.combinedClsSect];s[l-1]=T,e.setFieldValue("combinedClsSect",s)},sx:{gridColumn:"span 2"},renderInput:v=>a.jsx(p,{...v,variant:"filled",type:"text",name:`combinedClsSect_${l}`,label:"Class and Section"})}),d>0&&a.jsx(ce,{sx:{borderBottomWidth:"0px"}})]},l)})]})]})})},ca=()=>{const[E,J]=n.useState("Create"),[te,h]=n.useState(!1),[m,W]=n.useState({teacherData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!0}}),[S,$]=n.useState(null),[K,se]=n.useState([]),[P,le]=n.useState([]),[X,U]=n.useState(!1),[b,C]=n.useState(!1),[u,D]=n.useState(!1),[L,Z]=n.useState([]),z=n.useRef(),ee=n.useRef(),G=n.useRef(),q=Ce(),_=ge(),e=_e(),ae=ye(),re=Se(ae.palette.mode),{typography:H}=Fe(ae.palette.mode),A=Q(s=>s.menuItems.selected),M=Q(s=>s.toastInfo),{state:O}=De(),{toastAndNavigate:t,getLocalStorage:d}=pe();let l=(O==null?void 0:O.id)||(e==null?void 0:e.id);n.useEffect(()=>{const s=d("menu");_(Ae(s.selected))},[]);const o=n.useCallback(s=>{const j=[{...s.teacherData.values},{...s.addressData.values}],r=["/update-teacher","/update-address"];h(!0),F.CommonAPI.multipleAPICall("PATCH",r,j).then(i=>{let c=!0;i.forEach(x=>{x.data.status!=="Success"&&(c=!1)}),c&&(h(!1),t(_,!0,"info","Successfully Updated",q,`/${A.toLowerCase()}/listing`)),h(!1)}).catch(i=>{var c,x;throw h(!1),t(_,!0,"error",(x=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:x.msg),i})},[m]),g=s=>{h(!0);const j=[`/get-by-pk/teacher/${s}`,`/get-address/teacher/${s}`,`/get-teacher-detail/${s}`];F.CommonAPI.multipleAPICall("GET",j).then(r=>{var c,x,Y,B;console.log("res=>",r),r[0].data.data&&(r[0].data.data.dob=we(r[0].data.data.dob));const i={teacherData:{teacherData:r[0].data.data,selectedClass:(x=(c=r[2])==null?void 0:c.data)==null?void 0:x.data},addressData:(B=(Y=r[1])==null?void 0:Y.data)==null?void 0:B.data};console.log("teacher dataobj",i),$(i),h(!1)}).catch(r=>{var i,c;throw h(!1),t(_,!0,"error",(c=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:c.msg),r})},y=()=>{let s,j;h(!0),F.TeacherAPI.createTeacher({...m.teacherData.values}).then(({data:r})=>{if((r==null?void 0:r.status)==="Success")return s=F.AddressAPI.createAddress({...m.addressData.values,parent_id:r.data.id,parent:"teacher"}),j=m.teacherData.values.combinedClsSect.map((i,c)=>{var Y;const x=((Y=m.teacherData.values)==null?void 0:Y.subject[c])||0;i.map(B=>{console.log("got",B.class_id,B.section_id,x),F.TeacherAPI.insertIntoMappingTable([r.data.id,B.class_id,B.section_id,x])})}),Promise.all([s,j]).then(i=>{h(!1),t(_,!0,"success","Successfully Created",q,`/${A.toLowerCase()}/listing`)}).catch(i=>{var c,x;throw h(!1),t(_,!0,"error",i?(x=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:x.msg:"An Error Occurred",q,0),i})}).catch(r=>{var i,c;throw h(!1),t(_,!0,"error",(c=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:c.msg),r})};n.useEffect(()=>{F.ClassAPI.getClassSectionList().then(s=>{s.status==="Success"?(s.data.map(j=>{delete j.class_subjects}),console.log("joined classData",s.data),Z(s.data)):console.error("Error fetching classes. Please Try Again")}).catch(s=>{console.error("Error fetching classes:",s)})},[]),n.useEffect(()=>{var s;l&&!b&&L&&(J("Update"),g(l)),m.teacherData.validated&&m.addressData.validated?(s=m.teacherData.values)!=null&&s.id?o(m):y():C(!1)},[l,b,L]);const v=async()=>{await z.current.Submit(),await ee.current.Submit(),await G.current.Submit(),C(!0)},T=(s,j)=>{j==="teacher"?W({...m,teacherData:s}):j==="address"?W({...m,addressData:s}):j==="image"&&W({...m,imageData:s})};return a.jsxs(V,{m:"10px",children:[a.jsx(Te,{fontFamily:H.fontFamily,fontSize:H.h2.fontSize,color:re.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${E} ${A}`}),a.jsx(Qe,{onChange:s=>{T(s,"teacher")},refId:z,setDirty:U,reset:u,setReset:D,teacherId:l,combinedClass:L,setCombinedClass:Z,updatedValues:S==null?void 0:S.teacherData}),a.jsx(Ie,{onChange:s=>{T(s,"address")},refId:ee,update:!!l,setDirty:U,reset:u,setReset:D,updatedValues:S==null?void 0:S.addressData}),a.jsx(ke,{onChange:s=>T(s,"image"),refId:G,reset:u,setReset:D,setDirty:U,preview:P,setPreview:le,deletedImage:K,setDeletedImage:se,imageType:""},"image"),a.jsxs(V,{display:"flex",justifyContent:"end",m:"20px",children:[E==="Update"?null:a.jsx(ie,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!X||b,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&D(!0)},children:"Reset"}),a.jsx(ie,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>q(`/${A.toLowerCase()}/listing`),children:"Cancel"}),a.jsx(ie,{type:"submit",onClick:()=>v(),disabled:!X,color:E==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(Be,{alerting:M.toastAlert,severity:M.toastSeverity,message:M.toastMessage})]}),te===!0?a.jsx(We,{}):null]})};export{ca as default};
