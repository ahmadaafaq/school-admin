import{q as X,s as b,P as f,a as o,h as Z,K as ee,R as te,j as a,B as T,z as h,C as ae,I as re,S as se,E as M,M as oe,N as ne,l as U,v as de,w as le,O as ie,u as ue,t as ce,k as he,x as me,y as fe,A as B,m as O,T as pe,p as E,H as ve,J as ge,U as xe}from"./index-zLCHO5gj.js";import{d as z}from"./dayjs.min-BIwqZoVS.js";import{A as be}from"./AddressFormComponent-A6w5Bv7O.js";const Ce=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,ye=X().shape({registration_no:b().required("This Field is Required"),driver:b().required("This Field is Required"),driver_contact:b().matches(Ce,"Phone Number Is Not Valid").required("This Field is Required"),driver_license:b().required("This Field is Required"),route:b().required("This Field is Required"),status:b()}),_e={registration_no:"",driver:"",driver_contact:"",driver_license:"",conductor:"",conductor_contact:"",conductor_aadhaar:"",route:"",status:"active"},H=({onChange:p,refId:_,setDirty:D,reset:n,setReset:d,updatedValues:v=null})=>{const[u,F]=o.useState(_e),j=Z("(min-width:600px)"),e=ee({initialValues:u,validationSchema:ye,enableReinitialize:!0,onSubmit:()=>C()});te.useImperativeHandle(_,()=>({Submit:async()=>{await e.submitForm()}}));const C=()=>{p&&p({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1,dirty:e.dirty})};return o.useEffect(()=>{n&&(e.resetForm(),d(!1))},[n]),o.useEffect(()=>{e.dirty&&D(!0)},[e.dirty]),o.useEffect(()=>{v&&F(v)},[v]),a.jsx(T,{m:"20px",children:a.jsx("form",{ref:_,children:a.jsxs(T,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:j?void 0:"span 4"}},children:[a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",name:"registration_no",label:"Registration Number*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.registration_no,error:!!e.touched.registration_no&&!!e.errors.registration_no,helperText:e.touched.registration_no&&e.errors.registration_no,sx:{gridColumn:"span 2"}}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",name:"driver",label:"Driver Name*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.driver,error:!!e.touched.driver&&!!e.errors.driver,helperText:e.touched.driver&&e.errors.driver,sx:{gridColumn:"span 2"}}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"driver_contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.driver_contact,error:!!e.touched.driver_contact&&!!e.errors.driver_contact,helperText:e.touched.driver_contact&&e.errors.driver_contact}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"License Number*",name:"driver_license",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.driver_license,error:!!e.touched.driver_license&&!!e.errors.driver_license,helperText:e.touched.driver_license&&e.errors.driver_license}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",name:"conductor",label:"Conductor Name*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.conductor,error:!!e.touched.conductor&&!!e.errors.conductor,helperText:e.touched.conductor&&e.errors.conductor,sx:{gridColumn:"span 2"}}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Conductor Contact Number*",name:"conductor_contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.conductor_contact,error:!!e.touched.conductor_contact&&!!e.errors.conductor_contact,helperText:e.touched.conductor_contact&&e.errors.conductor_contact}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Conductor Aadhaar Number*",name:"conductor_aadhaar",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.conductor_aadhaar,error:!!e.touched.conductor_aadhaar&&!!e.errors.conductor_aadhaar,helperText:e.touched.conductor_aadhaar&&e.errors.conductor_aadhaar}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Route*",name:"route",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.route,error:!!e.touched.route&&!!e.errors.route,helperText:e.touched.route&&e.errors.route}),a.jsxs(ae,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(re,{children:"Status"}),a.jsx(se,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(M.status).map(g=>a.jsx(oe,{value:g,children:M.status[g]},g))}),a.jsx(ne,{children:e.touched.status&&e.errors.status})]})]})})})};H.propTypes={onChange:f.func,refId:f.shape({current:f.any}),setDirty:f.func,reset:f.bool,setReset:f.func,updatedValues:f.object};const Te=()=>{const[p,_]=o.useState("Create"),[D,n]=o.useState(!1),[d,v]=o.useState({busData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!0}}),[u,F]=o.useState(null),[j,e]=o.useState(!1),[C,g]=o.useState(!1),[P,R]=o.useState(!1),V=U(t=>t.menuItems.selected),A=U(t=>t.toastInfo),q=o.useRef(),W=o.useRef(),S=de(),m=le(),I=ie(),k=ue(),G=ce(k.palette.mode),{typography:$}=he(k.palette.mode),{state:w}=me(),{toastAndNavigate:x,getLocalStorage:N}=xe();let y=(w==null?void 0:w.id)||(I==null?void 0:I.id);o.useEffect(()=>{const t=N("menu");m(fe(t.selected))},[]);const J=o.useCallback(async t=>{var l,c;n(!0);const s=[],r=[];try{t.busData.dirty&&(s.push("/update-bus"),r.push(t.busData.values)),t.addressData.dirty&&(s.push("/update-address"),r.push(t.addressData.values)),await B.CommonAPI.multipleAPICall("PATCH",s,r)&&x(m,!0,"info","Successfully Updated",S,`/bus/listing/${N("class")||""}`),n(!1)}catch(i){throw n(!1),x(m,!0,"error",i?(c=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:c.msg:"An Error Occurred",S,0),i}},[d]),K=o.useCallback(t=>{n(!0);const s=[`/get-by-pk/bus/${t}`,`/get-address/bus/${t}`];B.CommonAPI.multipleAPICall("GET",s).then(r=>{var c,i;r[0].data.data&&(r[0].data.data.dob=z(r[0].data.data.dob),r[0].data.data.admission_date=z(r[0].data.data.admission_date));const l={busData:r[0].data.data,addressData:(i=(c=r[1])==null?void 0:c.data)==null?void 0:i.data};F(l),n(!1)}).catch(r=>{var l,c;throw n(!1),x(m,!0,"error",(c=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:c.msg),r})},[]),Q=o.useCallback(t=>{n(!0),B.BusAPI.createBus({...t.busData.values}).then(({data:s})=>{(s==null?void 0:s.status)==="Success"&&B.AddressAPI.createAddress({...t.addressData.values,parent_id:s.data.id,parent:"bus"}).then(()=>{n(!1),x(m,!0,"success","Successfully Created",S,"/bus/listing")}).catch(r=>{throw n(!1),x(m,!0,r||"An Error Occurred"),r})}).catch(s=>{var r,l;throw n(!1),x(m,!0,"error",(l=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:l.msg),s})},[d]);o.useEffect(()=>{var t;y&&!C&&(_("Update"),K(y)),d.busData.validated&&d.addressData.validated?(t=d.busData.values)!=null&&t.id?J(d):Q(d):g(!1)},[y,C]);const Y=async()=>{await q.current.Submit(),await W.current.Submit(),g(!0)},L=(t,s)=>{s==="bus"?v({...d,busData:t}):s==="address"&&v({...d,addressData:t})};return a.jsxs(T,{m:"10px",sx:{backgroundImage:k.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${O})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${O})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed",marginBottom:"20px !important",height:"95vh"},children:[a.jsx(pe,{fontFamily:$.fontFamily,fontSize:$.h2.fontSize,color:G.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${p} ${V}`}),a.jsx(H,{onChange:t=>{L(t,"bus")},refId:q,setDirty:e,reset:P,setReset:R,userId:y,updatedValues:u==null?void 0:u.busData}),a.jsx(be,{onChange:t=>{L(t,"address")},refId:W,update:!!y,setDirty:e,reset:P,setReset:R,updatedValues:u==null?void 0:u.addressData}),a.jsxs(T,{display:"flex",justifyContent:"end",m:"20px",children:[p==="Update"?null:a.jsx(E,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!j||C,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&R(!0)},children:"Reset"}),a.jsx(E,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>S(`/bus/listing/${N("class")||""}`),children:"Cancel"}),a.jsx(E,{type:"submit",onClick:()=>Y(),disabled:!j,color:p==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(ve,{alerting:A.toastAlert,severity:A.toastSeverity,message:A.toastMessage})]}),D===!0?a.jsx(ge,{}):null]})};export{Te as default};
