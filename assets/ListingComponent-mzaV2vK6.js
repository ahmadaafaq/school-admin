import{u as W,t as B,d as P,a as r,h as U,b as H,k as N,l as ie,e as le,s as J,m as v,j as e,T as O,n as ce,B as S,o as q,F as re,I as de,S as ue,M as G,D as he,p as T,q as me,L as pe,U as Y,A as ge}from"./index-MsP7Yzml.js";import{d as xe,u as fe,S as je,a as be,b as Se}from"./index-9BU2f8bX.js";import{c as ye,a as Ce}from"./index.esm-JiYwYH4D.js";import{D as Ae}from"./Dialog-9w6WfMaz.js";import{A as ve}from"./Autocomplete-UT5QdtF-.js";import"./FormControlLabel-c6D5vxEv.js";import"./index-a8hLBBUR.js";const Te=ye().shape({name:Ce().min(0,"Name is Too Short!").max(40,"Name is Too Long!").required("This Field is Required")}),Q={name:"",status:"inactive",subjects:[]},we=({openDialog:g,setOpenDialog:y})=>{const d=W(),x=B(d.palette.mode),C=P(d.breakpoints.down("md")),w=P("(max-width:480px)"),o=P("(max-width:920px)"),I=()=>{y(!1)},[f,E]=r.useState("Create"),[L,i]=r.useState(!1),[u,j]=r.useState(Q),[b,D]=r.useState([]),h=U(),l=H(),k=N(t=>t.menuItems.selected),m=N(t=>t.toastInfo),{state:M}=ie(),{typography:$}=le(d.palette.mode),{toastAndNavigate:p,getLocalStorage:K}=Y();let R=M==null?void 0:M.id;r.useEffect(()=>{const t=K("menu");l(J(t.selected)),R&&b?(E("Update"),ee(R)):(E("Create"),j(Q))},[R,b]);const X=r.useCallback(t=>{const s=[{...t,subjects:z(t.subjects)}],a=["/update-class"];i(!0),v.CommonAPI.multipleAPICall("PATCH",a,s).then(n=>{let c=!0;n.forEach(A=>{A.data.status!=="Success"&&(c=!1)}),c?(i(!1),p(l,!0,"info","Successfully Updated",h,"/class/listing",location.reload())):(i(!1),p(l,!0,"error","An Error Occurred. Please Try Again",h,location.reload()))}).catch(n=>{var c,A;throw i(!1),p(l,!0,"error",(A=(c=n==null?void 0:n.response)==null?void 0:c.data)==null?void 0:A.msg),n})},[]),Z=t=>{const s=t==null?void 0:t.split(",");if(s)return b.filter(a=>s.includes(a.id.toString()))},ee=t=>{i(!0);const s=[`/get-by-pk/class/${t}`];v.CommonAPI.multipleAPICall("GET",s).then(a=>{var n;a[0].data.status==="Success"?(a[0].data.data.subjects=Z((n=a[0].data.data)==null?void 0:n.subjects),j(a[0].data.data),i(!1)):(i(!1),p(l,!0,"error","An Error Occurred, Please Try Again",h,location.reload()))}).catch(a=>{var n,c;throw i(!1),p(l,!0,"error",(c=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:c.msg,h,location.reload()),a})};function z(t){let s=[];return t==null||t.forEach(a=>{s.push(a.id)}),s.toString()}const te=t=>{console.log(t.subjects),i(!0),t={...t,subjects:z(t==null?void 0:t.subjects)},v.ClassAPI.createClass(t).then(({data:s})=>{(s==null?void 0:s.status)==="Success"?(i(!1),p(l,!0,"success","Successfully Created"),setTimeout(()=>{I(),h(0)},2e3)):(i(!1),p(l,!0,"error","An Error Occurred, Please Try Again",h,location.reload()))}).catch(s=>{var a,n;throw i(!1),p(l,!0,s?(n=(a=s.response)==null?void 0:a.data)==null?void 0:n.msg:"An Error Occurred",h,location.reload()),s})};return r.useEffect(()=>{(()=>{v.SubjectAPI.getAll(!1,0,30).then(s=>{s.status==="Success"?D(s.data.rows):console.log("Error, Please Try Again")}).catch(s=>{throw s})})()},[]),e.jsx("div",{children:e.jsxs(Ae,{fullScreen:C,open:g,onClose:I,"aria-labelledby":"responsive-dialog-title",sx:{top:w?"33%":o?"25%":"20%",height:w?"49%":o?"39%":"60%","& .MuiPaper-root":{width:"100%"}},children:[e.jsx(O,{fontFamily:$.fontFamily,fontSize:$.h2.fontSize,color:x.grey[100],fontWeight:"600",display:"inline-block",textAlign:"center",marginTop:"10px",children:`${f} ${k}`}),e.jsx(ce,{initialValues:u,enableReinitialize:!0,validationSchema:Te,onSubmit:t=>{t.id?X(t):te(t)},children:({values:t,errors:s,touched:a,dirty:n,isSubmitting:c,handleBlur:A,handleChange:_,handleSubmit:se,resetForm:ae,setFieldValue:ne})=>e.jsxs("form",{onSubmit:se,children:[e.jsxs(S,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",padding:"20px",children:[e.jsx(q,{variant:"filled",type:"text",name:"name",label:"Name*",autoComplete:"new-name",onBlur:A,onChange:_,value:t.name,error:!!a.name&&!!s.name,helperText:a.name&&s.name}),e.jsx(ve,{multiple:!0,options:b,getOptionLabel:F=>F.name,disableCloseOnSelect:!0,value:t.subjects,onChange:(F,oe)=>ne("subjects",oe),sx:{gridColumn:"span 1"},renderInput:F=>e.jsx(q,{...F,variant:"filled",type:"text",name:"subjects",label:"subjects",error:!!a.subjects&&!!s.subjects,helperText:a.subjects&&s.subjects})}),e.jsxs(re,{variant:"filled",sx:{minWidth:120},error:!!a.status&&!!s.status,children:[e.jsx(de,{id:"statusField",children:"Status"}),e.jsxs(ue,{variant:"filled",labelId:"statusField",label:"Status",name:"status",autoComplete:"new-status",value:t.status,onChange:_,children:[e.jsx(G,{value:"active",children:"Active"}),e.jsx(G,{value:"inactive",children:"Inactive"})]})]})]}),e.jsx(he,{}),e.jsxs(S,{display:"flex",justifyContent:"end",p:"20px",children:[f==="Update"?null:e.jsx(T,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!n||c,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&ae()},children:"Reset"}),e.jsx(T,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>I(),children:"Cancel"}),e.jsx(T,{type:"submit",disabled:!n||c,color:f==="Update"?"info":"success",variant:"contained",children:"Submit"}),e.jsx(me,{alerting:m.toastAlert,severity:m.toastSeverity,message:m.toastMessage})]})]})}),L===!0?e.jsx(pe,{}):null]})})},Ie=g=>{const y=W(),d=B(y.palette.mode),x=U(),C=o=>{g(),x("#",{state:{id:o}})};return[{field:"name",headerName:"NAME",headerAlign:"center",align:"center",flex:1,minWidth:120},{field:"subjects",headerName:"SUBJECTS",headerAlign:"center",align:"center",flex:1,minWidth:120},{field:"status",headerName:"STATUS",headerAlign:"center",align:"center",flex:1,minWidth:120,renderCell:({row:{status:o}})=>e.jsx(S,{width:"60%",m:"0 auto",p:"5px",display:"flex",justifyContent:"center",backgroundColor:o==="active"?d.greenAccent[600]:d.redAccent[700],borderRadius:"4px",children:e.jsx(O,{color:d.grey[100],sx:{ml:"5px"},children:o})})},{field:"updated_at",headerName:"UPDATED AT",headerAlign:"center",align:"center",flex:1,minWidth:100,valueFormatter:o=>o==null?void 0:o.value.substring(0,10)},{field:"action",headerName:"ACTION",headerAlign:"center",align:"center",flex:1,minWidth:75,renderCell:({row:{id:o}})=>e.jsx(S,{width:"30%",m:"0 auto",p:"5px",display:"flex",justifyContent:"center",children:e.jsx(T,{color:"info",variant:"contained",onClick:()=>C(o),sx:{minWidth:"50px"},children:e.jsx(xe,{})})})}]},V=g=>({type:ge.SET_CLASSES,payload:g}),Ee=[5,10,20],Re=()=>{const[g,y]=r.useState(!1),[d,x]=r.useState({search:!1,searching:!1}),[C,w]=r.useState(),o=U(),I=H(),f=N(m=>m.menuItems.selected),{listData:E}=N(m=>m.allClasses),L=W(),i=B(L.palette.mode),u=P("(max-width:480px)"),j=P("(max-width:920px)"),b=document.getElementById("reload-btn"),{getPaginatedData:D}=fe(),{getLocalStorage:h}=Y();r.useEffect(()=>{const m=h("menu");I(J(m.selected))},[]);const l=()=>{b.style.display="none",x({search:!1,searching:!1,oldPagination:C})},k=()=>{y(!0)};return e.jsxs(S,{m:"10px",position:"relative",children:[e.jsx(S,{height:u?"19vh":j?"8vh":"11vh",borderRadius:"4px",padding:u?"1vh":"2vh",backgroundColor:i.blueAccent[700],children:e.jsxs(S,{display:"flex",height:u?"16vh":"7vh",flexDirection:u?"column":"row",justifyContent:"space-between",alignItems:u?"center":"normal",children:[e.jsx(O,{component:"h2",variant:"h2",color:i.grey[100],fontWeight:"bold",children:f}),e.jsx(je,{action:V,api:v.ClassAPI,getSearchData:D,oldPagination:C,reloadBtn:b,setSearchFlag:x}),e.jsxs(T,{type:"submit",color:"success",variant:"contained",onClick:()=>{o("#",{state:{id:void 0}}),k()},sx:{height:j?"4vh":"auto"},children:["Create New ",f]})]})}),e.jsxs(T,{sx:{display:"none",position:"absolute",top:u?"23vh":j?"10.5vh":"16.5vh",left:u?"80vw":j?"39.5vw":"26vw",zIndex:1,borderRadius:"20%",color:i.grey[100]},id:"reload-btn",type:"button",onClick:l,children:[e.jsx("span",{style:{display:"inherit",marginRight:"5px",marginLeft:"-2px"},children:e.jsx(be,{})}),"Back"]}),e.jsx(Se,{action:V,api:v.ClassAPI,getQuery:D,columns:Ie(k),rows:E.rows,count:E.count,selected:f,pageSizeOptions:Ee,setOldPagination:w,searchFlag:d,setSearchFlag:x}),e.jsx(we,{openDialog:g,setOpenDialog:y})]})};export{Re as default};
