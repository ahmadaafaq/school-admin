import{k as X,l as b,P as f,a as s,b as Z,z as ee,R as te,j as t,B,q as c,v as ae,I as re,S as se,M as oe,C as ne,m as M,n as de,o as le,E as ie,u as ue,t as ce,d as he,p as me,s as fe,A as S,f as U,T as ve,h as N,x as pe,y as ge,U as xe}from"./index-dsWAcX1f.js";import{d as z}from"./dayjs.min-2OarEC18.js";import{A as be}from"./AddressFormComponent-EqXGwUPp.js";import{c as O}from"./index-mbUFVO5S.js";const Ce=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,ye=X().shape({registration_no:b().required("This Field is Required"),driver:b().required("This Field is Required"),driver_contact:b().matches(Ce,"Phone Number Is Not Valid").required("This Field is Required"),driver_license:b().required("This Field is Required"),route:b().required("This Field is Required"),status:b()}),_e={registration_no:"",driver:"",driver_contact:"",driver_license:"",conductor:"",conductor_contact:"",conductor_aadhaar:"",route:"",status:"inactive"},H=({onChange:v,refId:_,setDirty:T,reset:n,setReset:l,updatedValues:p=null})=>{const[u,D]=s.useState(_e),j=Z("(min-width:600px)"),e=ee({initialValues:u,validationSchema:ye,enableReinitialize:!0,onSubmit:()=>C()});te.useImperativeHandle(_,()=>({Submit:async()=>{await e.submitForm()}}));const C=()=>{v&&v({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return s.useEffect(()=>{n&&(e.resetForm(),l(!1))},[n]),s.useEffect(()=>{e.dirty&&T(!0)},[e.dirty]),s.useEffect(()=>{p&&D(p)},[p]),t.jsx(B,{m:"20px",children:t.jsx("form",{ref:_,children:t.jsxs(B,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:j?void 0:"span 4"}},children:[t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",name:"registration_no",label:"Registration Number*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.registration_no,error:!!e.touched.registration_no&&!!e.errors.registration_no,helperText:e.touched.registration_no&&e.errors.registration_no,sx:{gridColumn:"span 2"}}),t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",name:"driver",label:"Driver Name*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.driver,error:!!e.touched.driver&&!!e.errors.driver,helperText:e.touched.driver&&e.errors.driver,sx:{gridColumn:"span 2"}}),t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"driver_contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.driver_contact,error:!!e.touched.driver_contact&&!!e.errors.driver_contact,helperText:e.touched.driver_contact&&e.errors.driver_contact}),t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",label:"License Number*",name:"driver_license",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.driver_license,error:!!e.touched.driver_license&&!!e.errors.driver_license,helperText:e.touched.driver_license&&e.errors.driver_license}),t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",name:"conductor",label:"Conductor Name*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.conductor,error:!!e.touched.conductor&&!!e.errors.conductor,helperText:e.touched.conductor&&e.errors.conductor,sx:{gridColumn:"span 2"}}),t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",label:"Conductor Contact Number*",name:"conductor_contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.conductor_contact,error:!!e.touched.conductor_contact&&!!e.errors.conductor_contact,helperText:e.touched.conductor_contact&&e.errors.conductor_contact}),t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",label:"Conductor Aadhaar Number*",name:"conductor_aadhaar",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.conductor_aadhaar,error:!!e.touched.conductor_aadhaar&&!!e.errors.conductor_aadhaar,helperText:e.touched.conductor_aadhaar&&e.errors.conductor_aadhaar}),t.jsx(c,{fullWidth:!0,variant:"filled",type:"text",label:"Route*",name:"route",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.route,error:!!e.touched.route&&!!e.errors.route,helperText:e.touched.route&&e.errors.route}),t.jsxs(ae,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[t.jsx(re,{children:"Status"}),t.jsx(se,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(O.status).map(g=>t.jsx(oe,{value:g,children:O.status[g]},g))}),t.jsx(ne,{children:e.touched.status&&e.errors.status})]})]})})})};H.propTypes={onChange:f.func,refId:f.shape({current:f.any}),setDirty:f.func,reset:f.bool,setReset:f.func,updatedValues:f.object};const De=()=>{const[v,_]=s.useState("Create"),[T,n]=s.useState(!1),[l,p]=s.useState({busData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!0}}),[u,D]=s.useState(null),[j,e]=s.useState(!1),[C,g]=s.useState(!1),[P,F]=s.useState(!1),V=M(a=>a.menuItems.selected),R=M(a=>a.toastInfo),q=s.useRef(),W=s.useRef(),I=de(),h=le(),k=ie(),A=ue(),G=ce(A.palette.mode),{typography:$}=he(A.palette.mode),{state:w}=me(),{toastAndNavigate:x,getLocalStorage:E}=xe();let y=(w==null?void 0:w.id)||(k==null?void 0:k.id);s.useEffect(()=>{const a=E("menu");h(fe(a.selected))},[]);const Q=s.useCallback(a=>{const o=[{...a.busData.values},{...a.addressData.values}],r=["/update-bus","/update-address"];n(!0),S.CommonAPI.multipleAPICall("PATCH",r,o).then(d=>{let i=!0;d.forEach(m=>{m.data.status!=="Success"&&(i=!1)}),i&&(n(!1),x(h,!0,"info","Successfully Updated",I,`/bus/listing/${E("class")}`)),n(!1)}).catch(d=>{var i,m;throw n(!1),x(h,!0,"error",(m=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:m.msg),d})},[l]),Y=s.useCallback(a=>{n(!0);const o=[`/get-by-pk/bus/${a}`,`/get-address/bus/${a}`];S.CommonAPI.multipleAPICall("GET",o).then(r=>{var i,m;r[0].data.data&&(r[0].data.data.dob=z(r[0].data.data.dob),r[0].data.data.admission_date=z(r[0].data.data.admission_date));const d={busData:r[0].data.data,addressData:(m=(i=r[1])==null?void 0:i.data)==null?void 0:m.data};D(d),n(!1)}).catch(r=>{var d,i;throw n(!1),x(h,!0,"error",(i=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:i.msg),r})},[]),J=s.useCallback(a=>{n(!0),S.BusAPI.createBus({...a.busData.values}).then(({data:o})=>{(o==null?void 0:o.status)==="Success"&&S.AddressAPI.createAddress({...a.addressData.values,parent_id:o.data.id,parent:"bus"}).then(()=>{n(!1),x(h,!0,"success","Successfully Created",I,"/bus/listing")}).catch(r=>{throw n(!1),x(h,!0,r||"An Error Occurred"),r})}).catch(o=>{var r,d;throw n(!1),x(h,!0,"error",(d=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:d.msg),o})},[l]);s.useEffect(()=>{var a;y&&!C&&(_("Update"),Y(y)),l.busData.validated&&l.addressData.validated?(a=l.busData.values)!=null&&a.id?Q(l):J(l):g(!1)},[y,C]);const K=async()=>{await q.current.Submit(),await W.current.Submit(),g(!0)},L=(a,o)=>{o==="bus"?p({...l,busData:a}):o==="address"&&p({...l,addressData:a})};return t.jsxs(B,{m:"10px",sx:{backgroundImage:A.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${U})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${U})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed",marginBottom:"20px !important",height:"95vh"},children:[t.jsx(ve,{fontFamily:$.fontFamily,fontSize:$.h2.fontSize,color:G.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${v} ${V}`}),t.jsx(H,{onChange:a=>{L(a,"bus")},refId:q,setDirty:e,reset:P,setReset:F,userId:y,updatedValues:u==null?void 0:u.busData}),t.jsx(be,{onChange:a=>{L(a,"address")},refId:W,update:!!y,setDirty:e,reset:P,setReset:F,updatedValues:u==null?void 0:u.addressData}),t.jsxs(B,{display:"flex",justifyContent:"end",m:"20px",children:[v==="Update"?null:t.jsx(N,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!j||C,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&F(!0)},children:"Reset"}),t.jsx(N,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>I(`/bus/listing/${E("class")||""}`),children:"Cancel"}),t.jsx(N,{type:"submit",onClick:()=>K(),disabled:!j,color:v==="Update"?"info":"success",variant:"contained",children:"Submit"}),t.jsx(pe,{alerting:R.toastAlert,severity:R.toastSeverity,message:R.toastMessage})]}),T===!0?t.jsx(ge,{}):null]})};export{De as default};
