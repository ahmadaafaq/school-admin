import{k as de,l as K,H as Z,P as R,a as s,m as $,o as le,u as ce,b as ue,z as he,R as pe,A as y,K as ve,j as t,B,q as ee,v as S,I,S as j,M as b,C as _,U as re,n as me,E as ge,t as fe,p as xe,d as Ce,s as Se,f as se,T as Ie,h as ae,x as je,y as be}from"./index-dsWAcX1f.js";import{c as ie}from"./index-mbUFVO5S.js";import{a as ne}from"./SectionAction-OMdiSl6G.js";import{s as _e,a as ye}from"./StudentAction-ladqeq7I.js";import{a as Fe}from"./TeacherAction-MaPUeMMF.js";import{u as De}from"./index-uKa1WJb8.js";const Te=de().shape({name:K().min(2,"Name is Too Short!").max(40,"Name is Too Long!").required("This Field is Required"),color_code:K().required("This Field is Required"),captain:Z().required("This Field is Required"),vice_captain:Z().required("This Field is Required"),teacher_incharge:Z().required("This Field is Required"),strength:K().required("This Field is Required"),status:K()}),Ae={name:"",color_code:"",captain:"",captainClassId:"",captainSectionId:"",vice_captain:"",viceCaptainClassId:"",viceCaptainSectionId:"",teacher_incharge:"",strength:"",status:"inactive"};let te={};const oe=({onChange:k,refId:U,setDirty:Q,reset:o,setReset:h,updatedValues:w=null})=>{var m,N,g,P,z,L,M,G,i,f;const[Y,J]=s.useState(Ae),[d,X]=s.useState([]),l=$(a=>a.schoolClasses),c=$(a=>a.schoolSections),H=$(a=>a.allStudents),F=$(a=>a.allFormStudents),p=$(a=>a.allFormTeachers),E=le(),D=ce(),T=ue("(min-width:600px)"),{fetchAndSetSchoolData:v}=re(),{getStudents:V,getPaginatedData:q}=De(),e=he({initialValues:Y,validationSchema:Te,enableReinitialize:!0,onSubmit:()=>W()});pe.useImperativeHandle(U,()=>({Submit:async()=>{await e.submitForm()}}));const W=()=>{k&&k({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})},O=a=>{const x=((d==null?void 0:d.filter(u=>u.class_id===a))||[]).map(({section_id:u,section_name:n})=>({section_id:u,section_name:n}));te={...te,[a]:x},E(ne(te))};return s.useEffect(()=>{o&&(e.resetForm(),h(!1))},[o]),s.useEffect(()=>{e.dirty&&Q(!0)},[e.dirty]),s.useEffect(()=>{w&&J(w)},[w]),s.useEffect(()=>{var a,r;(r=(a=p==null?void 0:p.listData)==null?void 0:a.rows)!=null&&r.length||q(0,40,Fe,y.TeacherAPI)},[]),s.useEffect(()=>{var a,r;(!((a=l==null?void 0:l.listData)!=null&&a.length)||!((r=c==null?void 0:c.listData)!=null&&r.length))&&v(E,ve,ne,X)},[]),s.useEffect(()=>{e.values.captainClassId&&e.values.captainSectionId&&V(e.values.captainClassId,e.values.captainSectionId,_e,y)},[e.values.captainClassId,e.values.captainSectionId]),s.useEffect(()=>{O(e.values.captainClassId)},[e.values.captainClassId,d==null?void 0:d.length]),s.useEffect(()=>{e.values.viceCaptainClassId&&e.values.viceCaptainSectionId&&V(e.values.viceCaptainClassId,e.values.viceCaptainSectionId,ye,y)},[e.values.viceCaptainClassId,e.values.viceCaptainSectionId]),s.useEffect(()=>{O(e.values.viceCaptainClassId)},[e.values.viceCaptainClassId,d==null?void 0:d.length]),t.jsx(B,{m:"20px",children:t.jsxs("form",{ref:U,children:[t.jsxs(B,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",sx:{"& > div":{gridColumn:T?void 0:"span 4"},marginBottom:"40px"},children:[t.jsx(ee,{variant:"filled",type:"text",name:"name",label:"Name*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.name,error:!!e.touched.name&&!!e.errors.name,helperText:e.touched.name&&e.errors.name}),t.jsx(ee,{variant:"filled",type:"text",name:"color_code",label:"Color Code",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.color_code,error:!!e.touched.color_code&&!!e.errors.color_code,helperText:e.touched.color_code&&e.errors.color_code}),t.jsx(ee,{fullWidth:!0,variant:"filled",type:"text",name:"strength",label:"Strength",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.strength,error:!!e.touched.strength&&!!e.errors.strength,helperText:e.touched.strength&&e.errors.strength}),t.jsxs(S,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[t.jsx(I,{id:"statusField",children:"Status"}),t.jsx(j,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(ie.status).map(a=>t.jsx(b,{value:a,children:ie.status[a]},a))}),t.jsx(_,{children:e.touched.status&&e.errors.status})]}),t.jsxs(S,{variant:"filled",sx:{minWidth:120},error:!!e.touched.teacher_incharge&&!!e.errors.teacher_incharge,children:[t.jsx(I,{id:"teacherInchargeField",children:"Teacher Incharge Name"}),t.jsx(j,{labelId:"teacherInchargeField",name:"teacher_incharge",value:e.values.teacher_incharge||"",onChange:a=>e.setFieldValue("teacher_incharge",a.target.value),children:(N=(m=p==null?void 0:p.listData)==null?void 0:m.rows)!=null&&N.length?p.listData.rows.map(a=>t.jsx(b,{value:a.id,name:`${a.firstname} ${a.lastname}`,children:`${a.firstname} ${a.lastname}`},a.id)):null}),t.jsx(_,{children:e.touched.teacher_incharge&&e.errors.teacher_incharge})]})]}),t.jsxs("fieldset",{style:{border:D.palette.mode==="light"?"2px solid rgb(0 165 201)":"2px solid #BADFE7",borderRadius:"10px",padding:"10px",margin:"20px 0px 20px 0px"},children:[t.jsx("legend",{style:{color:D.palette.mode==="light"?"rgb(0 165 201)":"#BADFE7",fontWeight:"bold",padding:"5px",fontSize:"larger"},children:"Captain"}),t.jsxs(B,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",children:[t.jsxs(S,{variant:"filled",sx:{minWidth:120},error:!!e.touched.captainClassId&&!!e.errors.captainClassId,children:[t.jsx(I,{children:"Class"}),t.jsx(j,{variant:"filled",name:"captainClassId",value:e.values.captainClassId,onChange:a=>{e.setFieldValue("captainClassId",a.target.value),e.values.captainSectionId&&e.setFieldValue("captainSectionId",""),e.values.captain&&e.setFieldValue("captain","")},children:(g=l==null?void 0:l.listData)!=null&&g.length?l.listData.map(a=>t.jsx(b,{value:a.class_id,name:a.class_name,children:a.class_name},a.class_name)):null}),t.jsx(_,{children:e.touched.captainClassId&&e.errors.captainClassId})]}),t.jsxs(S,{variant:"filled",sx:{minWidth:120},error:!!e.touched.captainSectionId&&!!e.errors.captainSectionId,children:[t.jsx(I,{children:"Section"}),t.jsx(j,{variant:"filled",name:"captainSectionId",value:e.values.captainSectionId,onChange:a=>{e.setFieldValue("captainSectionId",a.target.value),e.values.captain&&e.setFieldValue("captain","")},children:(P=c==null?void 0:c.listData[e.values.captainClassId])!=null&&P.length?c.listData[e.values.captainClassId].map(a=>t.jsx(b,{value:a.section_id,name:a.section_name,children:a.section_name},a.section_id)):null}),t.jsx(_,{children:e.touched.captainSectionId&&e.errors.captainSectionId})]}),t.jsxs(S,{variant:"filled",sx:{minWidth:220},error:!!e.touched.captain&&!!e.errors.captain,children:[t.jsx(I,{children:"Name"}),t.jsx(j,{variant:"filled",name:"captain",value:e.values.captain,onChange:a=>e.setFieldValue("captain",a.target.value),children:(L=(z=F==null?void 0:F.listData)==null?void 0:z.rows)!=null&&L.length?F.listData.rows.map(a=>t.jsx(b,{value:a.id,name:`${a.firstname} ${a.lastname}`,children:`${a.firstname.charAt(0).toUpperCase()+a.firstname.slice(1)} ${a.lastname.charAt(0).toUpperCase()+a.lastname.slice(1)}`},a.id)):null}),t.jsx(_,{children:e.touched.captain&&e.errors.captain})]})]})]}),t.jsxs("fieldset",{style:{border:D.palette.mode==="light"?"2px solid rgb(0 165 201)":"2px solid #BADFE7",borderRadius:"10px",padding:"10px",margin:"10px 0px 10px 0px"},children:[t.jsx("legend",{style:{color:D.palette.mode==="light"?"rgb(0 165 201)":"#BADFE7",fontWeight:"bold",padding:"5px",fontSize:"larger"},children:"Vice Captain"}),t.jsxs(B,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",children:[t.jsxs(S,{variant:"filled",sx:{minWidth:120},error:!!e.touched.viceCaptainClassId&&!!e.errors.viceCaptainClassId,children:[t.jsx(I,{children:"Class"}),t.jsx(j,{variant:"filled",name:"viceCaptainClassId",value:e.values.viceCaptainClassId,onChange:a=>{e.setFieldValue("viceCaptainClassId",a.target.value),e.values.viceCaptainSectionId&&e.setFieldValue("viceCaptainSectionId",""),e.values.vice_captain&&e.setFieldValue("vice_captain","")},children:(M=l==null?void 0:l.listData)!=null&&M.length?l.listData.map(a=>t.jsx(b,{value:a.class_id,name:a.class_name,children:a.class_name},a.class_name)):null}),t.jsx(_,{children:e.touched.viceCaptainClassId&&e.errors.viceCaptainClassId})]}),t.jsxs(S,{variant:"filled",sx:{minWidth:120},error:!!e.touched.viceCaptainSectionId&&!!e.errors.viceCaptainSectionId,children:[t.jsx(I,{children:"Section"}),t.jsx(j,{variant:"filled",name:"viceCaptainSectionId",value:e.values.viceCaptainSectionId,onChange:a=>{e.setFieldValue("viceCaptainSectionId",a.target.value),e.values.vice_captain&&e.setFieldValue("vice_captain","")},children:(G=c==null?void 0:c.listData[e.values.viceCaptainClassId])!=null&&G.length?c.listData[e.values.viceCaptainClassId].map(a=>t.jsx(b,{value:a.section_id,name:a.section_name,children:a.section_name},a.section_id)):null}),t.jsx(_,{children:e.touched.viceCaptainSectionId&&e.errors.viceCaptainSectionId})]}),t.jsxs(S,{variant:"filled",sx:{minWidth:220},error:!!e.touched.vice_captain&&!!e.errors.vice_captain,children:[t.jsx(I,{children:"Name"}),t.jsx(j,{variant:"filled",name:"vice_captain",value:e.values.vice_captain,onChange:a=>e.setFieldValue("vice_captain",a.target.value),children:(f=(i=H==null?void 0:H.listData)==null?void 0:i.rows)!=null&&f.length?H.listData.rows.map(a=>t.jsx(b,{value:a.id,name:`${a.firstname} ${a.lastname}`,children:`${a.firstname.charAt(0).toUpperCase()+a.firstname.slice(1)} ${a.lastname.charAt(0).toUpperCase()+a.lastname.slice(1)}`},a.id)):null}),t.jsx(_,{children:e.touched.vice_captain&&e.errors.vice_captain})]})]})]})]})})};oe.propTypes={onChange:R.func,refId:R.shape({current:R.any}),setDirty:R.func,reset:R.bool,setReset:R.func,updatedValues:R.object};const Be=()=>{const[k,U]=s.useState("Create"),[Q,o]=s.useState(!1),[h,w]=s.useState({schoolHouseData:{values:null,validated:!1}}),[Y,J]=s.useState(null),[d,X]=s.useState(!1),[l,c]=s.useState(!1),[H,F]=s.useState(!1),p=$(i=>i.menuItems.selected),E=$(i=>i.toastInfo),D=s.useRef(),T=me(),v=le(),V=ge(),q=ce(),e=fe(q.palette.mode),{state:W}=xe(),{typography:O}=Ce(q.palette.mode),{toastAndNavigate:m,getLocalStorage:N}=re();let g=(W==null?void 0:W.id)||(V==null?void 0:V.id);s.useEffect(()=>{const i=N("menu");v(Se(i.selected))},[]);const P=s.useCallback(i=>{o(!0);const{captainClassId:f,captainSectionId:a,viceCaptainClassId:r,viceCaptainSectionId:x,...u}=i.schoolHouseData.values;y.SchoolHouseAPI.updateSchoolHouse(u).then(({data:n})=>{n.status==="Success"&&(o(!1),m(v,!0,"info","Successfully Updated",T,"/school-house/listing"))}).catch(n=>{var C,A;o(!1),m(v,!0,"error",n?(A=(C=n==null?void 0:n.response)==null?void 0:C.data)==null?void 0:A.msg:"An Error Occurred",T,`/school-house/update/${g}`),console.log("error updating school house",n)})},[h]),z=s.useCallback(i=>{o(!0);const f=[`/get-by-pk/school_house/${i}`];y.CommonAPI.multipleAPICall("GET",f).then(a=>{if(console.log(a,a[0].data.data,"res"),a[0].data.status==="Success"){const r=a[0].data.data.captain,x=a[0].data.data.vice_captain;Promise.all([y.StudentAPI.getClassOfStudent(r),y.StudentAPI.getClassOfStudent(x)]).then(u=>{const[n,C]=u,A={...a[0].data.data,captainClassId:n.data.class,captainSectionId:n.data.section,viceCaptainClassId:C.data.class,viceCaptainSectionId:C.data.section};J(A),o(!1)}).catch(u=>{console.error("Error in API calls of populating school house:",u)})}}).catch(a=>{var r,x;o(!1),m(v,!0,"error",a?(x=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:x.msg:"An Error Occurred",T,0)})},[g]),L=s.useCallback(i=>{o(!0);const{captainClassId:f,captainSectionId:a,viceCaptainClassId:r,viceCaptainSectionId:x,...u}=i.schoolHouseData.values;y.SchoolHouseAPI.createSchoolHouse(u).then(({data:n})=>{n.status==="Success"&&(o(!1),m(v,!0,"success","Successfully Created",T,"/school-house/listing"))}).catch(n=>{var C,A;o(!1),m(v,!0,n?(A=(C=n.response)==null?void 0:C.data)==null?void 0:A.msg:"An Error Occurred"),console.log("error creating school house",n)})},[h]);s.useEffect(()=>{var i;g&&!l&&(U("Update"),z(g)),h.schoolHouseData.validated?(i=h.schoolHouseData.values)!=null&&i.id?P(h):L(h):c(!1)},[g,l]);const M=async()=>{await D.current.Submit(),c(!0)},G=(i,f)=>{f=="schoolHouse"&&w({...h,schoolHouseData:i})};return t.jsxs(B,{m:"10px",sx:{backgroundImage:q.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${se})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${se})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed",height:"100%"},children:[t.jsx(Ie,{fontFamily:O.fontFamily,fontSize:O.h2.fontSize,color:e.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${k} ${p}`}),t.jsx(oe,{onChange:i=>{G(i,"schoolHouse")},refId:D,setDirty:X,reset:H,setReset:F,updatedValues:Y}),t.jsxs(B,{display:"flex",justifyContent:"end",m:"20px",children:[k==="Update"?null:t.jsx(ae,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!d||l,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&F(!0)},children:"Reset"}),t.jsx(ae,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>T("/school-house/listing"),children:"Cancel"}),t.jsx(ae,{type:"submit",onClick:()=>M(),disabled:!d,color:k==="Update"?"info":"success",variant:"contained",children:"Submit"}),t.jsx(je,{alerting:E.toastAlert,severity:E.toastSeverity,message:E.toastMessage})]}),Q===!0?t.jsx(be,{}):null]})};export{Be as default};
