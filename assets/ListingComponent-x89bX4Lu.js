import{m as h,n as O,u as ee,t as te,j as i,B as T,T as ne,h as U,U as ie,a as c,o as le,b as H,A as M,J as re,K as oe,s as ce,v as V,I as X,S as Z,M as z,P as he}from"./index-dsWAcX1f.js";import{d as ge,l as j,S as ue,a as fe,b as me}from"./listBG-dw88K66u.js";import{a as F,s as xe}from"./MarksheetAction-mDmtmycw.js";import{s as pe,a as S}from"./SectionAction-OMdiSl6G.js";import{s as _e}from"./SubjectAction-p-rplfCF.js";import{u as ve}from"./index-uKa1WJb8.js";import"./FormControlLabel-GbaKk4ky.js";import"./toPropertyKey-Z1a84DJL.js";import"./typeof-LnL08gqA.js";import"./CircularProgress-4dZqOr9B.js";const Ae=(B=null)=>{const e=h(n=>n.schoolClasses),g=h(n=>n.allClasses),s=h(n=>n.schoolSections),A=h(n=>n.allSections),x=O(),p=ee(),l=te(p.palette.mode),{appendSuffix:_,findById:d}=ie(),R=(n,o,a)=>{x(`/marksheet/update/${o}`,{state:{id:n,student_id:o,term:a}})};return[{field:"student_id",headerName:"Student Id",headerAlign:"center",align:"center",flex:1,minWidth:100},{field:"class_id",headerName:"Class",headerAlign:"center",align:"center",flex:1,minWidth:100,renderCell:n=>{var u,I,W,k,b,L,E,f,N,w,D,C;let o,a;return(u=g==null?void 0:g.listData)!=null&&u.length||(I=A==null?void 0:A.listData)!=null&&I.length?(o=(k=d((W=n==null?void 0:n.row)==null?void 0:W.class_id,g==null?void 0:g.listData))==null?void 0:k.class_name,a=(L=d((b=n==null?void 0:n.row)==null?void 0:b.section_id,A==null?void 0:A.listData))==null?void 0:L.section_name):((E=e==null?void 0:e.listData)!=null&&E.length||(f=s==null?void 0:s.listData)!=null&&f.length)&&(o=(w=d((N=n==null?void 0:n.row)==null?void 0:N.class_id,e==null?void 0:e.listData))==null?void 0:w.class_name,a=(C=d((D=n==null?void 0:n.row)==null?void 0:D.section_id,s==null?void 0:s.listData))==null?void 0:C.section_name),i.jsxs("div",{children:[o?_(o):"/"," ",a]})}},{field:"term",headerName:"Term",headerAlign:"center",align:"center",flex:2,minWidth:80},{field:"result",headerName:"Result",headerAlign:"center",align:"center",flex:1,minWidth:120,renderCell:({row:{result:n}})=>i.jsx(T,{width:"60%",m:"0 auto",p:"5px",display:"flex",justifyContent:"center",backgroundColor:n==="pass"?l.greenAccent[600]:n==="fail"?l.redAccent[700]:n==="Not Declared Yet"?l.greenAccent[400]:l.redAccent[700],borderRadius:"4px",children:i.jsx(ne,{color:l.grey[100],sx:{ml:"5px"},children:n.charAt(0).toUpperCase()+n.slice(1)||""})})},B!==1&&{field:"action",headerName:"ACTION",headerAlign:"center",align:"center",flex:1,minWidth:75,renderCell:({row:{id:n,student_id:o,term:a}})=>i.jsx(T,{width:"30%",m:"0 auto",p:"5px",display:"flex",justifyContent:"center",children:i.jsx(U,{color:"info",variant:"contained",onClick:()=>R(n,o,a),sx:{minWidth:"50px"},children:i.jsx(ge,{})})})}]},Ie=[5,10,20],ye=({rolePriority:B=null})=>{var Q,G,J,K,Y,q;const[e,g]=c.useState(null),[s,A]=c.useState([]),x=h(t=>t.schoolClasses),p=h(t=>t.allClasses),l=h(t=>t.schoolSections),_=h(t=>t.allSections),d=h(t=>t.allSubjects),R=h(t=>t.menuItems.selected),{listData:r,loading:n}=h(t=>t.allMarksheets),o=O(),a=le(),u=H("(max-width:480px)"),I=H("(max-width:920px)"),[W,k]=c.useState({search:!1,searching:!1}),[b,L]=c.useState(),E=ee(),f=te(E.palette.mode),N=document.getElementById("reload-btn"),{getPaginatedData:w}=ve(),{getLocalStorage:D,fetchAndSetAll:C,fetchAndSetSchoolData:se,findMultipleById:ae}=ie(),de=()=>{N.style.display="none",k({search:!1,searching:!1,oldPagination:b})};let m=e!=null&&e.class_id?{classId:e.class_id}:null;return m=e!=null&&e.section_id?{...m,sectionId:e.section_id}:null,c.useEffect(()=>{e!=null&&e.class_id&&(e!=null&&e.section_id)&&w(0,8,F,M.MarksheetAPI,m)},[m==null?void 0:m.classId,m==null?void 0:m.sectionId]),c.useEffect(()=>{var t;(t=d==null?void 0:d.listData)!=null&&t.length||C(a,_e,M.SubjectAPI)},[]),c.useEffect(()=>{(()=>{const P=((s==null?void 0:s.filter(v=>v.class_id===(e==null?void 0:e.class_id)))||[]).map(({section_id:v,section_name:$})=>({section_id:v,section_name:$}));a(S(P))})()},[e==null?void 0:e.class_id,s==null?void 0:s.length]),c.useEffect(()=>{(()=>{var v;const y=s==null?void 0:s.filter($=>$.class_id===(e==null?void 0:e.class_id)&&$.section_id===(e==null?void 0:e.section_id)),P=y?ae((v=y[0])==null?void 0:v.subject_ids,d==null?void 0:d.listData):[];a(xe({selectedSubjects:P,classDataObj:y[0]}))})()},[e==null?void 0:e.class_id,e==null?void 0:e.section_id,(Q=d==null?void 0:d.listData)==null?void 0:Q.length,s.length]),c.useEffect(()=>{var t,y,P,v;D("schoolInfo")||((t=p==null?void 0:p.listData)!=null&&t.length||C(a,re,M.ClassAPI),(y=_==null?void 0:_.listData)!=null&&y.length||C(a,pe,M.SectionAPI)),D("schoolInfo")&&(!((P=x==null?void 0:x.listData)!=null&&P.length)||!((v=l==null?void 0:l.listData)!=null&&v.length))&&se(a,oe,S,A)},[]),c.useEffect(()=>{const t=D("menu");a(ce(t.selected))},[]),c.useEffect(()=>{var t;(t=r==null?void 0:r.rows)!=null&&t.length&&!(e!=null&&e.class_id)&&!(e!=null&&e.section_id)&&g({...e,class_id:r.rows[0].class_id,section_id:r.rows[0].section_id})},[(G=r==null?void 0:r.rows)==null?void 0:G.length,e==null?void 0:e.section_id]),i.jsxs(T,{m:"10px",position:"relative",sx:{borderRadius:"20px",border:"0.5px solid black",overflow:"hidden",boxShadow:"1px 1px 10px black",backgroundImage:E.palette.mode==="light"?`linear-gradient(rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6)), url(${j})`:`linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url(${j})`,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"},children:[i.jsx(T,{height:u?"19vh":I?"8vh":"11vh",borderRadius:"4px",padding:u?"1vh":"2vh",backgroundColor:f.blueAccent[700],children:i.jsxs(T,{display:"flex",height:u?"16vh":"7vh",flexDirection:u?"column":"row",justifyContent:"space-between",alignItems:u?"center":"normal",children:[i.jsx(ne,{component:"h2",variant:"h2",color:f.grey[100],fontWeight:"bold",marginRight:"15px",children:R}),i.jsx(ue,{action:F,api:M.MarksheetAPI,getSearchData:w,oldPagination:b,reloadBtn:N,setSearchFlag:k}),i.jsxs(V,{variant:"filled",sx:{minWidth:120,marginRight:"10px"},children:[i.jsx(X,{id:"classfield",children:"Class"}),i.jsx(Z,{variant:"filled",labelId:"classfield",value:(e==null?void 0:e.class_id)||"",onChange:t=>g({...e,class_id:t.target.value}),sx:{height:"100%",marginLeft:"1vh",backgroundColor:f.blueAccent[800],"&:hover":{backgroundColor:f.blueAccent[800]}},children:(J=p==null?void 0:p.listData)!=null&&J.length?p.listData.map(t=>i.jsx(z,{value:t.class_id,children:t.class_name},t.class_id)):(K=x==null?void 0:x.listData)!=null&&K.length?x.listData.map(t=>i.jsx(z,{value:t.class_id,children:t.class_name},t.class_id)):null})]}),i.jsxs(V,{variant:"filled",sx:{minWidth:120,height:I?"4vh":"auto"},children:[i.jsx(X,{id:"sectionfield",children:"Section"}),i.jsx(Z,{variant:"filled",labelId:"sectionfield",value:(e==null?void 0:e.section_id)||"",onChange:t=>g({...e,section_id:t.target.value}),sx:{height:"100%",marginRight:"1vh",backgroundColor:f.blueAccent[800],"&:hover":{backgroundColor:f.blueAccent[800]}},children:(Y=_==null?void 0:_.listData)!=null&&Y.length?_.listData.map(t=>i.jsx(z,{value:t.section_id,children:t.section_name},t.section_id)):(q=l==null?void 0:l.listData)!=null&&q.length?l.listData.map(t=>i.jsx(z,{value:t.section_id,children:t.section_name},t.section_id)):null})]}),B>1&&i.jsxs(U,{color:"success",disabled:!(e!=null&&e.class_id)||!(e!=null&&e.section_id),variant:"contained",type:"submit",onClick:()=>o("/marksheet/create"),sx:{height:I?"4vh":"auto"},children:["Create New ",R]})]})}),i.jsxs(U,{sx:{display:"none",position:"absolute",top:u?"23vh":I?"10.5vh":"16.5vh",left:u?"80vw":I?"39.5vw":"26vw",zIndex:1,borderRadius:"20%",color:f.grey[100],marginLeft:"14vh"},id:"reload-btn",type:"button",onClick:de,children:[i.jsx("span",{style:{display:"inherit",marginRight:"5px"},children:i.jsx(fe,{})}),"Back"]}),i.jsx(me,{action:F,api:M.MarksheetAPI,getQuery:w,columns:Ae(B),rows:r.rows,count:r.count,loading:n,selected:R,pageSizeOptions:Ie,setOldPagination:L,searchFlag:W,setSearchFlag:k,condition:m})]})};ye.propTypes={rolePriority:he.number};export{ye as default};
