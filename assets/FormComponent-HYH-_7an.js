import{k as se,l as g,P as x,a as s,b as le,z as ne,R as oe,j as a,B as T,q as v,v as N,I as U,S as z,M as O,C as Y,m as V,n as re,o as ie,E as de,u as ue,t as ce,d as me,p as he,s as fe,A as H,f as G,T as pe,h as B,x as ge,y as xe,U as ye}from"./index-dsWAcX1f.js";import{d as Q}from"./dayjs.min-2OarEC18.js";import{A as ve}from"./AddressFormComponent-EqXGwUPp.js";import{c as S}from"./index-mbUFVO5S.js";import{a as be,A as Ce}from"./useMobilePicker-KFlc6nLK.js";import{D as je}from"./DatePicker-V9wsptq6.js";const Se=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Te=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,De=se().shape({firstname:g().min(2,"Firstname is Too Short!").max(20,"Firstname is Too Long!").required("This Field is Required"),lastname:g().min(2,"Lastname is Too Short!").max(20,"Lastname is Too Long!").required("This Field is Required"),email:g().matches(Te,"Email Address is Not Valid"),contact_no:g().matches(Se,"Phone Number Is Not Valid").required("This Field is Required"),gender:g().required("This Field is Required"),status:g()}),Re={firstname:"",lastname:"",email:"",contact_no:"",role:"",dob:null,gender:"",status:"inactive"},J=({onChange:m,refId:b,setDirty:D,reset:d,setReset:o,updatedValues:h=null})=>{const[u,R]=s.useState(Re),C=le("(min-width:600px)"),e=ne({initialValues:u,validationSchema:De,enableReinitialize:!0,onSubmit:()=>y()});oe.useImperativeHandle(b,()=>({Submit:async()=>{await e.submitForm()}}));const y=()=>{m&&m({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return s.useEffect(()=>{d&&(e.resetForm(),o(!1))},[d]),s.useEffect(()=>{e.dirty&&D(!0)},[e.dirty]),s.useEffect(()=>{h&&R(h)},[h]),a.jsx(T,{m:"20px",children:a.jsx("form",{ref:b,children:a.jsxs(T,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:C?void 0:"span 4"}},children:[a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",name:"firstname",label:"Firstname*",autoComplete:"new-firstname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.firstname,error:!!e.touched.firstname&&!!e.errors.firstname,helperText:e.touched.firstname&&e.errors.firstname}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",name:"lastname",label:"Lastname*",autoComplete:"new-lastname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.lastname,error:!!e.touched.lastname&&!!e.errors.lastname,helperText:e.touched.lastname&&e.errors.lastname}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",autoComplete:"new-email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),a.jsx(v,{fullWidth:!0,variant:"filled",type:"text",label:"Role",name:"role",autoComplete:"new-role",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.role,error:!!e.touched.role&&!!e.errors.role,helperText:e.touched.role&&e.errors.role}),a.jsx(be,{dateAdapter:Ce,children:a.jsx(je,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Select Date Of Birth",name:"dob",required:!0,value:e.values.dob,onChange:n=>{e.setFieldValue("dob",n)}})}),a.jsxs(N,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[a.jsx(U,{children:"Gender"}),a.jsx(z,{variant:"filled",name:"gender",value:e.values.gender,onChange:e.handleChange,children:Object.keys(S.gender).map(n=>a.jsx(O,{value:n,children:S.gender[n]},n))}),a.jsx(Y,{children:e.touched.gender&&e.errors.gender})]}),a.jsxs(N,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(U,{children:"Status"}),a.jsx(z,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(S.status).map(n=>a.jsx(O,{value:n,children:S.status[n]},n))}),a.jsx(Y,{children:e.touched.status&&e.errors.status})]})]})})})};J.propTypes={onChange:x.func.isRequired,refId:x.any.isRequired,setDirty:x.func.isRequired,reset:x.func.isRequired,setReset:x.func.isRequired,updatedValues:x.object};const qe=()=>{const[m,b]=s.useState("Create"),[D,d]=s.useState(!1),[o,h]=s.useState({employeeData:{values:null,validated:!1},addressData:{values:null,validated:!1},imageData:{values:null,validated:!0}}),[u,R]=s.useState(null),[C,e]=s.useState(!1),[y,n]=s.useState(!1),[L,F]=s.useState(!1),K=V(t=>t.menuItems.selected),k=V(t=>t.toastInfo),P=s.useRef(),$=s.useRef(),M=re(),j=ie(),w=de(),I=ue(),X=ce(I.palette.mode),{typography:_}=me(I.palette.mode),{state:A}=he(),{toastAndNavigate:E,getLocalStorage:q}=ye();let f=(A==null?void 0:A.id)||(w==null?void 0:w.id);s.useEffect(()=>{const t=q("menu");j(fe(t.selected))},[]);const Z=s.useCallback(t=>{const p=[{...t.employeeData.values},{...t.addressData.values}],l=["/update-employee","/update-address"];d(!0),H.CommonAPI.multipleAPICall("PATCH",l,p).then(r=>{let i=!0;r.forEach(c=>{c.data.status!=="Success"&&(i=!1)}),i&&(d(!1),E(j,!0,"info","Successfully Updated",M,`/employee/listing/${q("class")}`)),d(!1)}).catch(r=>{var i,c;throw d(!1),E(j,!0,"error",(c=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:c.msg),r})},[o]),ee=s.useCallback(t=>{d(!0);const p=[`/get-by-pk/employee/${t}`,`/get-address/employee/${t}`];H.CommonAPI.multipleAPICall("GET",p).then(l=>{var i,c;l[0].data.data&&(l[0].data.data.dob=Q(l[0].data.data.dob),l[0].data.data.admission_date=Q(l[0].data.data.admission_date));const r={employeeData:l[0].data.data,addressData:(c=(i=l[1])==null?void 0:i.data)==null?void 0:c.data};R(r),d(!1)}).catch(l=>{var r,i;throw d(!1),E(j,!0,"error",(i=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:i.msg),l})},[f]),ae=[o];s.useEffect(()=>{var t;f&&!y&&(b("Update"),ee(f)),o.employeeData.validated&&o.addressData.validated?(t=o.employeeData.values)!=null&&t.id?Z(o):ae(o):n(!1)},[f,y]);const te=async()=>{await P.current.Submit(),await $.current.Submit(),n(!0)},W=(t,p)=>{p==="employee"?h({...o,employeeData:t}):p==="address"&&h({...o,addressData:t})};return a.jsxs(T,{m:"10px",sx:{backgroundImage:I.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${G})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${G})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed"},children:[a.jsx(pe,{fontFamily:_.fontFamily,fontSize:_.h2.fontSize,color:X.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${m} ${K}`}),a.jsx(J,{onChange:t=>{W(t,"employee")},refId:P,setDirty:e,reset:L,setReset:F,userId:f,updatedValues:u==null?void 0:u.employeeData}),a.jsx(ve,{onChange:t=>{W(t,"address")},refId:$,update:!!f,setDirty:e,reset:L,setReset:F,updatedValues:u==null?void 0:u.addressData}),a.jsxs(T,{display:"flex",justifyContent:"end",m:"20px",children:[m==="Update"?null:a.jsx(B,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!C||y,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&F(!0)},children:"Reset"}),a.jsx(B,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>M(`/employee/listing/${q("class")||""}`),children:"Cancel"}),a.jsx(B,{type:"submit",onClick:()=>te(),disabled:!C,color:m==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(ge,{alerting:k.toastAlert,severity:k.toastSeverity,message:k.toastMessage})]}),D===!0?a.jsx(xe,{}):null]})};export{qe as default};
