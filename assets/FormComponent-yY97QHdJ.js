import{k as X,l as $,a0 as q,P as c,a as s,b as Z,z as ee,R as te,j as t,B as C,q as Y,v as ae,I as se,S as oe,M as le,C as ie,m as B,n as ne,o as re,E as de,u as ue,t as ce,d as he,p as me,s as pe,A as w,f as L,T as fe,h as A,x as ye,y as ge,U as xe}from"./index-dsWAcX1f.js";import{d as De}from"./dayjs.min-2OarEC18.js";import{c as U}from"./index-mbUFVO5S.js";import{a as ve,A as be}from"./useMobilePicker-KFlc6nLK.js";import{D as z}from"./DatePicker-V9wsptq6.js";const Ce=X().shape({title:$().min(2,"name is Too Short!").max(20,"name is Too Long!").required("This Field is Required"),startDate:q().required("This Field is Required"),endDate:q().required("This Field is Required"),holiday_type:$().required("This Field is Required")}),Se={title:"",startDate:null,endDate:null,holiday_type:"school_closure",notes:""},_=({onChange:h,refId:D,setDirty:S,reset:i,setReset:d,updatedValues:p=null})=>{const[f,j]=s.useState(Se),v=Z("(min-width:600px)"),e=ee({initialValues:f,validationSchema:Ce,enableReinitialize:!0,onSubmit:()=>y()});te.useImperativeHandle(D,()=>({Submit:async()=>{await e.submitForm()}}));const y=()=>{h&&h({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return s.useEffect(()=>{i&&(e.resetForm(),d(!1))},[i]),s.useEffect(()=>{e.dirty&&S(!0)},[e.dirty]),s.useEffect(()=>{p&&j(p)},[p]),t.jsx(C,{m:"20px",children:t.jsx("form",{ref:D,children:t.jsxs(C,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:v?void 0:"span 4"}},children:[t.jsx(Y,{fullWidth:!0,variant:"filled",type:"text",name:"title",label:"Title*",autoComplete:"new-title",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.title,error:!!e.touched.title&&!!e.errors.title,helperText:e.touched.title&&e.errors.title}),t.jsxs(ve,{dateAdapter:be,children:[t.jsx(z,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Closing Date",name:"startDate",value:e.values.startDate,onChange:n=>e.setFieldValue("startDate",n),slotProps:{textField:{error:!!e.touched.startDate&&!!e.errors.startDate,helperText:e.touched.startDate&&e.errors.startDate}}}),t.jsx(z,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Opening Date",name:"endDate",value:e.values.endDate,onChange:n=>e.setFieldValue("endDate",n),slotProps:{textField:{error:!!e.touched.endDate&&!!e.errors.endDate,helperText:e.touched.endDate&&e.errors.endDate}}})]}),t.jsxs(ae,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type&&!!e.errors.type,children:[t.jsx(se,{children:"Holiday Type"}),t.jsx(oe,{variant:"filled",name:"holiday_type",value:e.values.type,onChange:e.handleChange,children:Object.keys(U.holiday_type).map(n=>t.jsx(le,{value:n,children:U.holiday_type[n]},n))}),t.jsx(ie,{children:e.touched.type&&e.errors.type})]}),t.jsx(Y,{fullWidth:!0,variant:"filled",type:"text",label:"Note",name:"notes",autoComplete:"new-notes",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.notes,error:!!e.touched.notes&&!!e.errors.notes,helperText:e.touched.notes&&e.errors.notes})]})})})};_.propTypes={onChange:c.func,refId:c.shape({current:c.any}),setDirty:c.func,reset:c.func,setReset:c.func,updatedValues:c.object};const Re=()=>{const[h,D]=s.useState("Create"),[S,i]=s.useState(!1),[d,p]=s.useState({holidayData:{values:null,validated:!1}}),[f,j]=s.useState(null),[v,e]=s.useState(!1),[y,n]=s.useState(!1),[W,P]=s.useState(!1),N=B(a=>a.menuItems.selected),T=B(a=>a.toastInfo),E=s.useRef(),F=ne(),m=re(),k=de(),I=ue(),O=ce(I.palette.mode),{typography:H}=he(I.palette.mode),{state:R}=me(),{toastAndNavigate:g,getLocalStorage:M}=xe();let x=(R==null?void 0:R.id)||(k==null?void 0:k.id);s.useEffect(()=>{const a=M("menu");m(pe(a.selected))},[]);const V=s.useCallback(a=>{const r=[{...a.holidayData.values}],o=["/update-holiday"];i(!0),w.CommonAPI.multipleAPICall("PATCH",o,r).then(l=>{let u=!0;l.forEach(b=>{b.data.status!=="Success"&&(u=!1)}),u&&(i(!1),g(m,!0,"info","Successfully Updated",F,`/holiday/listing/${M("class")||""}`)),i(!1)}).catch(l=>{var u,b;throw i(!1),g(m,!0,"error",(b=(u=l==null?void 0:l.response)==null?void 0:u.data)==null?void 0:b.msg),l})},[d]),G=s.useCallback(a=>{i(!0);const r=[`/get-by-pk/holiday/${a}`];w.CommonAPI.multipleAPICall("GET",r).then(o=>{o[0].data.data&&(o[0].data.data.date=De(o[0].data.data.date));const l={holidayData:o[0].data.data};j(l),i(!1)}).catch(o=>{var l,u;throw i(!1),g(m,!0,"error",(u=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:u.msg),o})},[x]),Q=s.useCallback(a=>{i(!0),w.HolidayAPI.createHoliday({...a.holidayData.values}).then(()=>{i(!1),g(m,!0,"success","Successfully Created",F,"/holiday/listing")}).catch(r=>{var o,l;throw i(!1),g(m,!0,"error",(l=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:l.msg),r})},[d]);s.useEffect(()=>{var a;x&&!y&&(D("Update"),G(x)),d.holidayData.validated?(a=d.holidayData.values)!=null&&a.id?V(d):Q(d):n(!1)},[x,y]);const J=async()=>{await E.current.Submit(),n(!0)},K=(a,r)=>{r==="holiday"&&p({...d,holidayData:a})};return t.jsxs(C,{m:"10px",sx:{backgroundImage:I.palette.mode=="light"?` linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${L})`:` linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${L})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed",height:"100%"},children:[t.jsx(fe,{fontFamily:H.fontFamily,fontSize:H.h2.fontSize,color:O.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${h} ${N}`}),t.jsx(_,{onChange:a=>{K(a,"holiday")},refId:E,setDirty:e,reset:W,setReset:P,userId:x,updatedValues:f==null?void 0:f.holidayData}),t.jsxs(C,{display:"flex",justifyContent:"end",m:"20px",children:[h==="Update"?null:t.jsx(A,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!v||y,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&P(!0)},children:"Reset"}),t.jsx(A,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>F(`/holiday/listing/${M("class")||""}`),children:"Cancel"}),t.jsx(A,{type:"submit",onClick:()=>J(),disabled:!v,color:h==="Update"?"info":"success",variant:"contained",children:"Submit"}),t.jsx(ye,{alerting:T.toastAlert,severity:T.toastSeverity,message:T.toastMessage})]}),S===!0?t.jsx(ge,{}):null]})};export{Re as default};
