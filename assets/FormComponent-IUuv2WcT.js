import{k as ue,H as Z,l as me,a0 as ee,P as g,a as s,m as M,o as re,b as he,z as pe,R as fe,K as ye,A as V,j as a,B as L,v as D,I as F,S as P,M as T,C as A,q as Q,x as ie,U as de,n as _e,E as ge,u as ve,t as xe,d as je,p as Se,s as be,f as te,T as Ce,h as J,y as De}from"./index-dsWAcX1f.js";import{d as ae}from"./dayjs.min-2OarEC18.js";import{c as k}from"./index-mbUFVO5S.js";import{a as se}from"./SectionAction-OMdiSl6G.js";import{s as Fe}from"./StudentAction-ladqeq7I.js";import{u as Pe}from"./index-uKa1WJb8.js";import{a as ne,A as le}from"./useMobilePicker-KFlc6nLK.js";import{D as X}from"./DatePicker-V9wsptq6.js";const Te=ue().shape({student_id:Z().required("This Field is Required"),academic_year:me().min(2,"Year is Too Short!").max(10,"Year is Too Long!").required("This Field is Required"),amount:Z().required("This Field is Required"),payment_date:ee().required("This Field is Required"),due_date:ee()}),Ae={class_id:"",section:"",student_id:"",academic_year:"",amount:"",due_date:null,type:"school",payment_status:"pending",payment_method:"cash",payment_date:null,late_fee:""},oe=({onChange:v,refId:W,setDirty:z,reset:i,setReset:u,updatedValues:R=null})=>{var B,w,b,f,U;const[N,H]=s.useState(Ae),[m,G]=s.useState([]),d=M(t=>t.schoolClasses),o=M(t=>t.schoolSections),x=M(t=>t.allFormStudents),j=M(t=>t.toastInfo),S=re(),I=he("(min-width:600px)"),{getStudents:q}=Pe(),{toastAndNavigate:h,fetchAndSetSchoolData:p}=de(),e=pe({initialValues:N,validationSchema:Te,enableReinitialize:!0,onSubmit:()=>Y()});fe.useImperativeHandle(W,()=>({Submit:async()=>{await e.submitForm()}}));const Y=()=>{v&&v({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return s.useEffect(()=>{i&&(e.resetForm(),u(!1))},[i]),s.useEffect(()=>{e.dirty&&z(!0)},[e.dirty]),s.useEffect(()=>{R&&H(R)},[R]),s.useEffect(()=>{var t,E;(!((t=d==null?void 0:d.listData)!=null&&t.length)||!((E=o==null?void 0:o.listData)!=null&&E.length))&&p(S,ye,se,G)},[]),s.useEffect(()=>{(()=>{const K=((m==null?void 0:m.filter($=>{var C;return $.class_id===((C=e.values)==null?void 0:C.class_id)}))||[]).map(({section_id:$,section_name:C})=>({section_id:$,section_name:C}));S(se(K))})()},[(B=e.values)==null?void 0:B.class_id,m==null?void 0:m.length]),s.useEffect(()=>{q(e.values.class_id,e.values.section,Fe,V)},[e.values.class_id,e.values.section]),a.jsx(L,{m:"20px",children:a.jsxs("form",{ref:W,children:[a.jsxs(L,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:I?void 0:"span 4"}},children:[a.jsxs(D,{variant:"filled",sx:{minWidth:120},error:!!e.touched.class_id&&!!e.errors.class_id,children:[a.jsx(F,{children:"--Class*--"}),a.jsx(P,{name:"class_id",variant:"filled",value:e.values.class_id,onChange:t=>{e.setFieldValue("class_id",t.target.value),e.values.section&&e.setFieldValue("section",""),e.values.student_id&&e.setFieldValue("student_id","")},children:(w=d==null?void 0:d.listData)!=null&&w.length?d.listData.map(t=>a.jsx(T,{value:t.class_id,name:t.class_name,children:t.class_name},t.class_id)):null}),a.jsx(A,{children:e.touched.class_id&&e.errors.class_id})]}),a.jsxs(D,{variant:"filled",sx:{minWidth:120},error:!!e.touched.section&&!!e.errors.section,children:[a.jsx(F,{children:"--Section*--"}),a.jsx(P,{name:"section",variant:"filled",value:e.values.section,onChange:t=>e.setFieldValue("section",t.target.value),onFocus:()=>{e.values.class_id||h(S,!0,"info","Please Select a Class First")},children:(b=o==null?void 0:o.listData)!=null&&b.length?o.listData.map(t=>a.jsx(T,{value:t.section_id,name:t.section_name,children:t.section_name},t.section_id)):null}),a.jsx(A,{children:e.touched.section&&e.errors.section})]}),a.jsxs(D,{variant:"filled",sx:{minWidth:120},error:!!e.touched.student_id&&!!e.errors.student_id,children:[a.jsx(F,{children:"--Student*--"}),a.jsx(P,{name:"student_id",variant:"filled",value:e.values.student_id,onChange:t=>e.setFieldValue("student_id",t.target.value),onFocus:()=>{e.values.class_id||h(S,!0,"info","Please Select a Class First")},children:(U=(f=x==null?void 0:x.listData)==null?void 0:f.rows)!=null&&U.length?x.listData.rows.map(t=>a.jsx(T,{value:t.id,name:`${t.firstname} ${t.lastname}`,children:`${t.firstname.charAt(0).toUpperCase()+t.firstname.slice(1)} ${t.lastname.charAt(0).toUpperCase()+t.lastname.slice(1)}`},t.id)):null}),a.jsx(A,{children:e.touched.student_id&&e.errors.student_id})]}),a.jsx(Q,{fullWidth:!0,variant:"filled",type:"text",name:"academic_year",label:"Academic Year",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.academic_year,error:!!e.touched.academic_year&&!!e.errors.academic_year,helperText:e.touched.academic_year&&e.errors.academic_year}),a.jsx(Q,{fullWidth:!0,variant:"filled",type:"number",name:"amount",label:"Amount",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.amount,error:!!e.touched.amount&&!!e.errors.amount,helperText:e.touched.amount&&e.errors.amount}),a.jsx(ne,{dateAdapter:le,children:a.jsx(X,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Select Due Date",name:"due_date",required:!0,value:e.values.due_date,onChange:t=>{e.setFieldValue("date",t)}})}),a.jsxs(D,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type&&!!e.errors.type,children:[a.jsx(F,{children:"Type"}),a.jsx(P,{name:"type",variant:"filled",value:e.values.type,onChange:e.handleChange,children:Object.keys(k.type).map(t=>a.jsx(T,{value:t,children:k.type[t]},t))}),a.jsx(A,{children:e.touched.type&&e.errors.type})]}),a.jsxs(D,{variant:"filled",sx:{minWidth:120},error:!!e.touched.payment_method&&!!e.errors.payment_method,children:[a.jsx(F,{children:"Payment Method"}),a.jsx(P,{variant:"filled",name:"payment_method",value:e.values.payment_method,onChange:e.handleChange,children:Object.keys(k.payment_method).map(t=>a.jsx(T,{value:t,children:k.payment_method[t]},t))}),a.jsx(A,{children:e.touched.payment_method&&e.errors.payment_method})]}),a.jsxs(D,{variant:"filled",sx:{minWidth:120},error:!!e.touched.payment_status&&!!e.errors.payment_status,children:[a.jsx(F,{children:"Payment Status"}),a.jsx(P,{variant:"filled",name:"payment_status",autoComplete:"new-payment_status",value:e.values.payment_status,onChange:e.handleChange,children:Object.keys(k.payment_status).map(t=>a.jsx(T,{value:t,children:k.payment_status[t]},t))}),a.jsx(A,{children:e.touched.payment_status&&e.errors.payment_status})]}),a.jsxs(ne,{dateAdapter:le,children:[a.jsx(X,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Select Payment Date",name:"payment_date",value:e.values.payment_date,onChange:t=>e.setFieldValue("payment_date",t),slotProps:{textField:{error:!!e.touched.payment_date&&!!e.errors.payment_date,helperText:e.touched.payment_date&&e.errors.payment_date}}}),a.jsx(X,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Due Date",name:"due_date",value:e.values.due_date,onChange:t=>e.setFieldValue("due_date",t),slotProps:{textField:{error:!!e.touched.due_date&&!!e.errors.due_date,helperText:e.touched.due_date&&e.errors.due_date}}})]}),a.jsx(Q,{fullWidth:!0,variant:"filled",type:"number",label:"Late Fees",name:"late_fee",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.late_fee,error:!!e.touched.late_fee&&!!e.errors.late_fee,helperText:e.touched.late_fee&&e.errors.late_fee})]}),a.jsx(ie,{alerting:j.toastAlert,severity:j.toastSeverity,message:j.toastMessage})]})})};oe.propTypes={onChange:g.func,refId:g.shape({current:g.any}),setDirty:g.func,reset:g.bool,setReset:g.func,updatedValues:g.object};const Oe=()=>{const[v,W]=s.useState("Create"),[z,i]=s.useState(!1),[u,R]=s.useState({paymentData:{values:null,validated:!1}}),[N,H]=s.useState(null),[m,G]=s.useState(!1),[d,o]=s.useState(!1),[x,j]=s.useState(!1),S=M(l=>l.menuItems.selected),I=M(l=>l.toastInfo),q=s.useRef(),h=_e(),p=re(),e=ge(),Y=ve(),B=xe(Y.palette.mode),{typography:w}=je(Y.palette.mode),{state:b}=Se(),{toastAndNavigate:f,getLocalStorage:U}=de();let t=(b==null?void 0:b.id)||(e==null?void 0:e.id);s.useEffect(()=>{const l=U("menu");p(be(l.selected))},[]);const E=s.useCallback(l=>{i(!0);const{class_id:O,section:y,...r}=l.paymentData.values;V.PaymentAPI.updatePayment(r).then(({data:n})=>{n.status==="Success"&&(i(!1),f(p,!0,"info","Successfully Updated",h,"/payment/listing"))}).catch(n=>{var c,_;i(!1),f(p,!0,"error",n?(_=(c=n==null?void 0:n.response)==null?void 0:c.data)==null?void 0:_.msg:"An Error Occurred",h,0),console.log("Error in Updating Payment:",n)})},[u]),K=s.useCallback(l=>{const O=[`/get-by-pk/payment/${l}`];i(!0),V.CommonAPI.multipleAPICall("GET",O).then(y=>{const r=y[0].data;if(r.status==="Success"){r.data.payment_date=ae(r.data.payment_date),r.data.due_date!=null&&(r.data.due_date=ae(r.data.due_date));const n=r.data.student_id;V.StudentAPI.getClassOfStudent(n).then(c=>{const _={...r.data,class_id:c.data.class,section:c.data.section};H(_),i(!1)}).catch(c=>{console.log("Error in API calls of populating Payment:",c)})}}).catch(y=>{var r,n;i(!1),f(p,!0,"error",y?(n=(r=y==null?void 0:y.response)==null?void 0:r.data)==null?void 0:n.msg:"An Error Occurred",h,0)})},[t]),$=s.useCallback(l=>{i(!0);const{class_id:O,section:y,...r}=l.paymentData.values;V.PaymentAPI.createPayment(r).then(({data:n})=>{n.status==="Success"&&(i(!1),f(p,!0,"success","Successfully Created",h,"/payment/listing"))}).catch(n=>{var c,_;i(!1),f(p,!0,"error",n?(_=(c=n==null?void 0:n.response)==null?void 0:c.data)==null?void 0:_.msg:"An Error Occurred",h,0),console.log("Error in Creating Payment:",n)})},[u]);s.useEffect(()=>{var l;t&&!d&&(W("Update"),K(t)),u.paymentData.validated?(l=u.paymentData.values)!=null&&l.id?E(u):$(u):o(!1)},[t,d]);const C=async()=>{await q.current.Submit(),o(!0)},ce=(l,O)=>{O==="payment"&&R({...u,paymentData:l})};return a.jsxs(L,{m:"10px",sx:{backgroundImage:Y.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${te})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${te})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed",height:"100%"},children:[a.jsx(Ce,{fontFamily:w.fontFamily,fontSize:w.h2.fontSize,color:B.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${v} ${S}`}),a.jsx(oe,{onChange:l=>{ce(l,"payment")},refId:q,setDirty:G,reset:x,setReset:j,updatedValues:N}),a.jsxs(L,{display:"flex",justifyContent:"end",m:"20px",children:[v==="Update"?null:a.jsx(J,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!m||d,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&j(!0)},children:"Reset"}),a.jsx(J,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>h("/payment/listing"),children:"Cancel"}),a.jsx(J,{type:"submit",onClick:()=>C(),disabled:!m,color:v==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(ie,{alerting:I.toastAlert,severity:I.toastSeverity,message:I.toastMessage})]}),z===!0?a.jsx(De,{}):null]})};export{Oe as default};
