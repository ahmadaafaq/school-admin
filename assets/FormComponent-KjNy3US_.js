import{k as oe,l as F,P as p,a as r,m as Q,o as ee,b as J,z as le,R as de,ac as ie,A as P,j as s,B as H,h as V,q as T,ad as ue,Z as ce,ae as he,af as me,v as W,I as O,S as N,M as q,C as K,U as se,n as pe,E as ge,u as fe,t as xe,d as ve,p as be,s as Ce,f as X,T as we,x as je,y as ye}from"./index-dsWAcX1f.js";import{A as Se}from"./AddressFormComponent-EqXGwUPp.js";import{c as z}from"./index-mbUFVO5S.js";const Ae=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Ie=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,ke=oe().shape({username:F().min(2,"Username is Too Short!").max(50,"Username is Too Long!").required("This Field is Required"),password:F().min(8,"Password Must Be 8 Characters Long").matches(/[A-Z]/,"Password Must Contain At Least 1 Uppercase Letter").matches(/[a-z]/,"Password Must Contain At Least 1 Lowercase Letter").matches(/[0-9]/,"Password Must Contain At Least 1 Number").matches(/[^\w]/,"Password Must Contain At Least 1 Special Character").required("This Field is Required"),email:F().matches(Ie,"Email Address is Not Valid"),contact_no:F().matches(Ae,"Phone Number Is Not Valid").required("This Field is Required"),gender:F(),status:F()}),Fe={school_id:"",username:"",password:"",email:"",contact_no:"",designation:"",role:"",gender:"",status:"inactive"},ae=({onChange:R,refId:j,setDirty:G,reset:U,setReset:i,userId:h,rolePriority:y,updatedValues:m=null})=>{var $;const[S,D]=r.useState(!1),[A,C]=r.useState({clicked:!1,password:null}),[L,_]=r.useState(Fe),[B,I]=r.useState(null),[k,M]=r.useState([]),u=Q(a=>a.allSchools),g=ee(),f=J("(min-width:600px)"),v=J("(max-width:480px)"),c=document.getElementById("pwField"),{fetchAndSetAll:Z}=se(),e=le({initialValues:L,validationSchema:ke,enableReinitialize:!0,onSubmit:()=>E()});de.useImperativeHandle(j,()=>({Submit:async()=>{await e.submitForm()}}));const E=()=>{R&&(c.disabled&&delete e.values.password,R({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1}))};r.useEffect(()=>{U&&(e.resetForm(),i(!1))},[U]),r.useEffect(()=>{e.dirty&&G(!0)},[e.dirty]),r.useEffect(()=>{m&&(_(m),c.setAttribute("disabled",!0),c.style.backgroundColor="#777",C({clicked:!0}))},[m]),r.useEffect(()=>{var a;!((a=u==null?void 0:u.listData)!=null&&a.length)&&y===1&&Z(g,ie,P.SchoolAPI)},[u==null?void 0:u.listData]),r.useEffect(()=>{(()=>{P.UserRoleAPI.getAll().then(x=>{x.status==="Success"?M(x.data.rows):console.log("An Error Occurred, Please Try Again")}).catch(x=>{throw x})})()},[]);const b=()=>{A.clicked?(c.removeAttribute("disabled"),c.style.backgroundColor="rgba(255, 255, 255, 0.09)",c.focus(),C({clicked:!1,password:e.values.password}),e.values.password=""):(c.setAttribute("disabled",!0),c.style.backgroundColor="#777",C({clicked:!0}),e.values.password=A.password)};return s.jsxs(H,{m:"20px",children:[h?s.jsxs(V,{type:"button",color:"primary",variant:"contained",sx:{position:v?"relative":"absolute",right:v?"0":30,top:v?98:110,zIndex:v?1:0},onClick:b,children:[A.clicked===!0?"Update":"Cancel Update"," Password "]}):null,s.jsx("form",{ref:j,children:s.jsxs(H,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:f?void 0:"span 4"}},children:[s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",name:"username",label:"Username*",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.username,error:!!e.touched.username&&!!e.errors.username,helperText:e.touched.username&&e.errors.username,sx:{gridColumn:"span 2"}}),s.jsx(T,{fullWidth:!0,variant:"filled",id:"pwField",label:"Password*",name:"password",type:S?"text":"password",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.password,error:!!e.touched.password&&!!e.errors.password,helperText:e.touched.password&&e.errors.password,sx:{gridColumn:"span 2"},InputProps:{endAdornment:s.jsx(ue,{position:"end",children:s.jsx(ce,{"aria-label":"toggle password visibility",onClick:()=>D(!S),onMouseDown:()=>D(!S),children:S?s.jsx(he,{}):s.jsx(me,{})})})}}),s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",label:"Designation",name:"designation",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.designation,error:!!e.touched.designation&&!!e.errors.designation,helperText:e.touched.designation&&e.errors.designation}),s.jsxs(W,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[s.jsx(O,{children:"Gender"}),s.jsx(N,{variant:"filled",name:"gender",value:e.values.gender,onChange:e.handleChange,children:Object.keys(z.gender).map(a=>s.jsx(q,{value:a,children:z.gender[a]},a))}),s.jsx(K,{children:e.touched.gender&&e.errors.gender})]}),($=u==null?void 0:u.listData)!=null&&$.length?s.jsxs(W,{variant:"filled",sx:{minWidth:120},error:!!e.touched.school_id&&!!e.errors.school_id,children:[s.jsx(O,{id:"schoolField",children:"School"}),s.jsx(N,{variant:"filled",labelId:"schoolField",label:"School",name:"school_id",value:e.values.school_id,onChange:a=>{const x=a.target.value;I(x),e.setFieldValue("school_id",x)},children:u.listData.map(a=>s.jsx(q,{value:a.id,name:a.name,children:a.name},a.id))})]}):null,s.jsxs(W,{variant:"filled",sx:{minWidth:120},error:!!e.touched.role&&!!e.errors.role,children:[s.jsx(O,{id:"roleField",children:"Role"}),s.jsx(N,{variant:"filled",labelId:"roleField",label:"role",name:"role",value:e.values.role,onChange:e.handleChange,children:y===2&&!k.length?null:k.filter(a=>a.id>y&&a.id<4).map(a=>s.jsx(q,{value:a.id,name:a.name,children:a.name.charAt(0).toUpperCase()+a.name.slice(1)},a.name))})]}),s.jsxs(W,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[s.jsx(O,{children:"Status"}),s.jsx(N,{variant:"filled",name:"status",value:e.values.status,onChange:e.handleChange,children:Object.keys(z.status).map(a=>s.jsx(q,{value:a,children:z.status[a]},a))}),s.jsx(K,{children:e.touched.status&&e.errors.status})]})]})})]})};ae.propTypes={onChange:p.func,refId:p.shape({current:p.any}),setDirty:p.func,reset:p.bool,setReset:p.func,userId:p.number,rolePriority:p.number,updatedValues:p.object};const Pe=({rolePriority:R})=>{const[j,G]=r.useState("Create"),[U,i]=r.useState(!1),[h,y]=r.useState({userData:{values:null,validated:!1},addressData:{values:null,validated:!1}}),[m,S]=r.useState(null),[D,A]=r.useState(!1),[C,L]=r.useState(!1),[_,B]=r.useState(!1),I=Q(t=>t.menuItems.selected),k=Q(t=>t.toastInfo),M=r.useRef(),u=r.useRef(),g=pe(),f=ee(),v=ge(),c=fe(),Z=xe(c.palette.mode),{typography:e}=ve(c.palette.mode),{state:E}=be(),{toastAndNavigate:b,getLocalStorage:$}=se();let a=(E==null?void 0:E.id)||(v==null?void 0:v.id);r.useEffect(()=>{const t=$("menu");f(Ce(t.selected))},[]);const x=r.useCallback(t=>{const l=[{...t.userData.values},{...t.addressData.values}],n=["/update-user","/update-address"];i(!0),t.userData.password||delete t.userData.password,P.CommonAPI.multipleAPICall("PATCH",n,l).then(o=>{let d=!0;o.forEach(w=>{w.data.status!=="Success"&&(d=!1)}),d&&(i(!1),b(f,!0,"info","Successfully Updated",g,`/${I.toLowerCase()}/listing`)),i(!1)}).catch(o=>{var d,w;i(!1),b(f,!0,"error",o?(w=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:w.msg:"An Error Occurred",g,0),console.log("Error in user update",o)})},[h]),te=r.useCallback(t=>{i(!0);const l=[`/get-by-pk/user/${t}`,`/get-address/user/${t}`];P.CommonAPI.multipleAPICall("GET",l).then(n=>{var d,w;const o={userData:n[0].data.data,addressData:(w=(d=n[1])==null?void 0:d.data)==null?void 0:w.data};S(o),i(!1)}).catch(n=>{var o,d;i(!1),b(f,!0,"error",n?(d=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:d.msg:"An Error Occurred",g,0),console.log("Error in user populate",n)})},[]),re=r.useCallback(t=>{i(!0),P.UserAPI.register({...t.userData.values}).then(({data:l})=>{(l==null?void 0:l.status)==="Success"&&P.AddressAPI.createAddress({...t.addressData.values,parent_id:l.data.id,parent:"user"}).then(()=>{i(!1),b(f,!0,"success","Successfully Created",g,`/${I.toLowerCase()}/listing`)}).catch(n=>{var o,d;i(!1),b(f,!0,"error",n?(d=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:d.msg:"An Error Occurred",g,0),console.log("Error in user create",n)})}).catch(l=>{var n,o;i(!1),b(f,!0,"error",l?(o=(n=l==null?void 0:l.response)==null?void 0:n.data)==null?void 0:o.msg:"An Error Occurred",g,0),console.log("Error in user create",l)})},[]);r.useEffect(()=>{var t;a&&!C&&(G("Update"),te(a)),h.userData.validated&&h.addressData.validated?(t=h.userData.values)!=null&&t.id?x(h):re(h):L(!1)},[a,C]);const ne=async()=>{await M.current.Submit(),await u.current.Submit(),L(!0)},Y=(t,l)=>{y(l==="user"?{...h,userData:t}:{...h,addressData:t})};return s.jsxs(H,{m:"10px",sx:{backgroundImage:c.palette.mode=="light"?`linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), url(${X})`:`linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url(${X})`,backgroundRepeat:"no-repeat",backgroundPosition:"start",backgroundSize:"cover",backgroundAttachment:"fixed"},children:[s.jsx(we,{fontFamily:e.fontFamily,fontSize:e.h2.fontSize,color:Z.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${j} ${I}`}),s.jsx(ae,{onChange:t=>{Y(t,"user")},refId:M,setDirty:A,reset:_,setReset:B,userId:a,rolePriority:R,updatedValues:m==null?void 0:m.userData}),s.jsx(Se,{onChange:t=>{Y(t,"address")},refId:u,update:!!a,setDirty:A,reset:_,setReset:B,updatedValues:m==null?void 0:m.addressData}),s.jsxs(H,{display:"flex",justifyContent:"end",m:"20px",children:[j==="Update"?null:s.jsx(V,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!D||C,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&B(!0)},children:"Reset"}),s.jsx(V,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>g(`/${I.toLowerCase()}/listing`),children:"Cancel"}),s.jsx(V,{type:"submit",onClick:()=>ne(),disabled:!D,color:j==="Update"?"info":"success",variant:"contained",children:"Submit"}),s.jsx(je,{alerting:k.toastAlert,severity:k.toastSeverity,message:k.toastMessage})]}),U===!0?s.jsx(ye,{}):null]})};Pe.propTypes={rolePriority:p.number};export{Pe as default};
