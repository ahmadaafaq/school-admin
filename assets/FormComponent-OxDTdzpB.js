import{r as ue,i as he,j as a,a as l,d as te,v as me,R as X,m as b,B as W,o as h,F as A,I as T,S as w,M as g,w as $,D as se,U as ie,h as pe,b as ge,x as xe,u as fe,t as ve,e as be,k as le,l as Ce,s as je,T as Se,p as Z,q as ye,L as _e}from"./index-OIGegECp.js";import{d as Fe}from"./dayjs.min-HpiShfyQ.js";import{A as Ae}from"./AddressFormComponent-rsUOdmEh.js";import{c as Te,a as k}from"./index.esm-HnX7SN4v.js";import{L as we,A as Ie,D as Be}from"./DatePicker-OD-1mMF4.js";import{F as re,C as ne}from"./FormControlLabel-Gd057uS1.js";import{A as oe}from"./Autocomplete-RPy4K-aw.js";import"./index-6c-u7hMX.js";import"./Dialog-9bSUYELc.js";var ee={},De=he;Object.defineProperty(ee,"__esModule",{value:!0});var ce=ee.default=void 0,Ee=De(ue()),$e=a,ke=(0,Ee.default)((0,$e.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddCircle");ce=ee.default=ke;const We=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Pe=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,Le=Te().shape({firstname:k().min(2,"Firstname is Too Short!").max(20,"Firstname is Too Long!").required("This Field is Required"),lastname:k().min(2,"Lastname is Too Short!").max(20,"Lastname is Too Long!").required("This Field is Required"),email:k().matches(Pe,"Email Address is Not Valid"),contact_no:k().matches(We,"Phone Number Is Not Valid").required("This Field is Required"),gender:k(),status:k()}),Re={firstname:"",lastname:"",email:"",contact_no:"",dob:null,age:"",nationality:"",religion:"",blood_group:"",qualification:"",achievements:"",experience:"",subject:[""],combinedClsSect:[],grade:"",is_specially_abled:!1,is_class_teacher:!1,class:"",section:"",caste_group:"",gender:"",status:"inactive"},qe=({onChange:I,refId:V,setDirty:K,reset:u,setReset:m,combinedClass:P,teacherId:x,updatedValues:B=null})=>{const[L,U]=l.useState(Re),[D,z]=l.useState([]),[R,q]=l.useState([]),[j,H]=l.useState([]),[S,Y]=l.useState([{id:1}]),y={inputProps:{"aria-label":"Checkboxes"}},f=te("(min-width:600px)"),E=te("(max-width:480px)"),{appendSuffix:M}=ie(),[Q,J]=l.useState({}),e=me({initialValues:L,validationSchema:Le,enableReinitialize:!0,onSubmit:()=>O()});X.useImperativeHandle(V,()=>({Submit:async()=>{await e.submitForm()}}));const O=()=>{I&&I({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})},G=()=>{Y([...S,{id:S.length+1}])};return l.useEffect(()=>{u&&(e.resetForm(),m(!1))},[u]),l.useEffect(()=>{e.dirty&&K(!0)},[e.dirty]),l.useEffect(()=>{if(B){const t=B.selectedClass.reduce((o,c)=>{const v=c.subject_id;return o[v]||(o[v]=[]),o[v].push(c),o},{});J(t),console.log(Q,"updated",t);const r=t&&Object.keys(t).length>0;U({...L,...B.teacherData,subject:r?Object.keys(t):[],combinedClsSect:r?Object.values(t):[]})}},[B]),l.useEffect(()=>{b.ClassAPI.getAll(!1,0,20).then(t=>{t.status==="Success"?z(t.data.rows):console.error("Error fetching classes. Please Try Again")}).catch(t=>{console.error("Error fetching classes:",t)})},[]),l.useEffect(()=>{b.SectionAPI.getAll(!1,0,20).then(t=>{t.status==="Success"?q(t.data.rows):console.error("Error fetching classes. Please Try Again")}).catch(t=>{console.error("Error fetching classes:",t)})},[]),l.useEffect(()=>{b.SubjectAPI.getAll(!1,0,30).then(t=>{t.status==="Success"?H(t.data.rows):console.error("Error fetching classes. Please Try Again")}).catch(t=>{console.error("Error fetching classes:",t)})},[]),console.log("formik.vslues=>",e.values.combinedClsSect),a.jsx(W,{m:"20px",children:a.jsxs("form",{ref:V,children:[a.jsxs(W,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gridColumn:"span 4",position:"relative",className:"box-shadow",sx:{"& > div":{gridColumn:f?void 0:"span 4"},transform:"translate(0)",transformStyle:"preserve-3d",marginBottom:"80px"},children:[a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",name:"firstname",label:"Firstname*",autoComplete:"new-firstname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.firstname,error:!!e.touched.firstname&&!!e.errors.firstname,helperText:e.touched.firstname&&e.errors.firstname}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",name:"lastname",label:"Lastname*",autoComplete:"new-lastname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.lastname,error:!!e.touched.lastname&&!!e.errors.lastname,helperText:e.touched.lastname&&e.errors.lastname}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",autoComplete:"new-email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Age",name:"age",autoComplete:"new-age",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.age,error:!!e.touched.age&&!!e.errors.age,helperText:e.touched.age&&e.errors.age}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Nationality",name:"nationality",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.nationality,error:!!e.touched.nationality&&!!e.errors.nationality,helperText:e.touched.nationality&&e.errors.nationality}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Religion",name:"religion",autoComplete:"new-religion",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.religion,error:!!e.touched.religion&&!!e.errors.religion,helperText:e.touched.religion&&e.errors.religion}),a.jsxs(A,{variant:"filled",sx:{minWidth:120},error:!!e.touched.caste_group&&!!e.errors.caste_group,children:[a.jsx(T,{id:"castGroupField",children:"Caste Group"}),a.jsxs(w,{variant:"filled",labelId:"castGroupField",name:"caste_group",label:"Caste Group",autoComplete:"new-caste_group",value:e.values.caste_group,onChange:e.handleChange,children:[a.jsx(g,{value:"general",children:"General"}),a.jsx(g,{value:"obc",children:"OBC"}),a.jsx(g,{value:"sc",children:"SC"}),a.jsx(g,{value:"st",children:"ST"})]}),a.jsx($,{children:e.touched.caste_group&&e.errors.caste_group})]}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Blood Group",name:"blood_group",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.blood_group,error:!!e.touched.blood_group&&!!e.errors.blood_group,helperText:e.touched.blood_group&&e.errors.blood_group}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Qualification",name:"qualification",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.qualification,error:!!e.touched.qualification&&!!e.errors.qualification,helperText:e.touched.qualification&&e.errors.qualification}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Achievements",name:"achievements",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.achievements,error:!!e.touched.achievements&&!!e.errors.achievements,helperText:e.touched.achievements&&e.errors.achievements}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Experience",name:"experience",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.experience,error:!!e.touched.experience&&!!e.errors.experience,helperText:e.touched.experience&&e.errors.experience}),a.jsx(h,{fullWidth:!0,variant:"filled",type:"text",label:"Grade",name:"grade",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.grade,error:!!e.touched.grade&&!!e.errors.grade,helperText:e.touched.grade&&e.errors.grade}),a.jsx(we,{dateAdapter:Ie,children:a.jsx(Be,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Date Of Birth",name:"dob",required:!0,value:e.values.dob,onChange:t=>e.setFieldValue("dob",t)})}),a.jsx(re,{label:"Is Specially Abled",sx:{gridColumn:E?"span 2":""},control:a.jsx(ne,{...y,color:"default",checked:!!e.values.is_specially_abled,name:"is_specially_abled",onChange:(t,r)=>e.setFieldValue("is_specially_abled",r),value:e.values.is_specially_abled})}),a.jsx(re,{label:"Is Class Teacher",sx:{gridColumn:E?"span 2":""},control:a.jsx(ne,{...y,color:"default",checked:!!e.values.is_class_teacher,name:"is_class_teacher",onChange:(t,r)=>e.setFieldValue("is_class_teacher",r),value:e.values.is_class_teacher})}),e.values.is_class_teacher&&a.jsxs(a.Fragment,{children:[a.jsxs(A,{variant:"filled",sx:{minWidth:120},error:!!e.touched.class&&!!e.errors.class,children:[a.jsx(T,{id:"classField",children:"Class"}),a.jsx(w,{variant:"filled",labelId:"classField",label:"Class",name:"class",autoComplete:"new-class",value:e.values.class,onChange:e.handleChange,children:D.length&&D.map(t=>a.jsx(g,{value:t.id,name:t.name,children:t.name},t.name))}),a.jsx($,{children:e.touched.class&&e.errors.class})]}),a.jsxs(A,{variant:"filled",sx:{minWidth:120},error:!!e.touched.section&&!!e.errors.section,children:[a.jsx(T,{id:"sectionField",children:"Section"}),a.jsx(w,{variant:"filled",labelId:"sectionField",label:"Section",name:"section",autoComplete:"new-section",value:e.values.section,onChange:t=>e.setFieldValue("section",t.target.value),children:R.length&&R.map(t=>a.jsx(g,{value:t.id,name:t.name,children:t.name},t.name))}),a.jsx($,{children:e.touched.section&&e.errors.section})]})]}),a.jsxs(A,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[a.jsx(T,{id:"genderField",children:"Gender"}),a.jsxs(w,{variant:"filled",labelId:"genderField",label:"Gender",name:"gender",autoComplete:"new-gender",value:e.values.gender,onChange:e.handleChange,children:[a.jsx(g,{value:"male",children:"Male"}),a.jsx(g,{value:"female",children:"Female"}),a.jsx(g,{value:"other",children:"Other"})]}),a.jsx($,{children:e.touched.gender&&e.errors.gender})]}),a.jsxs(A,{variant:"filled",sx:{minWidth:120},children:[a.jsx(T,{id:"statusField",children:"Status"}),a.jsxs(w,{variant:"filled",labelId:"statusField",label:"Status",name:"status",autoComplete:"new-status",value:e.values.status,onChange:e.handleChange,error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(g,{value:"active",children:"Active"}),a.jsx(g,{value:"inactive",children:"Inactive"})]})]})]}),a.jsxs(W,{border:"2px solid #BADFE7",borderRadius:"12px",padding:"4px",display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",gridColumn:"span 4",position:"relative",className:"box-shadow",sx:{transform:"translate(0)",transformStyle:"preserve-3d",marginBottom:"80px"},children:[a.jsxs(W,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",onClick:G,children:[a.jsx(ce,{sx:{fontSize:"22px"}}),a.jsx("span",{style:{color:"rgb(97,97,97)",fontWeight:"300",fontSize:"16px",lineHeight:"30px",letterSpacing:"0.015em"},children:" Add Subjects "})]}),!x&&S.map(t=>a.jsxs(X.Fragment,{children:[a.jsxs(A,{variant:"filled",sx:{minWidth:120},error:!!e.touched.subject&&!!e.errors.subject,children:[a.jsxs(T,{id:`subjectField_${t.id}`,children:["Subject ",t.id]}),a.jsx(w,{variant:"filled",labelId:`subjectField_${t.id}`,label:`Subject ${t.id}`,name:`subject_${t.id}`,autoComplete:"new-subject",value:e.values.subject[t.id-1],onChange:(r,o)=>{const c=[...e.values.subject];c[t.id-1]=o.props.value,e.setFieldValue("subject",c)},children:j.length&&j.map(r=>a.jsx(g,{value:r.id,name:r.name,children:r.name},r.name))}),a.jsx($,{children:e.touched.subject&&e.errors.subject})]}),a.jsx(oe,{multiple:!0,options:P,getOptionLabel:r=>`${M(r.class_name)} ${r.section_name}`,disableCloseOnSelect:!0,value:e.values.combinedClsSect[t.id-1],onChange:(r,o)=>{const c=[...e.values.combinedClsSect];c[t.id-1]=o,e.setFieldValue("combinedClsSect",c)},sx:{gridColumn:"span 2"},renderInput:r=>a.jsx(h,{...r,variant:"filled",type:"text",name:`combinedClsSect_${t.id}`,label:"Class and Section"})}),S.length>1&&a.jsx(se,{sx:{borderBottomWidth:"0px"}})]},t.id)),x&&Object.values(Q).map((t,r)=>{let o=r+1;return a.jsxs(X.Fragment,{children:[a.jsxs(A,{variant:"filled",sx:{minWidth:120},error:!!e.touched.subject&&!!e.errors.subject,children:[a.jsxs(T,{id:`subjectField_${o}`,children:["Subject ",o]}),a.jsx(w,{variant:"filled",labelId:`subjectField_${o}`,label:`Subject ${o}`,name:`subject_${o}`,autoComplete:"new-subject",value:t[r].subject_id,onChange:(c,v)=>{const _=[...e.values.subject];_[o-1]=v.props.value,e.setFieldValue("subject",_)},children:j.length&&j.map(c=>a.jsx(g,{value:c.id,name:c.name,children:c.name},c.name))}),a.jsx($,{children:e.touched.subject&&e.errors.subject})]}),a.jsx(oe,{multiple:!0,options:P,getOptionLabel:c=>`${M(c.class_name)} ${c.section_name}`,disableCloseOnSelect:!0,value:e.values.combinedClsSect[r]||[],onChange:(c,v)=>{const _=[...e.values.combinedClsSect];_[o-1]=v,e.setFieldValue("combinedClsSect",_)},sx:{gridColumn:"span 2"},renderInput:c=>a.jsx(h,{...c,variant:"filled",type:"text",name:`combinedClsSect_${o}`,label:"Class and Section"})}),r>0&&a.jsx(se,{sx:{borderBottomWidth:"0px"}})]},o)})]})]})})},Qe=()=>{const[I,V]=l.useState("Create"),[K,u]=l.useState(!1),[m,P]=l.useState({teacherData:{values:null,validated:!1},addressData:{values:null,validated:!1}}),[x,B]=l.useState(null),[L,U]=l.useState(!1),[D,z]=l.useState(!1),[R,q]=l.useState(!1),[j,H]=l.useState([]),S=l.useRef(),Y=l.useRef(),y=pe(),f=ge(),E=xe(),M=fe(),Q=ve(M.palette.mode),{typography:J}=be(M.palette.mode),e=le(s=>s.menuItems.selected),O=le(s=>s.toastInfo),{state:G}=Ce(),{toastAndNavigate:t,getLocalStorage:r}=ie();let o=(G==null?void 0:G.id)||(E==null?void 0:E.id);l.useEffect(()=>{const s=r("menu");f(je(s.selected))},[]);const c=l.useCallback(s=>{const C=[{...s.teacherData.values},{...s.addressData.values}],n=["/update-teacher","/update-address"];u(!0),b.CommonAPI.multipleAPICall("PATCH",n,C).then(i=>{let d=!0;i.forEach(p=>{p.data.status!=="Success"&&(d=!1)}),d&&(u(!1),t(f,!0,"info","Successfully Updated",y,`/${e.toLowerCase()}/listing`)),u(!1)}).catch(i=>{var d,p;throw u(!1),t(f,!0,"error",(p=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:p.msg),i})},[m]),v=s=>{u(!0);const C=[`/get-by-pk/teacher/${s}`,`/get-address/teacher/${s}`,`/get-teacher-detail/${s}`];b.CommonAPI.multipleAPICall("GET",C).then(n=>{var d,p,N,F;console.log("res=>",n),n[0].data.data&&(n[0].data.data.dob=Fe(n[0].data.data.dob));const i={teacherData:{teacherData:n[0].data.data,selectedClass:(p=(d=n[2])==null?void 0:d.data)==null?void 0:p.data},addressData:(F=(N=n[1])==null?void 0:N.data)==null?void 0:F.data};B(i),u(!1)}).catch(n=>{var i,d;throw u(!1),t(f,!0,"error",(d=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:d.msg),n})},_=()=>{let s,C;u(!0),b.TeacherAPI.createTeacher({...m.teacherData.values}).then(({data:n})=>{if((n==null?void 0:n.status)==="Success")return s=b.AddressAPI.createAddress({...m.addressData.values,parent_id:n.data.id,parent:"teacher"}),C=m.teacherData.values.combinedClsSect.map((i,d)=>{var N;const p=((N=m.teacherData.values)==null?void 0:N.subject[d])||0;i.map(F=>{console.log("got",F.class_id,F.section_id,p),b.TeacherAPI.insertIntoMappingTable([n.data.id,F.class_id,F.section_id,p])})}),Promise.all([s,C]).then(i=>{u(!1),t(f,!0,"success","Successfully Created",y,`/${e.toLowerCase()}/listing`)}).catch(i=>{var d,p;throw u(!1),t(f,!0,"error",i?(p=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:p.msg:"An Error Occurred",y,0),i})}).catch(n=>{var i,d;throw u(!1),t(f,!0,"error",(d=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:d.msg),n})};l.useEffect(()=>{b.ClassAPI.getClassSectionList().then(s=>{s.status==="Success"?H(s.data):console.error("Error fetching classes. Please Try Again")}).catch(s=>{console.error("Error fetching classes:",s)})},[]),l.useEffect(()=>{var s;o&&!D&&j&&(V("Update"),v(o)),m.teacherData.validated&&m.addressData.validated?(s=m.teacherData.values)!=null&&s.id?c(m):_():z(!1)},[o,D]);const de=async()=>{await S.current.Submit(),await Y.current.Submit(),z(!0)},ae=(s,C)=>{P(C==="teacher"?{...m,teacherData:s}:{...m,addressData:s})};return a.jsxs(W,{m:"10px",children:[a.jsx(Se,{fontFamily:J.fontFamily,fontSize:J.h2.fontSize,color:Q.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${I} ${e}`}),a.jsx(qe,{onChange:s=>{ae(s,"teacher")},refId:S,setDirty:U,reset:R,setReset:q,teacherId:o,combinedClass:j,setCombinedClass:H,updatedValues:x==null?void 0:x.teacherData}),a.jsx(Ae,{onChange:s=>{ae(s,"address")},refId:Y,update:!!o,setDirty:U,reset:R,setReset:q,updatedValues:x==null?void 0:x.addressData}),a.jsxs(W,{display:"flex",justifyContent:"end",m:"20px",children:[I==="Update"?null:a.jsx(Z,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!L||D,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&q(!0)},children:"Reset"}),a.jsx(Z,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>y(`/${e.toLowerCase()}/listing`),children:"Cancel"}),a.jsx(Z,{type:"submit",onClick:()=>de(),disabled:!L,color:I==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(ye,{alerting:O.toastAlert,severity:O.toastSeverity,message:O.toastMessage})]}),K===!0?a.jsx(_e,{}):null]})};export{Qe as default};
