import{a as l,d as O,v as ae,R as te,m as C,j as a,B as R,o as d,F,I as w,S as T,M as h,w as A,h as se,b as le,x as re,u as ne,t as oe,e as ie,k as V,l as de,s as ue,T as ce,p as q,q as he,L as me,U as fe}from"./index-OIGegECp.js";import{d as z}from"./dayjs.min-HpiShfyQ.js";import{A as ge}from"./AddressFormComponent-rsUOdmEh.js";import{c as pe,a as v}from"./index.esm-HnX7SN4v.js";import{L as xe,A as ve,D as H}from"./DatePicker-OD-1mMF4.js";import{F as Ce,C as be}from"./FormControlLabel-Gd057uS1.js";import"./index-6c-u7hMX.js";import"./Dialog-9bSUYELc.js";const je=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,ye=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,_e=pe().shape({firstname:v().min(2,"Firstname is Too Short!").max(20,"Firstname is Too Long!").required("This Field is Required"),lastname:v().min(2,"Lastname is Too Short!").max(20,"Lastname is Too Long!").required("This Field is Required"),email:v().matches(ye,"Email Address is Not Valid"),contact_no:v().matches(je,"Phone Number Is Not Valid").required("This Field is Required"),gender:v(),status:v()}),Se={firstname:"",lastname:"",mother_name:"",father_name:"",guardian:"",contact_no:"",email:"",class:"",section:"",admission_date:null,dob:null,is_specially_abled:!1,blood_group:"",birth_mark:"",religion:"",nationality:"",age:"",caste_group:"",gender:"",status:"inactive"},Fe=({onChange:p,refId:B,setDirty:L,reset:n,setReset:u,userId:P,updatedValues:m=null})=>{const[$,I]=l.useState(Se),[b,j]=l.useState([]),[y,D]=l.useState([]),_={inputProps:{"aria-label":"Checkboxes"}},k=O("(min-width:600px)"),E=O("(max-width:480px)"),e=ae({initialValues:$,validationSchema:_e,enableReinitialize:!0,onSubmit:()=>f()});te.useImperativeHandle(B,()=>({Submit:async()=>{await e.submitForm()}}));const f=()=>{p&&p({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return l.useEffect(()=>{n&&(e.resetForm(),u(!1))},[n]),l.useEffect(()=>{e.dirty&&L(!0)},[e.dirty]),l.useEffect(()=>{m&&I(m)},[m]),l.useEffect(()=>{C.ClassAPI.getAll(!1,0,20).then(t=>{t.status==="Success"?j(t.data.rows):console.error("Error fetching classes. Please Try Again")}).catch(t=>{console.error("Error fetching classes:",t)})},[]),l.useEffect(()=>{C.SectionAPI.getAll(!1,0,20).then(t=>{t.status==="Success"?D(t.data.rows):console.error("Error fetching classes. Please Try Again")}).catch(t=>{console.error("Error fetching classes:",t)})},[]),a.jsx(R,{m:"20px",children:a.jsx("form",{ref:B,children:a.jsxs(R,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:k?void 0:"span 4"}},children:[a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"firstname",label:"Firstname*",autoComplete:"new-firstname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.firstname,error:!!e.touched.firstname&&!!e.errors.firstname,helperText:e.touched.firstname&&e.errors.firstname}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"lastname",label:"Lastname*",autoComplete:"new-lastname",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.lastname,error:!!e.touched.lastname&&!!e.errors.lastname,helperText:e.touched.lastname&&e.errors.lastname}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"mother_name",label:"Mother's Name*",autoComplete:"new-mother_name",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.mother_name,error:!!e.touched.mother_name&&!!e.errors.mother_name,helperText:e.touched.mother_name&&e.errors.mother_name}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"father_name",label:"Father's Name*",autoComplete:"new-father_name",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.father_name,error:!!e.touched.father_name&&!!e.errors.father_name,helperText:e.touched.father_name&&e.errors.father_name}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"guardian",label:"Guardian If Any",autoComplete:"new-guardian",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.guardian,error:!!e.touched.guardian&&!!e.errors.guardian,helperText:e.touched.guardian&&e.errors.guardian}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",autoComplete:"new-email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),a.jsxs(F,{variant:"filled",sx:{minWidth:120},error:!!e.touched.class&&!!e.errors.class,children:[a.jsx(w,{id:"classField",children:"Class"}),a.jsx(T,{variant:"filled",labelId:"classField",label:"class",name:"class",autoComplete:"new-class",value:e.values.class,onChange:t=>e.setFieldValue("class",t.target.value),children:b.length&&b.map(t=>a.jsx(h,{value:t.id,name:t.name,children:t.name},t.name))}),a.jsx(A,{children:e.touched.class&&e.errors.class})]}),a.jsxs(F,{variant:"filled",sx:{minWidth:120},error:!!e.touched.section&&!!e.errors.section,children:[a.jsx(w,{id:"sectionField",children:"Section"}),a.jsx(T,{variant:"filled",labelId:"sectionField",label:"Section",name:"section",autoComplete:"new-section",value:e.values.section,onChange:t=>e.setFieldValue("section",t.target.value),children:y.length&&y.map(t=>a.jsx(h,{value:t.id,name:t.name,children:t.name},t.name))}),a.jsx(A,{children:e.touched.section&&e.errors.section})]}),a.jsxs(xe,{dateAdapter:ve,children:[a.jsx(H,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Select Date Of Birth",name:"dob",required:!0,value:e.values.dob,onChange:t=>{console.log("DOB=>",t),e.setFieldValue("dob",t)}}),a.jsx(H,{format:"DD MMMM YYYY",views:["day","month","year"],label:"Select Admission Date",name:"admission_date",required:!0,value:e.values.admission_date,onChange:t=>{console.log("admission_date=>",t),e.setFieldValue("admission_date",t)}})]}),a.jsx(Ce,{label:"Is Specially Abled",sx:{gridColumn:E?"span 2":""},control:a.jsx(be,{..._,color:"default",checked:!!e.values.is_specially_abled,name:"is_specially_abled",onChange:(t,M)=>e.setFieldValue("is_specially_abled",M),value:e.values.is_specially_abled})}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"blood_group",label:"Blood Group",autoComplete:"new-blood_group",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.blood_group,error:!!e.touched.blood_group&&!!e.errors.blood_group,helperText:e.touched.blood_group&&e.errors.blood_group}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"birth_mark",label:"Birth Mark",autoComplete:"new-birth_mark",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.birth_mark,error:!!e.touched.birth_mark&&!!e.errors.birth_mark,helperText:e.touched.birth_mark&&e.errors.birth_mark}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"religion",label:"Religion",autoComplete:"new-religion",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.religion,error:!!e.touched.religion&&!!e.errors.religion,helperText:e.touched.religion&&e.errors.religion}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"nationality",label:"Nationality",autoComplete:"new-nationality",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.nationality,error:!!e.touched.nationality&&!!e.errors.nationality,helperText:e.touched.nationality&&e.errors.nationality}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"age",label:"Age",autoComplete:"new-age",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.age,error:!!e.touched.age&&!!e.errors.age,helperText:e.touched.age&&e.errors.age}),a.jsxs(F,{variant:"filled",sx:{minWidth:120},error:!!e.touched.caste_group&&!!e.errors.caste_group,children:[a.jsx(w,{id:"castGroupField",children:"Caste Group"}),a.jsxs(T,{variant:"filled",labelId:"castGroupField",name:"caste_group",label:"Caste Group",autoComplete:"new-caste_group",value:e.values.caste_group,onChange:e.handleChange,children:[a.jsx(h,{value:"general",children:"General"}),a.jsx(h,{value:"obc",children:"OBC"}),a.jsx(h,{value:"sc",children:"SC"}),a.jsx(h,{value:"st",children:"ST"})]}),a.jsx(A,{children:e.touched.caste_group&&e.errors.caste_group})]}),a.jsxs(F,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[a.jsx(w,{id:"genderField",children:"Gender"}),a.jsxs(T,{variant:"filled",labelId:"genderField",label:"Gender",name:"gender",autoComplete:"new-gender",value:e.values.gender,onChange:e.handleChange,children:[a.jsx(h,{value:"male",children:"Male"}),a.jsx(h,{value:"female",children:"Female"}),a.jsx(h,{value:"other",children:"Other"})]}),a.jsx(A,{children:e.touched.gender&&e.errors.gender})]}),a.jsxs(F,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx(w,{id:"statusField",children:"Status"}),a.jsxs(T,{variant:"filled",labelId:"statusField",label:"Status",name:"status",autoComplete:"new-status",value:e.values.status,onChange:e.handleChange,children:[a.jsx(h,{value:"active",children:"Active"}),a.jsx(h,{value:"inactive",children:"Inactive"})]}),a.jsx(A,{children:e.touched.status&&e.errors.status})]})]})})})},Me=()=>{const[p,B]=l.useState("Create"),[L,n]=l.useState(!1),[u,P]=l.useState({studentData:{values:null,validated:!1},addressData:{values:null,validated:!1}}),[m,$]=l.useState(null),[I,b]=l.useState(!1),[j,y]=l.useState(!1),[D,_]=l.useState(!1),k=l.useRef(),E=l.useRef(),e=se(),f=le(),t=re(),M=ne(),Q=oe(M.palette.mode),{typography:Y}=ie(M.palette.mode),J=V(s=>s.menuItems.selected),G=V(s=>s.toastInfo),{state:N}=de(),{toastAndNavigate:x,getLocalStorage:W}=fe();let S=(N==null?void 0:N.id)||(t==null?void 0:t.id);l.useEffect(()=>{const s=W("menu");f(ue(s.selected))},[]);const K=l.useCallback(s=>{const o=[{...s.studentData.values},{...s.addressData.values}],r=["/update-student","/update-address"];n(!0),C.CommonAPI.multipleAPICall("PATCH",r,o).then(i=>{let c=!0;i.forEach(g=>{g.data.status!=="Success"&&(c=!1)}),c&&(n(!1),x(f,!0,"info","Successfully Updated",e,`/student/listing/${W("class")}`)),n(!1)}).catch(i=>{var c,g;throw n(!1),x(f,!0,"error",(g=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:g.msg),i})},[u]),X=s=>{n(!0);const o=[`/get-by-pk/student/${s}`,`/get-address/student/${s}`];C.CommonAPI.multipleAPICall("GET",o).then(r=>{var c,g;r[0].data.data&&(r[0].data.data.dob=z(r[0].data.data.dob),r[0].data.data.admission_date=z(r[0].data.data.admission_date));const i={studentData:r[0].data.data,addressData:(g=(c=r[1])==null?void 0:c.data)==null?void 0:g.data};console.log("form component",i),$(i),n(!1)}).catch(r=>{var i,c;throw n(!1),x(f,!0,"error",(c=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:c.msg),r})},Z=()=>{n(!0),C.StudentAPI.createStudent({...u.studentData.values}).then(({data:s})=>{(s==null?void 0:s.status)==="Success"&&C.AddressAPI.createAddress({...u.addressData.values,parent_id:s.data.id,parent:"student"}).then(o=>{n(!1),x(f,!0,"success","Successfully Created",e,`/student/listing/${W("class")}`)}).catch(o=>{throw n(!1),x(f,!0,o||"An Error Occurred"),o})}).catch(s=>{var o,r;throw n(!1),x(f,!0,"error",(r=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:r.msg),s})};l.useEffect(()=>{var s;S&&!j&&(B("Update"),X(S)),u.studentData.validated&&u.addressData.validated?(s=u.studentData.values)!=null&&s.id?K(u):Z():y(!1)},[S,j]);const ee=async()=>{await k.current.Submit(),await E.current.Submit(),y(!0)},U=(s,o)=>{P(o==="student"?{...u,studentData:s}:{...u,addressData:s})};return a.jsxs(R,{m:"10px",children:[a.jsx(ce,{fontFamily:Y.fontFamily,fontSize:Y.h2.fontSize,color:Q.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${p} ${J}`}),a.jsx(Fe,{onChange:s=>{U(s,"student")},refId:k,setDirty:b,reset:D,setReset:_,userId:S,updatedValues:m==null?void 0:m.studentData}),a.jsx(ge,{onChange:s=>{U(s,"address")},refId:E,update:!!S,setDirty:b,reset:D,setReset:_,updatedValues:m==null?void 0:m.addressData}),a.jsxs(R,{display:"flex",justifyContent:"end",m:"20px",children:[p==="Update"?null:a.jsx(q,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!I||j,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&_(!0)},children:"Reset"}),a.jsx(q,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>e(`/student/listing/${W("class")||""}`),children:"Cancel"}),a.jsx(q,{type:"submit",onClick:()=>ee(),disabled:!I,color:p==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(he,{alerting:G.toastAlert,severity:G.toastSeverity,message:G.toastMessage})]}),L===!0?a.jsx(me,{}):null]})};export{Me as default};
