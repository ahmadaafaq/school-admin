import{a as l,d as Y,v as le,R as ne,j as a,B as D,o as d,F as N,I as $,S as M,M as h,w as J,h as re,b as ie,x as de,u as ce,t as ue,e as he,k as Q,l as pe,s as me,m as S,T as fe,p as U,q as ge,L as xe,U as ve}from"./index-MsP7Yzml.js";import"./dayjs.min-WFAZ4E6Z.js";import{A as ye}from"./AddressFormComponent-FyI41TpB.js";import{c as be,a as I}from"./index.esm-JiYwYH4D.js";import{A as Ce}from"./Autocomplete-UT5QdtF-.js";import{F as _e,C as Se}from"./FormControlLabel-c6D5vxEv.js";const je=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,we=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,Fe=be().shape({name:I().min(2,"Firstname is Too Short!").max(50,"Firstname is Too Long!").required("This Field is Required"),email:I().matches(we,"Email Address is Not Valid"),contact_no_1:I().matches(je,"Phone Number Is Not Valid").required("This Field is Required"),status:I()}),Ae={name:"",email:"",contact_no_1:"",contact_no_2:"",director:"",principal:"",board:"",area:"",amenities:[],is_boarding:!1,boarding_capacity:0,capacity:0,founding_year:0,affiliation_no:0,type:"",sub_type:"",status:"inactive"},Te=({onChange:g,refId:j,setDirty:E,reset:i,setReset:n,userId:W,amenities:p,updatedValues:b=null})=>{const[w,F]=l.useState(Ae),C={inputProps:{"aria-label":"Checkboxes"}},A=Y("(min-width:600px)"),T=Y("(max-width:480px)"),e=le({initialValues:w,validationSchema:Fe,enableReinitialize:!0,onSubmit:()=>x()});ne.useImperativeHandle(j,()=>({Submit:async()=>{await e.submitForm()}}));const x=()=>{g&&g({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1})};return l.useEffect(()=>{i&&(e.resetForm(),n(!1))},[i]),l.useEffect(()=>{e.dirty&&E(!0)},[e.dirty]),l.useEffect(()=>{b&&F(b)},[b]),a.jsx(D,{m:"20px",children:a.jsx("form",{ref:j,children:a.jsxs(D,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:A?void 0:"span 4"}},children:[a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"name",label:"Name*",autoComplete:"new-name",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.name,error:!!e.touched.name&&!!e.errors.name,helperText:e.touched.name&&e.errors.name,sx:{gridColumn:"span 2"}}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",autoComplete:"new-email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no_1",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no_1,error:!!e.touched.contact_no_1&&!!e.errors.contact_no_1,helperText:e.touched.contact_no_1&&e.errors.contact_no_1}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",label:"Optional Contact Number",name:"contact_no_2",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no_2,error:!!e.touched.contact_no_2&&!!e.errors.contact_no_2,helperText:e.touched.contact_no_2&&e.errors.contact_no_2}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"director",label:"Director*",autoComplete:"new-director",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.director,error:!!e.touched.director&&!!e.errors.director,helperText:e.touched.director&&e.errors.director}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"principal",label:"Principal*",autoComplete:"new-principal",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.principal,error:!!e.touched.principal&&!!e.errors.principal,helperText:e.touched.principal&&e.errors.principal}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"board",label:"Board",autoComplete:"new-board",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.board,error:!!e.touched.board&&!!e.errors.board,helperText:e.touched.board&&e.errors.board}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"area",label:"Area",autoComplete:"new-area",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.area,error:!!e.touched.area&&!!e.errors.area,helperText:e.touched.area&&e.errors.area}),a.jsx(Ce,{multiple:!0,options:p,getOptionLabel:u=>u.name,disableCloseOnSelect:!0,value:e.values.amenities,onChange:(u,v)=>e.setFieldValue("amenities",v),sx:{gridColumn:"span 2"},renderInput:u=>a.jsx(d,{...u,variant:"filled",type:"text",name:"amenities",label:"Amenities",error:!!e.touched.amenities&&!!e.errors.amenities,helperText:e.touched.amenities&&e.errors.amenities})}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"capacity",label:"Capacity",autoComplete:"new-capacity",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.capacity,error:!!e.touched.capacity&&!!e.errors.capacity,helperText:e.touched.capacity&&e.errors.capacity}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"founding_year",label:"Founding Year",autoComplete:"new-founding_year",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.founding_year,error:!!e.touched.founding_year&&!!e.errors.founding_year,helperText:e.touched.founding_year&&e.errors.founding_year}),a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"affiliation_no",label:"Affiliation No",autoComplete:"new-affiliation_no",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.affiliation_no,error:!!e.touched.affiliation_no&&!!e.errors.affiliation_no,helperText:e.touched.affiliation_no&&e.errors.affiliation_no}),a.jsxs(N,{variant:"filled",sx:{minWidth:120},error:!!e.touched.type&&!!e.errors.type,children:[a.jsx($,{id:"typeField",children:"Type"}),a.jsxs(M,{variant:"filled",labelId:"typeField",label:"Type",name:"type",autoComplete:"new-type",value:e.values.type,onChange:e.handleChange,children:[a.jsx(h,{value:"co-ed",children:"Co-Ed"}),a.jsx(h,{value:"boys",children:"Boys"}),a.jsx(h,{value:"girls",children:"Girls"})]}),a.jsx(J,{children:e.touched.type&&e.errors.type})]}),a.jsxs(N,{variant:"filled",sx:{minWidth:120},error:!!e.touched.sub_type&&!!e.errors.sub_type,children:[a.jsx($,{id:"sub_typeField",children:"Sub Type"}),a.jsxs(M,{variant:"filled",labelId:"sub_typeField",label:"sub_type",name:"sub_type",autoComplete:"new-sub_type",value:e.values.sub_type,onChange:u=>e.setFieldValue("sub_type",u.target.value),children:[a.jsx(h,{value:"playgroup",children:"Playgroup"}),a.jsx(h,{value:"junior",children:"Junior"}),a.jsx(h,{value:"senior",children:"Senior"}),a.jsx(h,{value:"senior-sec",children:"Senior-Sec"})]}),a.jsx(J,{children:e.touched.sub_type&&e.errors.sub_type})]}),a.jsxs(N,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[a.jsx($,{id:"statusField",children:"Status"}),a.jsxs(M,{variant:"filled",labelId:"statusField",label:"Status",name:"status",autoComplete:"new-status",value:e.values.status,onChange:e.handleChange,children:[a.jsx(h,{value:"active",children:"Active"}),a.jsx(h,{value:"inactive",children:"Inactive"})]})]}),a.jsx(_e,{label:"Is Boarding",sx:{gridColumn:T?"span 2":""},control:a.jsx(Se,{...C,color:"default",checked:!!e.values.is_boarding,name:"is_boarding",onChange:(u,v)=>e.setFieldValue("is_boarding",v),value:e.values.is_boarding})}),e.values.is_boarding&&a.jsx(d,{fullWidth:!0,variant:"filled",type:"text",name:"boarding_capacity",label:"Specify Boarding Capacity",autoComplete:"new-boarding_capacity",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.boarding_capacity,error:!!e.touched.boarding_capacity&&!!e.errors.boarding_capacity,helperText:e.touched.boarding_capacity&&e.errors.boarding_capacity})]})})})},Re=()=>{const[g,j]=l.useState("Create"),[E,i]=l.useState(!1),[n,W]=l.useState({schoolData:{values:null,validated:!1},addressData:{values:null,validated:!1}}),[p,b]=l.useState(null),[w,F]=l.useState(!1),[C,A]=l.useState(!1),[T,e]=l.useState(!1),[x,u]=l.useState([]),v=l.useRef(),q=l.useRef(),k=re(),m=ie(),R=de(),V=ce(),K=ue(V.palette.mode),{typography:z}=he(V.palette.mode),B=Q(t=>t.menuItems.selected),L=Q(t=>t.toastInfo),{state:P}=pe(),{createSchoolCode:X,getLocalStorage:Z,toastAndNavigate:y}=ve();let _=(P==null?void 0:P.id)||(R==null?void 0:R.id);l.useEffect(()=>{const t=Z("menu");m(me(t.selected))},[]);const ee=l.useCallback(t=>{i(!0);const o=["/update-school","/update-address"],s=[{...t.schoolData.values,amenities:H(t.schoolData.values.amenities)},{...t.addressData.values}];S.CommonAPI.multipleAPICall("PATCH",o,s).then(r=>{let c=!0;r.forEach(f=>{f.data.status!=="Success"&&(c=!1)}),c&&(i(!1),y(m,!0,"info","Successfully Updated",k,`/${B.toLowerCase()}/listing`)),i(!1)}).catch(r=>{var c,f;throw i(!1),y(m,!0,"error",(f=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:f.msg),r})},[n]),ae=t=>{i(!0);const o=[`/get-by-pk/school/${t}`,`/get-address/school/${t}`];S.CommonAPI.multipleAPICall("GET",o).then(s=>{var c,f,O;s[0].data.data&&(s[0].data.data.amenities=oe((c=s[0].data.data)==null?void 0:c.amenities));const r={schoolData:s[0].data.data,addressData:(O=(f=s[1])==null?void 0:f.data)==null?void 0:O.data};console.log("form component",r),b(r),i(!1)}).catch(s=>{var r,c;throw i(!1),y(m,!0,"error",(c=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:c.msg),s})},te=()=>{var t;i(!0),n.schoolData.values={...n.schoolData.values,school_code:X(n.schoolData.values.name),amenities:H((t=n.schoolData.values)==null?void 0:t.amenities)},S.SchoolAPI.createSchool({...n.schoolData.values}).then(({data:o})=>{(o==null?void 0:o.status)==="Success"&&S.AddressAPI.createAddress({...n.addressData.values,school_id:o.data.id,parent_id:o.data.id,parent:"school"}).then(s=>{i(!1),y(m,!0,"success","Successfully Created",k,`/${B.toLowerCase()}/listing`)}).catch(s=>{throw i(!1),y(m,!0,s||"An Error Occurred"),s})}).catch(o=>{var s,r;throw i(!1),y(m,!0,"error",(r=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:r.msg),o})};function H(t){let o=[];return t==null||t.forEach(s=>{o.push(s.id)}),o.toString()}const oe=t=>{const o=t==null?void 0:t.split(",");if(o)return x.filter(s=>o.includes(s.id.toString()))};l.useEffect(()=>{(()=>{S.AmenityAPI.getAll(!1,0,30).then(o=>{o.status==="Success"?u(o.data.rows):console.log("Error, Please Try Again")}).catch(o=>{throw o})})()},[]),l.useEffect(()=>{var t;_&&!C&&x&&(j("Update"),ae(_)),n.schoolData.validated&&n.addressData.validated?(t=n.schoolData.values)!=null&&t.id?ee(n):te():A(!1)},[_,C,x]);const se=async()=>{await v.current.Submit(),await q.current.Submit(),A(!0)},G=(t,o)=>{W(o==="school"?{...n,schoolData:t}:{...n,addressData:t})};return a.jsxs(D,{m:"10px",children:[a.jsx(fe,{fontFamily:z.fontFamily,fontSize:z.h2.fontSize,color:K.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${g} ${B}`}),a.jsx(Te,{onChange:t=>{G(t,"school")},refId:v,setDirty:F,reset:T,setReset:e,userId:_,amenities:x,updatedValues:p==null?void 0:p.schoolData}),a.jsx(ye,{onChange:t=>{G(t,"address")},refId:q,update:!!_,setDirty:F,reset:T,setReset:e,updatedValues:p==null?void 0:p.addressData}),a.jsxs(D,{display:"flex",justifyContent:"end",m:"20px",children:[g==="Update"?null:a.jsx(U,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!w||C,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&e(!0)},children:"Reset"}),a.jsx(U,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>k(`/${B.toLowerCase()}/listing`),children:"Cancel"}),a.jsx(U,{type:"submit",onClick:()=>se(),disabled:!w,color:g==="Update"?"info":"success",variant:"contained",children:"Submit"}),a.jsx(ge,{alerting:L.toastAlert,severity:L.toastSeverity,message:L.toastMessage})]}),E===!0?a.jsx(xe,{}):null]})};export{Re as default};
