import{a,d as H,v as ee,R as se,j as s,B as O,p as q,o as T,ac as te,a0 as ae,ag as le,ah as oe,F as $,I as W,S as N,M as x,m as j,h as ne,b as re,x as ie,u as de,t as ue,e as ce,k as Q,l as he,s as me,T as pe,q as fe,L as ge,U as xe}from"./index-MsP7Yzml.js";import{A as ve}from"./AddressFormComponent-FyI41TpB.js";import{c as we,a as S}from"./index.esm-JiYwYH4D.js";import{u as Ce}from"./index-V08yF_g-.js";const be=/^((\+[1-9]{1,4}[ -]?)|(\([0-9]{2,3}\)[ -]?)|([0-9]{2,4})[ -]?)*?[0-9]{3,4}[ -]?[0-9]{3,4}$/,Se=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,je=we().shape({username:S().min(2,"Username is Too Short!").max(50,"Username is Too Long!").required("This Field is Required"),password:S().min(8,"Password Must Be 8 Characters Long").matches(/[A-Z]/,"Password Must Contain At Least 1 Uppercase Letter").matches(/[a-z]/,"Password Must Contain At Least 1 Lowercase Letter").matches(/[0-9]/,"Password Must Contain At Least 1 Number").matches(/[^\w]/,"Password Must Contain At Least 1 Special Character").required("This Field is Required"),email:S().matches(Se,"Email Address is Not Valid"),contact_no:S().matches(be,"Phone Number Is Not Valid").required("This Field is Required"),gender:S(),status:S()}),ye={school_id:"",username:"",password:"",email:"",contact_no:"",designation:"",role:"",gender:"",status:"inactive"},Ae=({onChange:U,refId:v,setDirty:z,reset:D,setReset:n,userId:d,rolePriority:E,updatedValues:m=null})=>{const[w,y]=a.useState(!1),[C,f]=a.useState({clicked:!1,password:null}),[L,_]=a.useState(ye),[A,B]=a.useState([]),[G,I]=a.useState(null),[p,F]=a.useState([]);a.useState({name:"",priority:null});const M=H("(min-width:600px)"),b=H("(max-width:480px)"),u=document.getElementById("pwField"),e=ee({initialValues:L,validationSchema:je,enableReinitialize:!0,onSubmit:()=>P()});se.useImperativeHandle(v,()=>({Submit:async()=>{await e.submitForm()}}));const P=()=>{U&&(u.disabled&&delete e.values.password,U({values:e.values,validated:e.isSubmitting?Object.keys(e.errors).length===0:!1}))};a.useEffect(()=>{D&&(e.resetForm(),n(!1))},[D]),a.useEffect(()=>{e.dirty&&z(!0)},[e.dirty]),a.useEffect(()=>{m&&(_(m),u.setAttribute("disabled",!0),u.style.backgroundColor="#777",f({clicked:!0}))},[m]),a.useEffect(()=>{(()=>{j.SchoolAPI.getAllSchools().then(l=>{(l==null?void 0:l.status)==="Success"?B(l.data.list):console.log("An Error Occurred, Please Try Again")}).catch(l=>{throw l})})()},[]),a.useEffect(()=>{(()=>{j.UserRoleAPI.getAll().then(l=>{l.status==="Success"?F(l.data.rows):console.log("An Error Occurred, Please Try Again")}).catch(l=>{throw l})})()},[]);const k=()=>{C.clicked?(u.removeAttribute("disabled"),u.style.backgroundColor="rgba(255, 255, 255, 0.09)",u.focus(),f({clicked:!1,password:e.values.password}),e.values.password=""):(u.setAttribute("disabled",!0),u.style.backgroundColor="#777",f({clicked:!0}),e.values.password=C.password)};return s.jsxs(O,{m:"20px",children:[d?s.jsxs(q,{type:"button",color:"primary",variant:"contained",sx:{position:b?"relative":"absolute",right:b?"0":30,top:b?98:110,zIndex:b?1:0},onClick:k,children:[C.clicked===!0?"Update":"Cancel Update"," Password "]}):null,s.jsx("form",{ref:v,children:s.jsxs(O,{display:"grid",gap:"30px",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",sx:{"& > div":{gridColumn:M?void 0:"span 4"}},children:[s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",name:"username",label:"Username*",autoComplete:"new-username",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.username,error:!!e.touched.username&&!!e.errors.username,helperText:e.touched.username&&e.errors.username,sx:{gridColumn:"span 2",marginBottom:"20px"}}),s.jsx(T,{fullWidth:!0,variant:"filled",id:"pwField",label:"Password*",name:"password",type:w?"text":"password",autoComplete:"new-password",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.password,error:!!e.touched.password&&!!e.errors.password,helperText:e.touched.password&&e.errors.password,sx:{gridColumn:"span 2"},InputProps:{endAdornment:s.jsx(te,{position:"end",children:s.jsx(ae,{"aria-label":"toggle password visibility",onClick:()=>y(!w),onMouseDown:()=>y(!w),children:w?s.jsx(le,{}):s.jsx(oe,{})})})}}),s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",label:"Email",name:"email",autoComplete:"new-email",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.email,error:!!e.touched.email&&!!e.errors.email,helperText:e.touched.email&&e.errors.email,sx:{gridColumn:"span 2"}}),s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",label:"Contact Number*",name:"contact_no",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.contact_no,error:!!e.touched.contact_no&&!!e.errors.contact_no,helperText:e.touched.contact_no&&e.errors.contact_no}),s.jsx(T,{fullWidth:!0,variant:"filled",type:"text",label:"Designation",name:"designation",autoComplete:"new-contact",onBlur:e.handleBlur,onChange:e.handleChange,value:e.values.designation,error:!!e.touched.designation&&!!e.errors.designation,helperText:e.touched.designation&&e.errors.designation}),s.jsxs($,{variant:"filled",sx:{minWidth:120},error:!!e.touched.gender&&!!e.errors.gender,children:[s.jsx(W,{id:"genderField",children:"Gender"}),s.jsxs(N,{variant:"filled",labelId:"genderField",label:"Gender",name:"gender",autoComplete:"new-gender",value:e.values.gender,onChange:e.handleChange,children:[s.jsx(x,{value:"male",children:"Male"}),s.jsx(x,{value:"female",children:"Female"}),s.jsx(x,{value:"other",children:"Other"})]})]}),s.jsxs($,{variant:"filled",sx:{minWidth:120},error:!!e.touched.school_id&&!!e.errors.school_id,children:[s.jsx(W,{id:"schoolField",children:"School"}),s.jsx(N,{variant:"filled",labelId:"schoolField",label:"School",name:"school_id",autoComplete:"new-school_id",value:e.values.school_id,onChange:o=>{const l=o.target.value;I(l),e.setFieldValue("school_id",l)},children:A.map(o=>s.jsx(x,{value:o.id,name:o.name,children:o.name},o.name))})]}),s.jsxs($,{variant:"filled",sx:{minWidth:120},error:!!e.touched.role&&!!e.errors.role,children:[s.jsx(W,{id:"roleField",children:"Role"}),s.jsx(N,{variant:"filled",labelId:"roleField",label:"role",name:"role",autoComplete:"new-role",value:e.values.role,onChange:e.handleChange,children:p.length&&p.filter(o=>o.id>E).map(o=>s.jsx(x,{value:o.id,name:o.name,children:o.name.charAt(0).toUpperCase()+o.name.slice(1)},o.name))})]}),s.jsxs($,{variant:"filled",sx:{minWidth:120},error:!!e.touched.status&&!!e.errors.status,children:[s.jsx(W,{id:"statusField",children:"Status"}),s.jsxs(N,{variant:"filled",labelId:"statusField",label:"Status",name:"status",autoComplete:"new-status",value:e.values.status,onChange:e.handleChange,children:[s.jsx(x,{value:"active",children:"Active"}),s.jsx(x,{value:"inactive",children:"Inactive"})]})]})]})})]})},Re=({rolePriority:U})=>{const[v,z]=a.useState("Create"),[D,n]=a.useState(!1),[d,E]=a.useState({userData:{values:null,validated:!1},addressData:{values:null,validated:!1}}),[m,w]=a.useState(null),[y,C]=a.useState(!1),[f,L]=a.useState(!1),[_,A]=a.useState(!1),B=a.useRef(),G=a.useRef(),I=ne(),p=re(),F=ie(),M=de(),b=ue(M.palette.mode),{typography:u}=ce(M.palette.mode),e=Q(t=>t.menuItems.selected),P=Q(t=>t.toastInfo),{state:k}=he(),{getQueryParam:o}=Ce(),{toastAndNavigate:l,getLocalStorage:Y}=xe();let R=(k==null?void 0:k.id)||(F==null?void 0:F.id);a.useEffect(()=>{const t=Y("menu");p(me(t.selected))},[]);const Z=a.useCallback(t=>{const r=[{...t.userData.values},{...t.addressData.values}],i=["/update-user","/update-address"];n(!0),t.userData.password||delete t.userData.password,j.CommonAPI.multipleAPICall("PATCH",i,r).then(c=>{let h=!0;c.forEach(g=>{g.data.status!=="Success"&&(h=!1)}),h&&(n(!1),l(p,!0,"info","Successfully Updated",I,`/${e.toLowerCase()}/listing`)),n(!1)}).catch(c=>{var h,g;throw n(!1),l(p,!0,"error",(g=(h=c==null?void 0:c.response)==null?void 0:h.data)==null?void 0:g.msg),c})},[d]),J=t=>{n(!0);const r=[`/get-by-pk/user/${t}`,`/get-address/user/${t}`];j.CommonAPI.multipleAPICall("GET",r).then(i=>{var h,g;const c={userData:i[0].data.data,addressData:(g=(h=i[1])==null?void 0:h.data)==null?void 0:g.data};w(c),n(!1)}).catch(i=>{var c,h;throw n(!1),l(p,!0,"error",(h=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:h.msg),i})},K=()=>{n(!0),o(),j.UserAPI.register({...d.userData.values}).then(({data:t})=>{(t==null?void 0:t.status)==="Success"&&j.AddressAPI.createAddress({...d.addressData.values,parent_id:t.data.id,parent:"user"}).then(r=>{n(!1),l(p,!0,"success","Successfully Created",I,`/${e.toLowerCase()}/listing`)}).catch(r=>{throw n(!1),l(p,!0,r||"An Error Occurred"),r})}).catch(t=>{var r,i;throw n(!1),l(p,!0,"error",(i=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:i.msg),t})};a.useEffect(()=>{var t;R&&!f&&(z("Update"),J(R)),d.userData.validated&&d.addressData.validated?(t=d.userData.values)!=null&&t.id?Z(d):K():L(!1)},[R,f]);const X=async()=>{await B.current.Submit(),await G.current.Submit(),L(!0)},V=(t,r)=>{E(r==="user"?{...d,userData:t}:{...d,addressData:t})};return s.jsxs(O,{m:"10px",children:[s.jsx(pe,{fontFamily:u.fontFamily,fontSize:u.h2.fontSize,color:b.grey[100],fontWeight:"bold",display:"inline-block",marginLeft:"20px",children:`${v} ${e}`}),s.jsx(Ae,{onChange:t=>{V(t,"user")},refId:B,setDirty:C,reset:_,setReset:A,userId:R,rolePriority:U,updatedValues:m==null?void 0:m.userData}),s.jsx(ve,{onChange:t=>{V(t,"address")},refId:G,update:!!R,setDirty:C,reset:_,setReset:A,updatedValues:m==null?void 0:m.addressData}),s.jsxs(O,{display:"flex",justifyContent:"end",m:"20px",children:[v==="Update"?null:s.jsx(q,{type:"reset",color:"warning",variant:"contained",sx:{mr:3},disabled:!y||f,onClick:()=>{window.confirm("Do You Really Want To Reset?")&&A(!0)},children:"Reset"}),s.jsx(q,{color:"error",variant:"contained",sx:{mr:3},onClick:()=>I(`/${e.toLowerCase()}/listing`),children:"Cancel"}),s.jsx(q,{type:"submit",onClick:()=>X(),disabled:!y,color:v==="Update"?"info":"success",variant:"contained",children:"Submit"}),s.jsx(fe,{alerting:P.toastAlert,severity:P.toastSeverity,message:P.toastMessage})]}),D===!0?s.jsx(ge,{}):null]})};export{Re as default};
